{"version":3,"file":"./index.js","mappings":"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","sources":["webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///./scripts/app/components/component.js","webpack:///./scripts/app/components/drawer/drawerButton.js","webpack:///./scripts/app/components/drawer/drawerPanel.js","webpack:///./scripts/app/components/main/buttonPanel/buttonPanel.js","webpack:///./scripts/app/components/main/buttonPanel/accordionPanel.js","webpack:///./scripts/app/components/main/buttonPanel/accordionPanelCategory.js","webpack:///./scripts/app/components/main/buttons/actionButton.js","webpack:///./scripts/app/components/main/buttons/buttonPanelButton.js","webpack:///./scripts/app/targetPicker.js","webpack:///./scripts/app/components/main/buttons/itemButton.js","webpack:///./scripts/app/components/main/buttons/macroButton.js","webpack:///./scripts/app/components/main/buttons/splitButton.js","webpack:///./scripts/app/components/main/actionPanel.js","webpack:///./scripts/lib/utils.js","webpack:///./scripts/app/components/portrait/effect.js","webpack:///./scripts/app/components/portrait/portraitPanel.js","webpack:///./scripts/app/components/main/weaponSets.js","webpack:///./scripts/app/components/main/movementHud.js","webpack:///./scripts/app/components/main/buttonHud.js","webpack:///./scripts/app/prefab/macroPanel.js","webpack:///./scripts/app/prefab/passTurnPanel.js","webpack:///./scripts/app/CoreHud.js","webpack:///./scripts/app/tooltip.js","webpack:///./scripts/config.js","webpack:///./scripts/app/EchThemeOptions.js","webpack:///./scripts/AlphaColorPicker.js","webpack:///./scripts/main.js","webpack:///./scripts/settings.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","import { PARTIALS_PATH } from \"../CoreHud.js\";\r\nimport { Tooltip } from \"../tooltip.js\";\r\n\r\nexport class ArgonComponent {\r\n    constructor() {\r\n        this.element = document.createElement(this.elementType);\r\n        this.element.classList.add(...this.classes);\r\n        this._tooltip = null;\r\n        this._parent = null;\r\n    }\r\n\r\n    get parent() {\r\n        return this._parent;\r\n    }\r\n\r\n    get actor() {\r\n        return ui.ARGON._actor;\r\n    }\r\n\r\n    get token() {\r\n        return ui.ARGON._token;\r\n    }\r\n\r\n    get template() {\r\n        const isAncestorComponent = Object.getPrototypeOf(this.constructor) === ArgonComponent;\r\n        return `${PARTIALS_PATH}${isAncestorComponent ? this.constructor.name : Object.getPrototypeOf(this.constructor).name}.hbs`;\r\n    }\r\n\r\n    get classes() {\r\n        return [];\r\n    }\r\n\r\n    get elementType() {\r\n        return \"div\";\r\n    }\r\n\r\n    get colorScheme() {\r\n        return null;\r\n    }\r\n\r\n    get visible() {\r\n        return true;\r\n    }\r\n\r\n    get hasTooltip() {\r\n        return false;\r\n    }\r\n\r\n    get tooltipOrientation() {\r\n        return null;\r\n    }\r\n\r\n    get tooltipCls() {\r\n        return CONFIG.ARGON.CORE.Tooltip;\r\n    }\r\n\r\n    setColorScheme() {\r\n        if (this.colorScheme === null) return;\r\n        switch (this.colorScheme) {\r\n            case 1:\r\n                this.element.classList.add(\"bonus-action\");\r\n                break;\r\n            case 2:\r\n                this.element.classList.add(\"free-action\");\r\n                break;\r\n            case 3:\r\n                this.element.classList.add(\"reaction\");\r\n                break;\r\n            case 4:\r\n                this.element.classList.add(\"end-turn\");\r\n                break;\r\n        }\r\n    }\r\n\r\n    setVisibility() {\r\n        this.element.classList.toggle(\"hidden\", !this.visible);\r\n    }\r\n\r\n    /**\r\n     * @typedef {Object} TooltipData\r\n     * @property {string} title - The name or title of the item.\r\n     * @property {string} description - The detailed description of the item, enriched as HTML content.\r\n     * @property {string} subtitle - A brief subtitle providing additional context about the item.\r\n     * @property {Array<{ label: string, value: any }>} details - An array of objects containing specific details about the item.\r\n     * @property {string} propertiesLabel - The label for the properties section.\r\n     * @property {Array<{ label: string, primary?: boolean, secondary?: boolean }>} properties - An array of objects representing the properties of the item.\r\n     * @property {Array<string>} footerText - An array of strings providing additional footer text.\r\n     */\r\n\r\n    async getTooltipData() {\r\n        return null;\r\n    }\r\n\r\n    async getData() {\r\n        return {};\r\n    }\r\n\r\n    async activateTooltipListeners() {\r\n        if (!game.settings.get(\"enhancedcombathud\", \"showTooltips\")) return;\r\n        const html = this.element;\r\n        html.onmouseenter = this._onTooltipMouseEnter.bind(this);\r\n        // html.onmouseleave = this._onTooltipMouseLeave.bind(this);\r\n        //add listener for middle mouse click\r\n        // html.addEventListener(\"mouseup\", (event) => {\r\n        //     const isWheelClick = event.button === 1;\r\n        //     if(isWheelClick) this._onTooltipMouseEnter(event, true);\r\n        // });\r\n    }\r\n\r\n    async _onTooltipMouseEnter(event, locked = false) {\r\n        // if(locked && this._tooltip) this._tooltip._destroy();\r\n        const tooltipData = await this.getTooltipData();\r\n        if (!tooltipData) return;\r\n        const tooltipCls = this.tooltipCls;\r\n        this._tooltip = new tooltipCls(tooltipData, this.element, this.tooltipOrientation, locked);\r\n        this._tooltip.render();\r\n    }\r\n\r\n    async _onTooltipMouseLeave(event) {\r\n        if (!this._tooltip || this._tooltip._locked) return;\r\n        this._tooltip._destroy();\r\n        this._tooltip = null;\r\n    }\r\n\r\n    async render() {\r\n        await this._renderInner();\r\n        await this.activateListeners(this.element);\r\n        if (this.hasTooltip) await this.activateTooltipListeners();\r\n        const parentClass = Object.getPrototypeOf(this.constructor);\r\n        Hooks.callAll(`render${parentClass.name}ArgonComponent`, this, this.element, this.actor);\r\n        Hooks.callAll(`render${this.constructor.name}ArgonComponent`, this, this.element, this.actor);\r\n        return this.element;\r\n    }\r\n\r\n    async _renderInner() {\r\n        const data = await this.getData();\r\n        const rendered = await (foundry.applications?.handlebars?.renderTemplate ?? renderTemplate)(this.template, data);\r\n        const tempElement = document.createElement(\"div\");\r\n        tempElement.innerHTML = rendered;\r\n        this.element.innerHTML = tempElement.firstElementChild.innerHTML;\r\n        this.setColorScheme();\r\n        this.setVisibility();\r\n    }\r\n\r\n    async activateListeners(html) {}\r\n}\r\n","import {ArgonComponent} from \"../component.js\";\r\n\r\nexport class DrawerButton extends ArgonComponent{\r\n  constructor (buttons) {\r\n    super();\r\n    this._buttons = buttons;\r\n  }\r\n\r\n  get classes() {\r\n    return [\"ability\"];\r\n  }\r\n\r\n  get elementType() {\r\n    return \"li\";\r\n  }\r\n\r\n  get interceptDialogs() {\r\n    return true;\r\n  }\r\n\r\n  get tooltipOrientation() {\r\n      return foundry.helpers.interaction.TooltipManager.implementation.TOOLTIP_DIRECTIONS.RIGHT;\r\n  }\r\n\r\n  setGrid(gridCols) {\r\n    this.element.style.gridTemplateColumns = gridCols;\r\n  }\r\n\r\n  setAlign(align) {\r\n    this._textAlign = align;\r\n  }\r\n\r\n  setTextAlign() {\r\n    if (!this._textAlign) return;\r\n    Array.from(this.element.children).forEach((child, index) => {\r\n      child.style.textAlign = this._textAlign[index];\r\n    });\r\n  }\r\n\r\n  async activateListeners(html) {\r\n    await super.activateListeners(html);\r\n    for (const button of this._buttons) {\r\n      if (!button.interactive) continue;\r\n      const index = this._buttons.indexOf(button);\r\n      const el = this.element.querySelector(`span[data-index=\"${index}\"]`);\r\n      if (!el) continue;\r\n      el.onclick = (e) => {\r\n        if (this.interceptDialogs) ui.ARGON.interceptNextDialog(e.currentTarget.closest(\".ability\"))\r\n        button.onClick(e);\r\n      }\r\n    }\r\n    this.setTextAlign();\r\n  }\r\n\r\n  async getData() {\r\n    this._buttons.forEach((button) => {\r\n      if(button.onClick) button.interactive = true;\r\n    });\r\n    return {\r\n      buttons: this._buttons,\r\n    }\r\n  }\r\n\r\n\r\n}","import {ArgonComponent} from \"../component.js\";\r\nimport { localize } from \"../../CoreHud.js\";\r\n\r\nexport class DrawerPanel extends ArgonComponent {\r\n\r\n    get classes() {\r\n        return [\"ability-menu\"];\r\n    }\r\n\r\n    get elementType() {\r\n        return \"div\";\r\n    }\r\n\r\n    get title() {\r\n        return \"Drawer Panel\";\r\n    }\r\n\r\n    get categories() {\r\n        return [];\r\n    }\r\n\r\n    async getData() {\r\n        this._processCategories();\r\n        return {\r\n            title: this.title,\r\n            categories: this._categories,\r\n        };\r\n    }\r\n\r\n    _processCategories() {\r\n        let categories = this.categories;\r\n        const title = this.title;\r\n        if (!categories[0]?.categories) categories = [{title, categories}];\r\n        this._categories = categories\r\n    }\r\n\r\n    async activateListeners(html) {\r\n        html.querySelectorAll(\".ability-toggle .ability.ability-title\").forEach(el => {\r\n            el.addEventListener(\"click\", (event) => {\r\n                const index = el.dataset.index;\r\n                this._expandPanel(index);\r\n            });\r\n        })\r\n    }\r\n\r\n    _expandPanel(index) {\r\n        if(isNaN(index)) return;\r\n        const el = this.element.querySelector(`.ability-toggle .ability.ability-title[data-index=\"${index}\"]`);\r\n        const element = ui.ARGON.element[0];\r\n        const ratio = parseFloat(element?.style.transform.split(\" \")[0].replace(/[^0-9.]+/g, \"\") ?? 1);\r\n        const scaleHeight = (window.innerHeight - (document.querySelector(\".portrait-hud\")?.offsetHeight || 200) * ratio) / ratio - 70;\r\n        let expanded = null;\r\n        this.element.querySelectorAll(`.ability-toggle .ability.ability-title`).forEach(el => el.classList.remove(\"active\"));\r\n        this.element.querySelectorAll(`.collapsible-panel`).forEach(el => {\r\n            if(el.style.maxHeight !== \"0px\") expanded = el.dataset.index;\r\n            el.style.maxHeight = \"0px\"\r\n        });\r\n        if (expanded != index) {\r\n            ui.ARGON._lastExpandedDrawer = index;\r\n            this.element.querySelector(`.collapsible-panel[data-index=\"${index}\"]`).style.maxHeight = `${scaleHeight}px`;\r\n            el.classList.add(\"active\");\r\n        } else {\r\n            ui.ARGON._lastExpandedDrawer = null;\r\n        }\r\n        document.body.classList.toggle(\"ech-show-ability-menu\", expanded != index);\r\n    }\r\n\r\n    async _renderInner() {\r\n        await super._renderInner();\r\n        const buttonPromises = [];\r\n        for (const panel of this._categories) {\r\n            const panelIndex = this._categories.indexOf(panel);\r\n            for (const category of panel.categories) {\r\n                const index = panel.categories.indexOf(category);\r\n                const container = this.element.querySelector(`.collapsible-panel[data-index=\"${panelIndex}\"] .ability-title[data-index=\"${index}\"]`);\r\n                if (!container) continue;\r\n                if (!category.buttons) continue;\r\n                const buttons = [...category.buttons].reverse();\r\n                for (const button of buttons) {\r\n                    button._parent = this;\r\n                    container.after(button.element);\r\n                    button.setGrid(category.gridCols);\r\n                    button.setAlign(category.captions.map((caption) => caption.align));\r\n                    buttonPromises.push(button.render());\r\n                }\r\n            }\r\n        }\r\n        await Promise.all(buttonPromises);\r\n        this.element.querySelectorAll(`.collapsible-panel`).forEach(el => {el.style.maxHeight = \"0px\"});\r\n        this._expandPanel(ui.ARGON._lastExpandedDrawer);\r\n        return this.element;\r\n    }\r\n}","import { ArgonComponent } from \"../../component.js\";\r\n\r\nexport class ButtonPanel extends ArgonComponent {\r\n    constructor({ buttons, id }) {\r\n        super();\r\n        this.element.dataset.iscontainer = true;\r\n        this._id = id ?? null;\r\n        this._buttons = buttons;\r\n        this.saveState = foundry.utils.debounce(this.saveState, 100);\r\n    }\r\n\r\n    get classes() {\r\n        return [\"features-container\"];\r\n    }\r\n\r\n    get visible() {\r\n        return this.element.classList.contains(\"show\");\r\n    }\r\n\r\n    get id() {\r\n        return this._id;\r\n    }\r\n\r\n    setVisibility() {}\r\n\r\n    toggle(toggle, noTransition = false) {\r\n        if (toggle === undefined) toggle = !this.visible;\r\n        if (toggle) ui.ARGON.collapseAllPanels();\r\n        if (noTransition) this.element.style.transition = \"none\";\r\n        this.element.classList.toggle(\"show\", toggle);\r\n        if (noTransition) setTimeout(() => (this.element.style.transition = null), 1);\r\n        this.saveState();\r\n    }\r\n\r\n    saveState() {\r\n        if (!this.id) return;\r\n        const state = {\r\n            visible: this.visible,\r\n        };\r\n        ui.ARGON.setPanelState(state, this);\r\n    }\r\n\r\n    restoreState() {\r\n        if (!this.id) return;\r\n        const state = ui.ARGON.getPanelState(this);\r\n        if (!state) return;\r\n        this.toggle(state.visible, true);\r\n    }\r\n\r\n    updateItem(item) {\r\n        if (!this._buttons) return;\r\n        for (const button of this._buttons) {\r\n            if (button.item === item) button.render();\r\n        }\r\n    }\r\n\r\n    async _renderInner() {\r\n        await super._renderInner();\r\n        this._buttons.forEach((button) => {\r\n            button._parent = this;\r\n            this.element.appendChild(button.element);\r\n        });\r\n        const promises = this._buttons.map((button) => button.render());\r\n        await Promise.all(promises);\r\n        this.restoreState();\r\n    }\r\n}\r\n","import { ArgonComponent } from \"../../component.js\";\r\nimport { ButtonPanel } from \"./buttonPanel.js\";\r\n\r\nexport class AccordionPanel extends ArgonComponent {\r\n    constructor({ accordionPanelCategories, id }) {\r\n        super();\r\n        this._subPanels = accordionPanelCategories;\r\n        this._id = id ?? null;\r\n        this.saveState = foundry.utils.debounce(this.saveState, 100);\r\n    }\r\n\r\n    get classes() {\r\n        return [\"features-container\", \"is-spells\"];\r\n    }\r\n\r\n    get visible() {\r\n        return this.element.classList.contains(\"show\");\r\n    }\r\n\r\n    get id() {\r\n        return this._id;\r\n    }\r\n\r\n    setVisibility() {}\r\n\r\n    toggle(toggle, noTransition = false) {\r\n        if (toggle === undefined) toggle = !this.visible;\r\n        if (toggle) ui.ARGON.collapseAllPanels();\r\n        if (noTransition) this.element.style.transition = \"none\";\r\n        this.element.classList.toggle(\"show\", toggle);\r\n        if (noTransition) setTimeout(() => (this.element.style.transition = null), 1);\r\n        this.saveState();\r\n    }\r\n\r\n    saveState() {\r\n        if (!this.id) return;\r\n        const state = {\r\n            visible: this.visible,\r\n            subPanels: this._subPanels.map((panel) => panel.visible),\r\n        };\r\n        ui.ARGON.setPanelState(state, this);\r\n    }\r\n\r\n    restoreState() {\r\n        if (!this.id) return;\r\n        const state = ui.ARGON.getPanelState(this);\r\n        if (!state) return;\r\n        this.toggle(state.visible, true);\r\n        for (let i = 0; i < state.subPanels.length; i++) {\r\n            this._subPanels[i]?.toggle(state.subPanels[i], true);\r\n        }\r\n    }\r\n\r\n    updateItem(item) {\r\n        if (!this._subPanels) return;\r\n        for (const panel of this._subPanels) {\r\n            panel.updateItem(item);\r\n        }\r\n    }\r\n\r\n    async toggleDefaults() {\r\n        let totalActionBarWidth = ui.ARGON.actionBarWidth;\r\n        for (const panel of this._subPanels) {\r\n            totalActionBarWidth -= panel.totalWidth;\r\n            if (totalActionBarWidth < 0) break;\r\n            panel.toggle(true);\r\n        }\r\n    }\r\n\r\n    async _renderInner() {\r\n        await super._renderInner();\r\n        this._subPanels.forEach((panel) => {\r\n            this.element.appendChild(panel.element);\r\n            panel._parent = this;\r\n        });\r\n        const promises = this._subPanels.map((panel) => panel.render());\r\n        await Promise.all(promises);\r\n        await this.toggleDefaults();\r\n        this.restoreState();\r\n    }\r\n}\r\n","import { ArgonComponent } from \"../../component.js\";\r\n\r\nexport class AccordionPanelCategory extends ArgonComponent {\r\n    constructor({ label, uses = {}, buttons }) {\r\n        super();\r\n        this.element.dataset.iscontainer = true;\r\n        this._label = label;\r\n        if (typeof uses === \"object\" && !uses.max) uses.max = uses.value;\r\n        this._uses = uses;\r\n        this._buttons = buttons;\r\n        ui.ARGON._accordionPanelCategories.add(this);\r\n        this.setUses = foundry.utils.debounce(this.setUses, 100);\r\n    }\r\n\r\n    get classes() {\r\n        return [\"features-accordion\"];\r\n    }\r\n\r\n    get buttonContainer() {\r\n        return this.element.querySelector(\".features-accordion-content\");\r\n    }\r\n\r\n    get visible() {\r\n        return this.element.classList.contains(\"show\");\r\n    }\r\n\r\n    get label() {\r\n        return this._label;\r\n    }\r\n\r\n    get uses() {\r\n        return typeof this._uses === \"object\" ? this._uses : this._uses();\r\n    }\r\n\r\n    get buttons() {\r\n        return this._buttons;\r\n    }\r\n\r\n    get totalWidth() {\r\n        return this._realWidth + this.element.querySelector(\".feature-accordion-title\").offsetHeight;\r\n    }\r\n\r\n    async getData() {\r\n        return {\r\n            label: this.label,\r\n        };\r\n    }\r\n\r\n    setVisibility() {}\r\n\r\n    updateItem(item) {\r\n        if (!this._buttons) return;\r\n        for (const button of this._buttons) {\r\n            if (button.item === item) button.render();\r\n        }\r\n    }\r\n\r\n    setUses() {\r\n        this._setUses();\r\n    }\r\n\r\n    _setUses() {\r\n        if (!Number.isNumeric(this.uses.value)) return;\r\n        const usesElement = this.buttonContainer.querySelector(\".feature-spell-slots\");\r\n        usesElement.innerHTML = \"\";\r\n        if (this.uses.value === Infinity) {\r\n            usesElement.innerHTML = `<span class=\"spell-slot spell-cantrip\"><i class=\"fas fa-infinity\"></i></span>`;\r\n            return;\r\n        }\r\n        for (let index = 0; index < this.uses.max; index++) {\r\n            //spellSlots.push(index < spellSlotDetails.value);\r\n            usesElement.innerHTML += `<span class=\"spell-slot spell-${index < this.uses.max - this.uses.value ? \"used\" : \"available\"}\"></span>`;\r\n        }\r\n    }\r\n\r\n    async activateListeners(html) {\r\n        this.element.querySelector(\".feature-accordion-title\").addEventListener(\"click\", () => {\r\n            this.toggle();\r\n        });\r\n    }\r\n\r\n    toggle(toggle, noTransition = false) {\r\n        if (toggle === undefined) toggle = !this.visible;\r\n        if (noTransition) {\r\n            this.element.style.transition = \"none\";\r\n            this.buttonContainer.style.transition = \"none\";\r\n        }\r\n        this.element.classList.toggle(\"show\", toggle);\r\n        this.element.style.width = toggle ? `${this._realWidth}px` : \"0px\";\r\n        if (noTransition)\r\n            setTimeout(() => {\r\n                this.element.style.transition = null;\r\n                this.buttonContainer.style.transition = null;\r\n            }, 1);\r\n        this.parent.saveState();\r\n    }\r\n\r\n    get buttonMultipliers() {\r\n        return [2, 3, 5, 7];\r\n    }\r\n\r\n    async _renderInner() {\r\n        await super._renderInner();\r\n        const buttonContainer = this.buttonContainer;\r\n        this._buttons.forEach((button) => {\r\n            button._parent = this;\r\n            buttonContainer.appendChild(button.element);\r\n        });\r\n        const promises = this._buttons.map((button) => button.render());\r\n        await Promise.all(promises);\r\n        this._setUses();\r\n        let closestMultiplier = 0;\r\n        this.buttonMultipliers.forEach((multiplier) => {\r\n            if (this._buttons.length % multiplier === 0) closestMultiplier = multiplier;\r\n        });\r\n        if (this._buttons.length < 3) {\r\n            buttonContainer.style.gridTemplateColumns = `repeat(${this._buttons.length}, 1fr)`;\r\n        } else if (closestMultiplier) {\r\n            buttonContainer.style.gridTemplateColumns = `repeat(${closestMultiplier}, 1fr)`;\r\n        }\r\n        this.element.style.transition = \"none\";\r\n        this.element.style.width = `unset`;\r\n        await new Promise((resolve) => setTimeout(resolve, 1));\r\n        const width = this.element.offsetWidth;\r\n        this._realWidth = width;\r\n        this.element.style.width = `0px`;\r\n        this.element.style.transition = null;\r\n    }\r\n}\r\n","import { ArgonComponent } from \"../../component.js\";\r\n\r\nexport class ActionButton extends ArgonComponent{\r\n  constructor () {\r\n    super();\r\n  }\r\n\r\n  get classes() {\r\n    return [\"action-element\", \"ech-blur\"];\r\n  }\r\n\r\n  get label() {\r\n    return \"\";\r\n  }\r\n\r\n  get icon() {\r\n    return \"\";\r\n  }\r\n\r\n  get quantity() {\r\n    return null;\r\n  }\r\n\r\n  get colorScheme() {\r\n    return 0;\r\n  }\r\n\r\n  async getData() {\r\n    return {\r\n      label: this.label,\r\n      icon: this.icon\r\n    }\r\n  }\r\n\r\n  activateListeners(html) {\r\n    this.element.onmouseup = this._onMouseUp.bind(this);\r\n    this.element.onmousedown = this._onMouseDown.bind(this);\r\n    this.element.onmouseenter = this._onMouseEnter.bind(this);\r\n    this.element.onmouseleave = this._onMouseLeave.bind(this);\r\n  }\r\n\r\n  async _onMouseDown(event) {\r\n  }\r\n\r\n  async _onMouseUp(event) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    if (event.button === 0) this._onLeftClick(event);\r\n    if (event.button === 2) this._onRightClick(event);\r\n  }\r\n\r\n  async _onMouseEnter(event) { }\r\n\r\n  async _onMouseLeave(event) { }\r\n\r\n  async _onLeftClick(event) {\r\n    console.error(\"ActionButton._onLeftClick not implemented\");\r\n  }\r\n\r\n  async _onRightClick(event) {\r\n  }\r\n\r\n  async _renderInner() {\r\n    await super._renderInner();\r\n    this.element.style.backgroundImage = `url(\"${this.icon}\")`;\r\n    if(Number.isNumeric(this.quantity)) {\r\n      this.element.classList.add(\"has-count\");\r\n      this.element.dataset.itemCount = this.quantity;\r\n    }\r\n  }\r\n}\r\n","import { ArgonComponent } from \"../../component.js\";\r\n\r\nexport class ButtonPanelButton extends ArgonComponent{\r\n\r\n  get classes() {\r\n    const base = [\"action-element\", \"ech-blur\"];\r\n    return base;\r\n  }\r\n\r\n  get label() {\r\n    return \"\";\r\n  }\r\n\r\n  get icon() {\r\n    return \"\";\r\n  }\r\n\r\n  get colorScheme() {\r\n    return 0;\r\n  }\r\n\r\n  get buttonPanelContainer() {\r\n    return ui.ARGON.buttonPanelContainer;\r\n  }\r\n\r\n  updateItem(item) {\r\n    if (!this.panel) return;\r\n    this.panel.updateItem(item);\r\n  }\r\n\r\n  async getData() {\r\n    return {\r\n      label: this.label,\r\n      icon: this.icon\r\n    }\r\n  }\r\n\r\n  async activateListeners(html) {\r\n    await super.activateListeners(html);\r\n    this.element.onclick = this._onClick.bind(this);\r\n  }\r\n\r\n  async _onClick(event) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    this.panel.toggle();\r\n  }\r\n\r\n  async _renderInner() {\r\n    await super._renderInner();\r\n    this.element.style.backgroundImage = `url(\"${this.icon}\")`;\r\n    this.panel = await this._getPanel();\r\n    this.panel._parent = this;\r\n    this.buttonPanelContainer.appendChild(this.panel.element);\r\n    await this.panel.render();\r\n  }\r\n\r\n  async _getPanel() {\r\n    console.warn(\"ButtonPanelButton.getPanel() is not implemented\");\r\n    return null;\r\n  }\r\n}","import { showRangeFinder, showRangeRings, clearRangeFinders, clearRanges } from \"./components/main/buttons/itemButton.js\";\r\n\r\nlet activeTargetPicker = null;\r\n\r\nexport class TargetPicker{\r\n  constructor ({token, targets, ranges}) {\r\n    checkShowTargetPickerGuide();\r\n    if (activeTargetPicker) activeTargetPicker.end(false);\r\n    activeTargetPicker = this;\r\n    this.ranges = ranges;\r\n    this.token = token;\r\n    this.resolve = null;\r\n    this.reject = null;\r\n    this._targetCount = game.user.targets.size;\r\n    this._maxTargets = targets;\r\n\r\n    const targetTool = document.querySelector('.control.tool[data-tool=\"target\"]')\r\n    targetTool?.click();\r\n\r\n    this.promise = new Promise((resolve, reject) => {\r\n      this.resolve = resolve;\r\n      this.reject = reject;\r\n    });\r\n    this.targetHook = Hooks.on(\"targetToken\", (user, token, targeted) => { \r\n      this.checkComplete();\r\n    });\r\n\r\n    this.movelistener = (event) => {\r\n        this.update(event);\r\n    };\r\n    this.clicklistener = (event) => { \r\n      if(event.which === 3) {\r\n        this.end(false);\r\n      }\r\n    };\r\n    this.keyuplistener = (event) => { \r\n      //check for + and - keys\r\n      if (event.key === \"+\" || event.key === \"=\") {\r\n        this.maxTargets++;\r\n      }\r\n      if (event.key === \"-\" || event.key === \"_\") {\r\n        if (this.maxTargets > 1) this.maxTargets--;\r\n      }\r\n    };\r\n    document.addEventListener(\"mousemove\", this.movelistener);\r\n    document.addEventListener(\"mouseup\", this.clicklistener);\r\n    document.addEventListener(\"keyup\", this.keyuplistener);\r\n    this.init();\r\n  }\r\n\r\n  checkComplete() { \r\n      this.targetCount = game.user.targets.size;\r\n      if (this.targetCount >= this.maxTargets) {\r\n          this.end(true);\r\n      }\r\n  }\r\n\r\n  set targetCount(count) { \r\n    this._targetCount = count;\r\n    this.update();\r\n  }\r\n\r\n  get targetCount() {\r\n    return this._targetCount;\r\n  }\r\n\r\n  set maxTargets(count) {\r\n    this._maxTargets = count;\r\n    this.update();\r\n    this.checkComplete();\r\n  }\r\n\r\n  get maxTargets() {\r\n    return this._maxTargets;\r\n  }\r\n\r\n  init() {\r\n    if(game.settings.get(\"enhancedcombathud\", \"rangepickerclear\")) game.user.targets.forEach(t => t.setTarget(false, { releaseOthers: true }));\r\n    const element = document.createElement(\"div\");\r\n    element.classList.add(\"ech-target-picker\");\r\n    document.body.appendChild(element);\r\n    this.element = element;\r\n    if (!this.maxTargets || this.targetCount == this.maxTargets) return this.end(true);\r\n    const tokenSizeOffset = Math.max(this.token.document.width, this.token.document.height) * 0.5 * canvas.scene.dimensions.distance;\r\n    showRangeRings(this.ranges.normal, this.ranges.long, this.token, tokenSizeOffset);\r\n  }\r\n\r\n  update(event) {\r\n    if(!this.element) return;\r\n    if (event) {\r\n      const clientX = event.clientX;\r\n      const clientY = event.clientY;\r\n      this.element.style.left = clientX + 20 + \"px\";\r\n      this.element.style.top = clientY + \"px\";\r\n    }\r\n    this.element.innerText = `${this.targetCount}/${this.maxTargets} Targets`;\r\n  }\r\n\r\n  end(res) {\r\n    clearRanges(true);\r\n    document.querySelector(\".control.tool\").click();\r\n    activeTargetPicker = null;\r\n    this.resolve(res);\r\n    this.element.remove();\r\n    Hooks.off(\"targetToken\", this.targetHook);\r\n    document.removeEventListener(\"mousemove\", this.movelistener);\r\n    document.removeEventListener(\"mouseup\", this.clicklistener);\r\n    document.removeEventListener(\"keyup\", this.keyuplistener);\r\n    document.querySelector('.control.tool[data-tool=\"select\"]')?.click();\r\n  }\r\n}\r\n\r\nfunction checkShowTargetPickerGuide() {\r\n  if (!game.settings.get(\"enhancedcombathud\", \"targetPickerGuideShown\")) {\r\n    window.ui.ARGON.showTargetPickerGuide();\r\n  }\r\n}\r\n\r\nexport async function showTargetPickerGuide() {\r\n  let list = \"\";\r\n  const elementsCount = 4;\r\n  for (let i = 0; i < elementsCount; i++) {\r\n    list += `<li class=\"notification info\" style=\"font-weight: 900\">${game.i18n.localize(`enhancedcombathud.targetPicker.dialog.list.${i}`)}</li>`;\r\n  }\r\n  const result = await foundry.applications.api.DialogV2.prompt({\r\n    window: { title: game.i18n.localize(\"enhancedcombathud.targetPicker.dialog.title\") },\r\n    content: `<ul class=\"guide-list\" style=\"list-style:none;padding:0\">${list}</ul>`,\r\n    close: () => {return false},\r\n  });\r\n  if(result) game.settings.set(\"enhancedcombathud\", \"targetPickerGuideShown\", true);\r\n}","import {ArgonComponent} from \"../../component.js\";\r\nimport { TargetPicker } from \"../../../targetPicker.js\";\r\n\r\nexport class ItemButton extends ArgonComponent{\r\n  constructor ({item, isWeaponSet=false, isPrimary=false, inActionPanel=undefined}) {\r\n    super();\r\n    this._item = item;\r\n    this._isWeaponSet = isWeaponSet;\r\n    this._isPrimary = isPrimary;\r\n    this._inActionPanel = inActionPanel ?? isWeaponSet;\r\n    if (this.isWeaponSet) this.hookId = Hooks.on(\"argon-onSetChangeUpdateItem\", this._onSetChange.bind(this));\r\n    ui.ARGON.addItemButtons(this);\r\n  }\r\n\r\n  get classes() {\r\n    return [\"feature-element\"];\r\n  }\r\n\r\n  get isWeaponSet() {\r\n    return this._isWeaponSet;\r\n  }\r\n\r\n  get isPrimary() {\r\n    return this._isPrimary;\r\n  }\r\n\r\n  get inActionPanel() {\r\n    return this._inActionPanel;\r\n  }\r\n\r\n  get item() {\r\n    return this._item;\r\n  }\r\n\r\n  get label() {\r\n    return this.item.name;\r\n  }\r\n\r\n  get icon() {\r\n    return this.item.img;\r\n  }\r\n\r\n  get quantity() {\r\n    return null;\r\n  }\r\n\r\n  get quantitySecondary() {\r\n    return null;\r\n  }\r\n\r\n  get ranges(){\r\n    return {\r\n      normal: null,\r\n      long: null\r\n    }\r\n  }\r\n\r\n  get targets() {\r\n    return 0;\r\n  }\r\n\r\n  get useTargetPicker() {\r\n    return game.settings.get(\"enhancedcombathud\", \"rangepicker\");\r\n  }\r\n\r\n  get useRangeFinder() {\r\n    return game.Levels3DPreview?._active && game.settings.get(\"enhancedcombathud\", \"rangefinder\");\r\n  }\r\n\r\n  get visible() {\r\n    return !!this.item;\r\n  }\r\n\r\n  async getData() {\r\n    if (!this.visible) return {};\r\n    const quantity = this.quantity;\r\n    const quantitySecondary = this.quantitySecondary;\r\n    return {\r\n      label: this.label,\r\n      icon: this.icon,\r\n      quantity: quantity,\r\n      hasQuantity: Number.isNumeric(quantity),\r\n      quantitySecondary: this.quantitySecondary,\r\n      hasQuantitySecondary: Number.isNumeric(quantitySecondary),\r\n    }\r\n  }\r\n\r\n  setItem(item) {\r\n    if (!this.isWeaponSet) return console.error(\"Cannot set item on non-weapon set button\");\r\n    this._item = item;\r\n    this.render();\r\n  }\r\n\r\n  async _onSetChange({sets, active}) {\r\n    const activeSet = sets[active];\r\n\r\n    const item = this.isPrimary ? activeSet.primary : activeSet.secondary;\r\n    this.setItem(item);    \r\n  }\r\n\r\n  activateListeners(html) {\r\n    this.element.onmouseup = this._onMouseUp.bind(this);\r\n    this.element.onmousedown = this._onMouseDown.bind(this);\r\n    this.element.onmouseenter = this._onMouseEnter.bind(this);\r\n    this.element.onmouseleave = this._onMouseLeave.bind(this);\r\n  }\r\n\r\n  async _onMouseDown(event) {\r\n  }\r\n\r\n  async _onMouseUp(event) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    if (event.button === 0) this._onPreLeftClick(event);\r\n    if (event.button === 2) this._onRightClick(event);\r\n  }\r\n\r\n  async _onMouseEnter(event) {\r\n    if(!this.token || !this.useRangeFinder) return;\r\n    showRangeRings(this.ranges.normal, this.ranges.long, this.token);\r\n    showRangeFinder(this.ranges.normal, this.token);\r\n  }\r\n\r\n  async _onMouseLeave(event) {\r\n    clearRanges();\r\n    clearRangeFinders();\r\n  }\r\n\r\n  async _onPreLeftClick(event) {\r\n    if (this.useTargetPicker && this.targets > 0) {\r\n      isTargetPicker = true;\r\n      const picker = new TargetPicker({token: this.token, targets: this.targets, ranges: this.ranges});\r\n      const result = await picker.promise;\r\n      isTargetPicker = false;\r\n      if(!result) return;\r\n    }\r\n    this._onLeftClick(event);\r\n  }\r\n\r\n  async _onLeftClick(event) {\r\n    console.error(\"ActionButton._onLeftClick not implemented\");\r\n  }\r\n\r\n  async _onRightClick(event) {\r\n  }\r\n\r\n  async _renderInner() {\r\n    await super._renderInner();\r\n    if (!this.item) {\r\n      this.element.style.display = \"none\";\r\n      return;\r\n    }\r\n    this.element.style.display = \"\";\r\n    this.element.style.backgroundImage = `url(\"${this.icon}\")`;\r\n    const quantity = this.quantity;\r\n    const quantitySecondary = this.quantitySecondary;\r\n    if (Number.isNumeric(quantity) || Number.isNumeric(quantitySecondary)) {\r\n      const isBothZero = (( quantity ?? 0) + (quantitySecondary ?? 0)) === 0;\r\n      this.element.style.filter = isBothZero ? \"grayscale(1)\" : null;\r\n    }\r\n    if (this.inActionPanel) {\r\n      this.element.classList.remove(\"feature-element\");\r\n      this.element.classList.add(\"action-element\", \"item-button\");\r\n      const title = this.element.querySelector(\".feature-element-title\");\r\n      if (title) {        \r\n        title.classList.remove(\"feature-element-title\");\r\n        title.classList.add(\"action-element-title\");\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nlet isTargetPicker = false;\r\n\r\nconst rangeRings = {\r\n  normal: null,\r\n  long: null\r\n}\r\n\r\nexport function clearRanges(force = false) {\r\n  if(!game.Levels3DPreview?._active) return;\r\n  if(isTargetPicker && !force) return;\r\n  if (rangeRings.normal) {\r\n    rangeRings.normal.remove();\r\n    rangeRings.normal = null;\r\n  }\r\n  if (rangeRings.long) {\r\n    rangeRings.long.remove();\r\n    rangeRings.long = null;\r\n  }\r\n}\r\n\r\nexport function showRangeRings(normal, long, object, tokenSizeOffset) {\r\n  if(!game.Levels3DPreview?._active) return;\r\n  clearRanges(true);\r\n  if (normal) rangeRings.normal = new game.Levels3DPreview.CONFIG.entityClass.RangeRingEffect(object, normal + tokenSizeOffset);\r\n  if (long) rangeRings.long = new game.Levels3DPreview.CONFIG.entityClass.RangeRingEffect(object, long + tokenSizeOffset, \"#ff0000\");\r\n}\r\n\r\nexport async function showRangeFinder(range, object){\r\n  if(!game.Levels3DPreview?._active || !range) return;\r\n  const sett = game.settings.get(\"enhancedcombathud\", \"rangefinder\")\r\n  const showRangeFinder = sett != \"none\";\r\n  if(!showRangeFinder) return;\r\n  const RangeFinder = game.Levels3DPreview.CONFIG.entityClass.RangeFinder; \r\n  game.Levels3DPreview.rangeFinders.forEach(rf => {\r\n        rf.destroy();\r\n  })\r\n  const visTokens = canvas.tokens.placeables.filter(t => t.visible)\r\n  for(let t of visTokens){\r\n    const dist = game.Levels3DPreview.helpers.ruler3d.measureMinTokenDistance(game.Levels3DPreview.tokens[object.id],game.Levels3DPreview.tokens[t.id])\r\n    const distDiff = range - dist;\r\n    if(distDiff >= 0){\r\n      new RangeFinder(t, {sources: [object], text: \"\"})\r\n    }else{\r\n      new RangeFinder(t, {\r\n        sources: [object],\r\n        text: `-${Math.abs(distDiff.toFixed(2))}${canvas.scene.grid.units}`,\r\n        style: {\r\n          color: 'rgb(210 119 119);',\r\n        }\r\n      })\r\n    }\r\n  }\r\n  \r\n}\r\n\r\nexport function clearRangeFinders() {\r\n  if(!game.Levels3DPreview?._active) return;\r\n  game.Levels3DPreview.rangeFinders.forEach(rf => {rf.destroy();})\r\n}","import {ArgonComponent} from \"../../component.js\";\r\n\r\nexport class MacroButton extends ArgonComponent{\r\n  constructor ({macro, inActionPanel=undefined}) {\r\n    super();\r\n    this._macro = macro;\r\n    this._inActionPanel = inActionPanel ?? false;\r\n  }\r\n\r\n  get classes() {\r\n    return [\"feature-element\"];\r\n  }\r\n\r\n  get inActionPanel() {\r\n    return this._inActionPanel;\r\n  }\r\n\r\n  get macro() {\r\n    return this._macro;\r\n  }\r\n\r\n  get label() {\r\n    return this.macro.name;\r\n  }\r\n\r\n  get icon() {\r\n    return this.macro.img;\r\n  }\r\n\r\n  get quantity() {\r\n    return null;\r\n  }\r\n\r\n  get quantitySecondary() {\r\n    return null;\r\n  }\r\n\r\n  get visible() {\r\n    return !!this.macro;\r\n  }\r\n\r\n  async getData() {\r\n    if (!this.visible) return {};\r\n    const quantity = this.quantity;\r\n    const quantitySecondary = this.quantitySecondary;\r\n    return {\r\n      label: this.label,\r\n      icon: this.icon,\r\n      quantity: quantity,\r\n      hasQuantity: Number.isNumeric(quantity),\r\n      quantitySecondary: this.quantitySecondary,\r\n      hasQuantitySecondary: Number.isNumeric(quantitySecondary),\r\n    }\r\n  }\r\n\r\n  activateListeners(html) {\r\n    this.element.onmouseup = this._onMouseUp.bind(this);\r\n    this.element.onmousedown = this._onMouseDown.bind(this);\r\n    this.element.onmouseenter = this._onMouseEnter.bind(this);\r\n    this.element.onmouseleave = this._onMouseLeave.bind(this);\r\n  }\r\n\r\n  async _onMouseDown(event) {\r\n  }\r\n\r\n  async _onMouseUp(event) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    if (event.button === 0) this._onPreLeftClick(event);\r\n    if (event.button === 2) this._onRightClick(event);\r\n  }\r\n\r\n  async _onMouseEnter(event) {\r\n  }\r\n\r\n  async _onMouseLeave(event) {\r\n  }\r\n\r\n  async _onPreLeftClick(event) {\r\n    this._onLeftClick(event);\r\n  }\r\n\r\n  async _onLeftClick(event) {\r\n    this.macro.execute();\r\n  }\r\n\r\n  async _onRightClick(event) {\r\n  }\r\n\r\n  async _renderInner() {\r\n    await super._renderInner();\r\n    if (!this.macro) {\r\n      this.element.style.display = \"none\";\r\n      return;\r\n    }\r\n    this.element.style.display = \"\";\r\n    this.element.style.backgroundImage = `url(\"${this.icon}\")`;\r\n    const quantity = this.quantity;\r\n    const quantitySecondary = this.quantitySecondary;\r\n    if (Number.isNumeric(quantity) || Number.isNumeric(quantitySecondary)) {\r\n      const isBothZero = (( quantity ?? 0) + (quantitySecondary ?? 0)) === 0;\r\n      this.element.style.filter = isBothZero ? \"grayscale(1)\" : null;\r\n    }\r\n    if (this.inActionPanel) {\r\n      this.element.classList.remove(\"feature-element\");\r\n      this.element.classList.add(\"action-element\", \"item-button\");\r\n      const title = this.element.querySelector(\".feature-element-title\");\r\n      if (title) {        \r\n        title.classList.remove(\"feature-element-title\");\r\n        title.classList.add(\"action-element-title\");\r\n      }\r\n    }\r\n  }\r\n}","import { ArgonComponent } from \"../../component.js\";\r\n\r\nexport class SplitButton extends ArgonComponent{\r\n  constructor (button1, button2) {\r\n    super();\r\n    this.button1 = button1;\r\n    this.button2 = button2;\r\n  }\r\n\r\n  get classes() {\r\n    return [\"action-element-container\"];\r\n  }\r\n\r\n  get colorScheme() {\r\n    return 0;\r\n  }\r\n\r\n  async _renderInner() {\r\n    await super._renderInner();\r\n    this.element.appendChild(this.button1.element);\r\n    this.element.appendChild(this.button2.element);\r\n    this.button1._parent = this;\r\n    this.button2._parent = this;\r\n    await this.button1.render();\r\n    await this.button2.render();\r\n  }\r\n}\r\n","import {ArgonComponent} from \"../component.js\";\r\nimport {localize} from \"../../CoreHud.js\";\r\nimport {ButtonPanelButton} from \"./buttons/buttonPanelButton.js\";\r\nimport {SplitButton} from \"./buttons/splitButton.js\";\r\n\r\nexport class ActionPanel extends ArgonComponent{\r\n\r\n  constructor (...args) {\r\n    super(...args);\r\n    this._buttons = [];\r\n  }\r\n\r\n  get classes() {\r\n    return [\"actions-container\"]\r\n  }\r\n\r\n  get label() {\r\n    return \"Action Panel\";\r\n  }\r\n\r\n  get buttons() {\r\n    return this._buttons;\r\n  }\r\n\r\n  get maxActions() {\r\n    return null;\r\n  }\r\n  \r\n  get currentActions() {\r\n    return null;\r\n  }\r\n\r\n  _onNewRound(combat) {\r\n  }\r\n\r\n  updateVisibility() {\r\n    if (!this._buttons) return;\r\n    let count = this._buttons.length;\r\n    for (const button of this._buttons) {\r\n      if (button.visible === false) count--;\r\n    }\r\n    this.element.classList.toggle(\"hidden\", count === 0);\r\n  }\r\n\r\n  updateActionUse() {\r\n    const actionsContainer = this.element.querySelector(\".actions-uses-container\");\r\n    if (this.maxActions === null || this.currentActions === null) {\r\n      actionsContainer.innerHTML = \"\";\r\n    }\r\n    if (!actionsContainer) return;\r\n\r\n    const childrenArray = Array.from(actionsContainer.children);\r\n\r\n    if (childrenArray.length !== this.maxActions) {\r\n      actionsContainer.innerHTML = \"\";\r\n      for (let i = 0; i < this.maxActions; i++) {\r\n        const action = document.createElement(\"div\");\r\n        action.classList.add(\"action-pip\");\r\n        actionsContainer.appendChild(action);\r\n      }\r\n    }\r\n\r\n    let availableActions = this.currentActions;\r\n    for (const child of childrenArray) {\r\n      child.classList.toggle(\"actions-used\", availableActions <= 0);\r\n      availableActions--;\r\n    }\r\n\r\n  }\r\n\r\n  updateItem(item) {\r\n    if (!this._buttons) return;\r\n    for (const button of this._buttons) {\r\n      if (button.item === item) button.render();\r\n      if (button instanceof ButtonPanelButton) button.updateItem(item);\r\n      if (button instanceof SplitButton) {\r\n        if (button.button1.item === item) button.button1.render();\r\n        if (button.button2.item === item) button.button2.render();\r\n      }\r\n    }\r\n  }\r\n\r\n  async _getButtons() {\r\n    console.warn(\"ActionPanel._getButtons() is not implemented\");\r\n    return [];\r\n  }\r\n\r\n  async getData() {\r\n    return {\r\n      maxActions: Array.apply(null, Array(this.maxActions)),\r\n    }\r\n  }\r\n\r\n  async _renderInner() {\r\n    await super._renderInner();\r\n    this.element.dataset.title = localize(this.label);\r\n    const buttons = await this._getButtons();\r\n    this._buttons = buttons;\r\n    for (const button of buttons) {\r\n      button._parent = this;\r\n      this.element.appendChild(button.element);\r\n      button.render();\r\n    }\r\n    this.updateActionUse();\r\n    this.updateVisibility();\r\n  }\r\n}","import { MODULE_ID } from \"../main.js\";\n\nexport class HandlebarsApplication extends foundry.applications.api.HandlebarsApplicationMixin(\n    foundry.applications.api.ApplicationV2,\n) {\n    constructor() {\n        super();\n        this.constructor.registerPositionSetting();\n        this.savePosition = foundry.utils.debounce(\n            this.savePosition.bind(this),\n            100,\n        );\n    }\n\n    static registerPositionSetting() {\n        if (\n            this.POSITION_SETTING_REGISTERED ||\n            !this.DEFAULT_OPTIONS.window?.savePosition\n        )\n            return;\n        this.POSITION_SETTING_REGISTERED = true;\n        game.settings.register(MODULE_ID, this.APP_ID + \"-position\", {\n            scope: \"client\",\n            config: false,\n            type: Object,\n            default: {},\n        });\n    }\n\n    static resetSavedPosition() {\n        game.settings.set(MODULE_ID, this.APP_ID + \"-position\", {});\n    }\n\n    savePosition(position) {\n        const positionToSave = {\n            left: position.left,\n            top: position.top,\n            width: position.width,\n            height: position.height,\n        };\n        if (positionToSave.width === \"auto\") delete positionToSave.width;\n        if (positionToSave.height === \"auto\") delete positionToSave.height;\n        game.settings.set(MODULE_ID, this.APP_ID + \"-position\", positionToSave);\n    }\n\n    setPosition(...args) {\n        const r = super.setPosition(...args);\n        if (this.constructor.POSITION_SETTING_REGISTERED)\n            this.savePosition(this.position);\n        return r;\n    }\n\n    static get APP_ID() {\n        return this.name\n            .split(/(?=[A-Z])/)\n            .join(\"-\")\n            .toLowerCase();\n    }\n\n    get APP_ID() {\n        return this.constructor.APP_ID;\n    }\n\n    static get PARTS() {\n        return {\n            content: {\n                template: `modules/${MODULE_ID}/templates/${this.APP_ID}.hbs`,\n                classes: [],\n                scrollable: [],\n            },\n        };\n    }\n\n    static get DEFAULT_OPTIONS() {\n        return {\n            tag: \"div\",\n            id: this.APP_ID,\n            window: {\n                title: `${MODULE_ID}.${this.APP_ID}.title`,\n                frame: true,\n                positioned: true,\n                icon: \"\",\n                controls: [],\n                minimizable: true,\n                resizable: false,\n                contentTag: \"section\",\n                contentClasses: [],\n                savePosition: false,\n                preventEscapeClose: false\n            },\n            actions: {},\n            form: {\n                handler: undefined,\n                submitOnChange: false,\n                closeOnSubmit: false,\n            },\n            position: {\n                width: 560,\n                height: \"auto\",\n            },\n        };\n    }\n\n    async _prepareContext(options) {\n        if (this.getData) return this.getData();\n        const data = {};\n        return { data };\n    }\n\n    activateListeners() {}\n\n    _onRender(context, options) {\n        super._onRender(context, options);\n        if (this.constructor.DEFAULT_OPTIONS.window.preventEscapeClose) {\n            foundry.applications.instances.delete(this.id, this);\n            this.window.close.style.display = \"none\"\n        }\n        const html = this.element;\n        if (this.activateListeners) this.activateListeners(html);\n    }\n\n    async render(options1 = {}, options2 = {}) {\n        const activeOptions =\n            typeof options1 === \"boolean\" ? options2 : options1;\n        if (\n            !activeOptions.position &&\n            this.constructor.POSITION_SETTING_REGISTERED\n        )\n            activeOptions.position = game.settings.get(\n                MODULE_ID,\n                this.APP_ID + \"-position\",\n            );\n        return super.render(options1, options2);\n    }\n}\n\nexport function dynamicImport(url) {\n    const dynamicImport = new Function(\"url\", \"return import(url)\");\n    return dynamicImport(url);\n}\n\nexport function confirm(title, content, options = {}) {\n    title = l(title);\n    content = l(content);\n    return foundry.applications.api.DialogV2.confirm({\n        window: { title },\n        content,\n    });\n}\n\nexport function prompt(title, content, options = {}) {\n    title = l(title);\n    content = l(content);\n    return foundry.applications.api.DialogV2.prompt({\n        window: { title },\n        content,\n        ...options,\n    });\n}\n\nexport function deepClone(obj) {\n    return foundry.utils.deepClone(obj);\n}\n\nexport function expandObject(obj) {\n    return foundry.utils.expandObject(obj);\n}\n\nexport function flattenObject(obj) {\n    return foundry.utils.flattenObject(obj);\n}\n\nexport function mergeObject(obj, other) {\n    return foundry.utils.mergeObject(obj, other);\n}\n\nexport function mergeClone(obj, other) {\n    obj = foundry.utils.deepClone(obj);\n    other = foundry.utils.deepClone(other);\n    return foundry.utils.mergeObject(obj, other);\n}\n\nexport function randomID(length = 20) {\n    return foundry.utils.randomID(length);\n}\n\nexport function setProperty(obj, key, value) {\n    return foundry.utils.setProperty(obj, key, value);\n}\n\nexport function getProperty(obj, key) {\n    return foundry.utils.getProperty(obj, key);\n}\n\nexport function l(x) {\n    return game.i18n.localize(x);\n}\n\nexport function easeInSine(x) {\n    return 1 - Math.cos((x * Math.PI) / 2);\n}\n\nexport function easeOutSine(x) {\n    return Math.sin((x * Math.PI) / 2);\n}\n\nexport function easeInOutSine(x) {\n    return -(Math.cos(Math.PI * x) - 1) / 2;\n}\n\nexport function easeInQuad(x) {\n    return x * x;\n}\n\nexport function easeOutQuad(x) {\n    return 1 - (1 - x) * (1 - x);\n}\n\nexport function easeInOutQuad(x) {\n    return x < 0.5 ? 2 * x * x : 1 - Math.pow(-2 * x + 2, 2) / 2;\n}\n\nexport function easeInCubic(x) {\n    return x * x * x;\n}\n\nexport function easeOutCubic(x) {\n    return 1 - Math.pow(1 - x, 3);\n}\n\nexport function easeInOutCubic(x) {\n    return x < 0.5 ? 4 * x * x * x : 1 - Math.pow(-2 * x + 2, 3) / 2;\n}\n\nexport function easeInQuart(x) {\n    return x * x * x * x;\n}\n\nexport function easeOutQuart(x) {\n    return 1 - Math.pow(1 - x, 4);\n}\n\nexport function easeInOutQuart(x) {\n    return x < 0.5 ? 8 * x * x * x * x : 1 - Math.pow(-2 * x + 2, 4) / 2;\n}\n\nexport function easeInQuint(x) {\n    return x * x * x * x * x;\n}\n\nexport function easeOutQuint(x) {\n    return 1 - Math.pow(1 - x, 5);\n}\n\nexport function easeInOutQuint(x) {\n    return x < 0.5 ? 16 * x * x * x * x * x : 1 - Math.pow(-2 * x + 2, 5) / 2;\n}\n\nexport function easeInExpo(x) {\n    return x == 0 ? x : Math.pow(2, 10 * (x - 1));\n}\n\nexport function easeOutExpo(x) {\n    return x == 1 ? x : 1 - Math.pow(2, -10 * x);\n}\n\nexport function easeInOutExpo(x) {\n    return x == 0\n        ? 0\n        : x == 1\n          ? 1\n          : x < 0.5\n            ? Math.pow(2, 20 * x - 10) / 2\n            : (2 - Math.pow(2, -20 * x + 10)) / 2;\n}\n\nexport function easeInCirc(x) {\n    return 1 - Math.sqrt(1 - Math.pow(x, 2));\n}\n\nexport function easeOutCirc(x) {\n    return Math.sqrt(1 - Math.pow(x - 1, 2));\n}\n\nexport function easeInOutCirc(x) {\n    return x < 0.5\n        ? 1 - Math.sqrt(1 - Math.pow(2 * x, 2)) / 2\n        : (Math.sqrt(1 - Math.pow(-2 * x + 2, 2)) + 1) / 2;\n}\n\nexport function easeInElastic(x) {\n    let s = 1.70158;\n    let p = 0;\n    let a = 1;\n    if (x == 0) return 0;\n    if ((x /= 1) == 1) return 1;\n    if (!p) p = 0.3;\n    if (a < 1) {\n        a = 1;\n        s = p / 4;\n    } else {\n        s = (p / (2 * Math.PI)) * Math.asin(1 / a);\n    }\n    return -(\n        a *\n        Math.pow(2, 10 * (x -= 1)) *\n        Math.sin(((x * 1 - s) * (2 * Math.PI)) / p)\n    );\n}\n\nexport function easeOutElastic(x) {\n    let s = 1.70158;\n    let p = 0;\n    let a = 1;\n    if (x == 0) return 0;\n    if ((x /= 1) == 1) return 1;\n    if (!p) p = 0.3;\n    if (a < 1) {\n        a = 1;\n        s = p / 4;\n    } else {\n        s = (p / (2 * Math.PI)) * Math.asin(1 / a);\n    }\n    return (\n        a * Math.pow(2, -10 * x) * Math.sin(((x * 1 - s) * (2 * Math.PI)) / p) +\n        1\n    );\n}\n\nexport function easeInOutElastic(x) {\n    let s = 1.70158;\n    let p = 0;\n    let a = 1;\n    if (x == 0) return 0;\n    if ((x /= 1 / 2) == 2) return 1;\n    if (!p) p = 0.3 * (0.3 + 1);\n    if (a < 1) {\n        a = 1;\n        s = p / 4;\n    } else {\n        s = (p / (2 * Math.PI)) * Math.asin(1 / a);\n    }\n    if (x < 1)\n        return (\n            -0.5 *\n            (a *\n                Math.pow(2, 10 * (x -= 1)) *\n                Math.sin(((x * 1 - s) * (2 * Math.PI)) / p))\n        );\n    return (\n        a *\n            Math.pow(2, -10 * (x -= 1)) *\n            Math.sin(((x * 1 - s) * (2 * Math.PI)) / p) *\n            0.5 +\n        1\n    );\n}\n\nexport function easeInBack(x) {\n    let s = 1.70158;\n    return x * x * ((s + 1) * x - s);\n}\n\nexport function easeOutBack(x) {\n    let s = 1.70158;\n    return 1 - (1 - x) * (1 - x) * ((s + 1) * x - s);\n}\n\nexport function easeInOutBack(x) {\n    let s = 1.70158;\n    if ((x /= 1 / 2) < 1)\n        return (1 / 2) * (x * x * (((s *= 1.525) + 1) * x - s));\n    return (1 / 2) * ((x -= 2) * x * (((s *= 1.525) + 1) * x + s) + 2);\n}\n\nexport function addColorPicker(input, { value, opacity = false } = {}) {\n    const hexToComponents = (hex) => {\n        const hexColor =\n            hex.length < 9 ? hex + \"f\".repeat(9 - hex.length) : hex;\n\n        const colorValue = hexColor.slice(0, 7);\n        const alphaValue = parseInt(hexColor.slice(7, 9), 16) / 255;\n        return { color: colorValue, alpha: alphaValue };\n    };\n\n    const componentsToHex = (color, alpha) => {\n        const colorValue = color.replace(\"#\", \"\");\n        const alphaValue = Math.round(alpha * 255)\n            .toString(16)\n            .padStart(2, \"0\");\n        return `#${colorValue}${alphaValue}`;\n    };\n\n    const textInput =\n        input.type === \"text\"\n            ? input\n            : input.querySelector(\"input[type='text']\");\n    if (textInput.classList.contains(\"color-picker-added\")) return;\n\n    textInput.classList.add(\"color-picker-added\");\n    textInput.classList.add(\"color\");\n    const parent = textInput.parentElement;\n\n    value ??= textInput.value || \"#000000ff\";\n\n    const { color, alpha } = hexToComponents(value);\n\n    const colorPickerElement = document.createElement(\"input\");\n    colorPickerElement.setAttribute(\"type\", \"color\");\n    if (opacity) colorPickerElement.style.maxWidth = \"2rem\";\n\n    const alphaPickerHtml = `<range-picker min=\"0\" max=\"1\" step=\"0.01\" value=\"${alpha}\" data-tooltip=\"Alpha\" style=\"min-width: 6rem;\"></range-picker>`;\n    const alphaPickerElement = new DOMParser()\n        .parseFromString(alphaPickerHtml, \"text/html\")\n        .querySelector(\"range-picker\");\n\n    const updateTextInput = (color, alpha) => {\n        const hex = componentsToHex(color, alpha);\n        if (!opacity) textInput.value = hex.slice(0, 7);\n        else textInput.value = hex;\n        textInput.dispatchEvent(new Event(\"change\"));\n    };\n\n    colorPickerElement.value = color;\n    alphaPickerElement.value = alpha;\n\n    colorPickerElement.addEventListener(\"input\", (event) => {\n        const color = event.target.value;\n        const alpha = alphaPickerElement.value;\n        updateTextInput(color, alpha);\n    });\n\n    alphaPickerElement.addEventListener(\"input\", (event) => {\n        const alpha = event.target.value;\n        const color = colorPickerElement.value;\n        updateTextInput(color, alpha);\n    });\n\n    textInput.after(colorPickerElement);\n    opacity && colorPickerElement.after(alphaPickerElement);\n}\n","import { ArgonComponent } from \"../component.js\";\r\n\r\n\r\nexport class Effect extends ArgonComponent {\r\n    constructor(effect) {\r\n        super();\r\n        this.effect = effect;\r\n    }\r\n\r\n    get classes() {\r\n        return [\"effect-icon\"];\r\n    }\r\n\r\n    get label() {\r\n        return this.effect.name;\r\n    }\r\n\r\n    get icon() {\r\n        return this.effect.img;\r\n    }\r\n\r\n    get colorScheme() {\r\n        return 0;\r\n    }\r\n\r\n    get hasTooltip() {\r\n        return true;\r\n    }\r\n\r\n    async getTooltipData() {\r\n        return {\r\n            title: this.label,\r\n            description: await foundry.applications.ux.TextEditor.implementation.enrichHTML(this.effect.tooltip),\r\n        };\r\n    }\r\n\r\n    async getData() {\r\n        return {\r\n            label: this.label,\r\n            icon: this.icon,\r\n        };\r\n    }\r\n\r\n    activateListeners(html) {\r\n        this.element.onmouseup = this._onMouseUp.bind(this);\r\n        this.element.onmousedown = this._onMouseDown.bind(this);\r\n        this.element.onmouseenter = this._onMouseEnter.bind(this);\r\n        this.element.onmouseleave = this._onMouseLeave.bind(this);\r\n    }\r\n\r\n    async _onMouseDown(event) {}\r\n\r\n    async _onMouseUp(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        if (event.button === 0) this._onLeftClick(event);\r\n        if (event.button === 2) this._onRightClick(event);\r\n    }\r\n\r\n    async _onMouseEnter(event) {}\r\n\r\n    async _onMouseLeave(event) {}\r\n\r\n    async _onLeftClick(event) {\r\n        console.error(\"ActionButton._onLeftClick not implemented\");\r\n    }\r\n\r\n    async _onRightClick(event) {}\r\n}\r\n","import { HandlebarsApplication, mergeClone } from \"../../../lib/utils.js\";\r\nimport { ArgonComponent } from \"../component.js\";\r\nimport {Effect} from \"./effect.js\";\r\n\r\nexport class PortraitPanel extends ArgonComponent {\r\n    constructor(...args) {\r\n        super(...args);\r\n        this.refresh = foundry.utils.debounce(this.refresh.bind(this), 100);\r\n    }\r\n\r\n    get classes() {\r\n        return [\"portrait-hud\"];\r\n    }\r\n\r\n    get name() {\r\n        return this.actor.name;\r\n    }\r\n\r\n    get image() {\r\n        return this.actor.img;\r\n    }\r\n\r\n    get description() {\r\n        return \"\";\r\n    }\r\n\r\n    get isDead() {\r\n        return false;\r\n    }\r\n\r\n    get isDying() {\r\n        return false;\r\n    }\r\n\r\n    get deathIcon() {\r\n        return \"fas fa-skull\";\r\n    }\r\n\r\n    get successes() {\r\n        return 0;\r\n    }\r\n\r\n    get failures() {\r\n        return 0;\r\n    }\r\n\r\n    get configurationTemplate() {\r\n        return null;\r\n    }\r\n\r\n    get effectClass() {\r\n        return Effect;\r\n    }\r\n\r\n    async getEffects() {\r\n        const effects = [];\r\n        for(const effect of this.actor.temporaryEffects) {\r\n            effects.push({img: effect.img, name: effect.name, uuid: effect.uuid,tooltip: await foundry.applications.ux.TextEditor.implementation.enrichHTML(effect.description)});\r\n        }\r\n        return effects;\r\n    }\r\n\r\n    async getData() {\r\n        const data = {\r\n            name: this.name,\r\n            image: this.image,\r\n            description: this.description,\r\n            isDead: this.isDead,\r\n            isDying: this.isDying,\r\n            deathIcon: this.deathIcon,\r\n            successes: this.successes,\r\n            failures: this.failures,\r\n            playerDetailsBottom: game.settings.get(\"enhancedcombathud\", \"playerDetailsBottom\"),\r\n        };\r\n        return data;\r\n    }\r\n\r\n    async activateListeners(html) {\r\n        super.activateListeners(html);\r\n        html.querySelector(\".death-save-btn\").addEventListener(\"click\", this._onDeathSave.bind(this));\r\n        if (this.configurationTemplate) html.querySelector(\"#argon-actor-config\")?.addEventListener(\"click\", this._onConfigure.bind(this));\r\n        else html.querySelector(\".portrait-actor-configuration\")?.remove();\r\n        const toggleMinimizeButton = this._buttons.find((button) => button.id === \"toggle-minimize\");\r\n        if (toggleMinimizeButton) {\r\n            toggleMinimizeButton.element.addEventListener(\"click\", (e) => {\r\n                toggleMinimizeButton.element.classList.toggle(\"fa-flip-vertical\");\r\n            });\r\n        }\r\n    }\r\n\r\n    async _onDeathSave(event) {\r\n        console.error(\"Argon: PortraitPanel._onDeathSave not implemented\");\r\n    }\r\n\r\n    async getStatBlocks() {\r\n        return [];\r\n    }\r\n\r\n    async _getButtons() {\r\n        return [\r\n            {\r\n                id: \"roll-initiative\",\r\n                icon: \"fas fa-dice-d20\",\r\n                label: \"Roll Initiative\",\r\n                onClick: async (e) => {\r\n                    if(this.token.combatant?.initiative !== undefined) {\r\n                        const response = await foundry.applications.api.DialogV2.confirm({\r\n                            window: {\r\n                                title: game.i18n.localize(`enhancedcombathud.confirmRerollInitiativeTitle`),\r\n                            },\r\n                            content: game.i18n.localize(`enhancedcombathud.confirmRerollInitiativeContent`),\r\n                            defaultYes: false,\r\n                        });\r\n                        if (!response) return;\r\n                    } \r\n                    this.actor.rollInitiative({ rerollInitiative: true, createCombatants: true })\r\n                },\r\n            },\r\n            {\r\n                id: \"open-sheet\",\r\n                icon: \"fas fa-suitcase\",\r\n                label: \"Open Character Sheet\",\r\n                onClick: (e) => this.actor.sheet.render(true),\r\n            },\r\n            {\r\n                id: \"toggle-minimize\",\r\n                icon: \"fas fa-caret-down\",\r\n                label: \"Minimize\",\r\n                onClick: (e) => ui.ARGON.toggleMinimize(),\r\n            },\r\n        ];\r\n    }\r\n\r\n    refresh() {\r\n        this.render();\r\n    }\r\n\r\n    async _renderInner(data) {\r\n        await super._renderInner(data);\r\n        const statBlocks = await this.getStatBlocks();\r\n        for (const block of statBlocks) {\r\n            const sb = document.createElement(\"div\");\r\n            sb.classList.add(\"portrait-stat-block\");\r\n            for (const stat of block) {\r\n                const span = document.createElement(\"span\");\r\n                span.innerText = stat.text;\r\n                span.style.color = stat.color;\r\n                if (stat.id != undefined) span.id = stat.id;\r\n                sb.appendChild(span);\r\n            }\r\n            this.element.appendChild(sb);\r\n        }\r\n        this._buttons = await this._getButtons();\r\n        const buttonsContainer = this.element.querySelector(\".player-buttons\");\r\n        for (const button of this._buttons) {\r\n            const btn = document.createElement(\"div\");\r\n            btn.classList.add(\"player-button\");\r\n            btn.innerHTML = `<i class=\"${button.icon}\"></i>`;\r\n            btn.dataset.tooltip = button.label;\r\n            btn.onclick = button.onClick;\r\n            button.element = btn;\r\n            buttonsContainer.appendChild(btn);\r\n        }\r\n        const deathContainer = this.element.querySelector(\".death-saves\");\r\n        deathContainer.classList.remove(\"no-buttons\");\r\n        if (!this.isDead && !this.isDying) {\r\n            deathContainer.classList.add(\"hidden\");\r\n        } else {\r\n            if (this.isDead) {\r\n                deathContainer.childNodes.forEach((node) => node.classList && node.classList.add(\"hidden\"));\r\n                deathContainer.classList.add(\"no-buttons\");\r\n                const deathBtn = deathContainer.querySelector(\".death-save-btn\");\r\n                deathBtn.classList.remove(\"hidden\");\r\n                deathBtn.style.pointerEvents = \"none\";\r\n            }\r\n        }\r\n        const effectsContainer = this.element.querySelector(\".effects-container\");\r\n        const effects = await this.getEffects();\r\n        const effectElements = effects.map((effect) => new this.effectClass(effect));\r\n        effectsContainer.innerHTML = \"\";\r\n        for (const effect of effectElements) {\r\n            effect.element.addEventListener(\"contextmenu\", async (event) => {\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n                const uuid = effect.effect.uuid;\r\n                const effectToDelete = await fromUuid(uuid);\r\n                const statusEffect = CONFIG.statusEffects.find((s) => s.img === effectToDelete.img);\r\n\r\n                const response = await foundry.applications.api.DialogV2.confirm({\r\n                    window: {\r\n                        title: game.i18n.localize(`enhancedcombathud.deleteEffectTitle`),\r\n                    },\r\n                    content: game.i18n.localize(`enhancedcombathud.deleteEffectContent`) + game.i18n.localize(effect?.label ?? statusEffect?.name ?? \"\") + \"?\",\r\n                    defaultYes: false,\r\n                });\r\n                if (!response) return;\r\n                if (!effectToDelete) {\r\n                    this.token?.toggleEffect(uuid);\r\n                    return;\r\n                }\r\n                await effectToDelete.delete();\r\n                this.render(true);\r\n            });\r\n            effectsContainer.appendChild(effect.element);\r\n        }\r\n        await Promise.all(effectElements.map((effect) => effect.render()));\r\n    }\r\n\r\n    async _onConfigure(event) {\r\n        event.preventDefault();\r\n        const template = this.configurationTemplate;\r\n\r\n        new (getArgonPortraitConfig(template))(this.actor).render({force: true});\r\n    }\r\n}\r\n\r\nfunction getArgonPortraitConfig(template) {\r\n    return class ArgonPortraitConfig extends HandlebarsApplication {\r\n        constructor(actor) {\r\n            super();\r\n            this.actor = actor;\r\n        }\r\n\r\n        get title() {\r\n            return `${game.i18n.localize(\"Configure\")} ${this.actor.name}`;\r\n        }\r\n\r\n        static get DEFAULT_OPTIONS() {\r\n            return mergeClone(super.DEFAULT_OPTIONS, {\r\n                tag: \"form\",\r\n                id: \"argon-actor-config-form\",\r\n                window: {\r\n                    contentClasses: [\"standard-form\"],\r\n                },\r\n                form: {\r\n                    handler: this.#onSubmit,\r\n                    closeOnSubmit: true,\r\n                },\r\n                position: {\r\n                    width: 400\r\n                }\r\n            });\r\n        }\r\n\r\n        static get PARTS() {\r\n            return {\r\n                content: {\r\n                    template: template,\r\n                    classes: [\"standard-form\", \"scrollable\"],\r\n                },\r\n                footer: {\r\n                    template: \"templates/generic/form-footer.hbs\",\r\n                }\r\n            };\r\n        }\r\n\r\n        _prepareContext(...args) {\r\n            const saveButton = {\r\n                type: \"submit\",\r\n                action: \"submit\",\r\n                icon: \"fas fa-save\",\r\n                label: \"Save\",\r\n            };\r\n            return { actor: this.actor, ...this.actor, buttons: [saveButton] };\r\n        }\r\n\r\n        static async #onSubmit() {\r\n            const form = this.element;\r\n            const formData = new foundry.applications.ux.FormDataExtended(form).object;\r\n\r\n            await this.actor.update(formData);\r\n            ui.ARGON.refresh();\r\n        }\r\n    }\r\n}","import { ArgonComponent } from \"../component.js\";\r\n\r\nexport class WeaponSets extends ArgonComponent {\r\n    get classes() {\r\n        return [\"weapon-sets\"];\r\n    }\r\n\r\n    async activateListeners(html) {\r\n        super.activateListeners(html);\r\n        this.element.querySelectorAll(\".set\").forEach((set) => {\r\n            //set.addEventListener(\"dragover\", this._onDragOver.bind(this));\r\n            set.addEventListener(\"drop\", this._onDrop.bind(this));\r\n            set.addEventListener(\"click\", this._onClick.bind(this));\r\n            set.addEventListener(\"dragstart\", this._onDragStart.bind(this));\r\n            set.addEventListener(\"dragend\", this._onDragEnd.bind(this));\r\n            set.addEventListener(\"contextmenu\", this._onContextMenu.bind(this));\r\n        });\r\n        const activeSet = this.actor.getFlag(\"enhancedcombathud\", \"activeWeaponSet\") || \"1\";\r\n        this.element.querySelectorAll(\".weapon-set\").forEach((element) => {\r\n            element.classList.toggle(\"active\", element.dataset.set === activeSet);\r\n        });\r\n\r\n        this.onSetChange(await this.getSetData());\r\n    }\r\n\r\n    async getSetData() {\r\n        const sets = await this._getSets();\r\n        const active = this.actor.getFlag(\"enhancedcombathud\", \"activeWeaponSet\") || \"1\";\r\n        return { sets, active };\r\n    }\r\n\r\n    async _getSets() {\r\n        const sets = foundry.utils.mergeObject(await this.getDefaultSets(), foundry.utils.deepClone(this.actor.getFlag(\"enhancedcombathud\", \"weaponSets\") || {}));\r\n\r\n        for (const [set, slots] of Object.entries(sets)) {\r\n            slots.primary = slots.primary ? await fromUuid(slots.primary) : null;\r\n            slots.secondary = slots.secondary ? await fromUuid(slots.secondary) : null;\r\n        }\r\n        return sets;\r\n    }\r\n\r\n    async getDefaultSets() {\r\n        return {\r\n            1: {\r\n                primary: null,\r\n                secondary: null,\r\n            },\r\n            2: {\r\n                primary: null,\r\n                secondary: null,\r\n            },\r\n            3: {\r\n                primary: null,\r\n                secondary: null,\r\n            },\r\n        };\r\n    }\r\n\r\n    async getData() {\r\n        return {\r\n            sets: await this._getSets(),\r\n        };\r\n    }\r\n\r\n    async _onDrop(event) {\r\n        try {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            const data = JSON.parse(event.dataTransfer.getData(\"text/plain\"));\r\n            if (data?.type !== \"Item\") return;\r\n            const set = event.currentTarget.dataset.set;\r\n            const slot = event.currentTarget.dataset.slot;\r\n            const sets = this.actor.getFlag(\"enhancedcombathud\", \"weaponSets\") || {};\r\n            sets[set] = sets[set] || {};\r\n            sets[set][slot] = data.uuid;\r\n\r\n            await this.actor.setFlag(\"enhancedcombathud\", \"weaponSets\", sets);\r\n            await this.render();\r\n        } catch (error) {}\r\n    }\r\n\r\n    async _onClick(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        const set = event.currentTarget.dataset.set;\r\n        this.element.querySelectorAll(\".weapon-set\").forEach((element) => {\r\n            element.classList.toggle(\"active\", element.dataset.set === set);\r\n        });\r\n        await this.actor.setFlag(\"enhancedcombathud\", \"activeWeaponSet\", set);\r\n        this.onSetChange(await this.getSetData());\r\n    }\r\n\r\n    async _onDragEnd(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        const set = event.currentTarget.dataset.set;\r\n        const slot = event.currentTarget.dataset.slot;\r\n        const sets = this.actor.getFlag(\"enhancedcombathud\", \"weaponSets\") || {};\r\n        sets[set] = sets[set] || {};\r\n        sets[set][slot] = null;\r\n\r\n        await this.actor.setFlag(\"enhancedcombathud\", \"weaponSets\", sets);\r\n        await this.render();\r\n    }\r\n\r\n    async _onDragStart(event) {\r\n        const set = event.currentTarget.dataset.set;\r\n        const slot = event.currentTarget.dataset.slot;\r\n        const sets = this.actor.getFlag(\"enhancedcombathud\", \"weaponSets\") || {};\r\n        sets[set] = sets[set] || {};\r\n        const uuid = sets[set][slot];\r\n        if (!uuid) return;\r\n        event.dataTransfer.setData(\r\n            \"text/plain\",\r\n            JSON.stringify({\r\n                type: \"Item\",\r\n                uuid,\r\n            }),\r\n        );\r\n    }\r\n\r\n    async _onContextMenu(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        const set = event.currentTarget.dataset.set;\r\n        const slot = event.currentTarget.dataset.slot;\r\n        const sets = this.actor.getFlag(\"enhancedcombathud\", \"weaponSets\") || {};\r\n        sets[set] = sets[set] || {};\r\n        sets[set][slot] = null;\r\n\r\n        await this.actor.setFlag(\"enhancedcombathud\", \"weaponSets\", sets);\r\n        await this.render();\r\n    }\r\n\r\n    async onSetChange({ sets, active }) {\r\n        Hooks.callAll(\"argon-onSetChangeUpdateItem\", { sets, active });\r\n        Hooks.callAll(\"argon-onSetChangeComplete\", { sets, active });\r\n        await this._onSetChange({ sets, active });\r\n    }\r\n\r\n    async _onSetChange({ sets, active }) {\r\n        console.error(\"WeaponSets._onSetChange() is not implemented\");\r\n    }\r\n}\r\n","import { ArgonComponent } from \"../component.js\";\r\n\r\nconst movementColors = [\"base-movement\", \"dash-movement\", \"danger-movement\"];\r\nexport class MovementHud extends ArgonComponent {\r\n\r\n  constructor(...args) {\r\n    super(...args);\r\n    this._movementUsed = 0;\r\n  }\r\n\r\n  get visible() {\r\n    return game.combat?.started;\r\n  }\r\n\r\n  get classes() {\r\n    return [\"movement-hud\"]\r\n  }\r\n\r\n  get movementUsed() {\r\n    if(canvas.scene.grid.type) return this.token.document.movement.history.spaces;\r\n    return Math.round(this.token.document.movement.history.distance / canvas.scene.dimensions.distance);\r\n  }\r\n\r\n  set movementUsed(value) {\r\n    this._movementUsed = Math.max(value, 0);\r\n  }\r\n\r\n  get movementMax() { }\r\n\r\n  get movementColor() {\r\n    return movementColors[Math.min(Math.floor((this.movementUsed) / this.movementMax), 2)];\r\n  }\r\n\r\n  get movementIcon() {\r\n    return CONFIG.Token.movement?.actions[this.movementMode]?.img;\r\n  }\r\n\r\n  get movementMode() {\r\n    return this.token.document.movementAction || \"walk\";\r\n  }\r\n\r\n  getData() {\r\n    return {\r\n      movementIcon: this.movementIcon\r\n    };\r\n  }\r\n\r\n  onTokenUpdate(updates, context) {\r\n    if (updates.movementAction) this.render();\r\n    if (updates.x === undefined && updates.y === undefined) return;\r\n    this.updateMovement();\r\n  }\r\n\r\n  updateMovement() {\r\n    if (!game.combat?.started) this.movementUsed = 0;\r\n    const movementColor = this.movementColor;\r\n\r\n    const disabledBars = (this.movementUsed % this.movementMax) || 0;\r\n\r\n    const barsNumber = this.movementMax - disabledBars;\r\n\r\n    const barsContainer = this.element.querySelector(\".movement-spaces\");\r\n\r\n    let newHtml = \"\";\r\n    for (let i = 0; i < barsNumber; i++) {\r\n      newHtml += `<div class=\"movement-space  ${movementColor}\"></div>`;\r\n    }\r\n    for (let i = 0; i < disabledBars; i++) {\r\n      newHtml += `<div class=\"movement-space\"></div>`;\r\n    }\r\n    this.element.querySelector(\".movement-current\").innerText = barsNumber;\r\n    this.element.querySelector(\".movement-max\").innerText = ((Math.floor((this.movementUsed) / this.movementMax) + 1) * this.movementMax) || 0;\r\n    barsContainer.innerHTML = newHtml;\r\n  }\r\n\r\n  _onNewRound(combat) {\r\n    this.movementUsed = 0;\r\n    this.updateMovement();\r\n  }\r\n\r\n  _onCombatEnd(combat) {\r\n    this.movementUsed = 0;\r\n    this.updateMovement();\r\n  }\r\n\r\n  async render(...args) {\r\n    await super.render(...args);\r\n    this.updateMovement();\r\n  }\r\n}\r\n","import {ArgonComponent} from \"../component.js\";\r\n\r\nexport class ButtonHud extends ArgonComponent {\r\n\r\n  constructor (...args) {\r\n    super(...args);\r\n  }\r\n\r\n  get classes() {\r\n    return [\"movement-hud\"]\r\n  }\r\n\r\n  async _getButtons() {\r\n    console.error(\"ButtonHud._getButtons() is not implemented\");\r\n    return [];\r\n  }\r\n\r\n  async render(...args) {\r\n    await super.render(...args);\r\n    this.buttons = await this._getButtons();\r\n    for(const button of this.buttons) {\r\n      const buttonEl = document.createElement(\"div\");\r\n      buttonEl.classList.add(\"button-hud-button\");\r\n      if(this.buttons.length > 4) buttonEl.classList.add(\"button-hud-button-small\");\r\n      const i = document.createElement(\"i\");\r\n      if (button.color) i.style.color = button.color;\r\n      if (button.label && this.buttons.length > 4) buttonEl.dataset.tooltip = game.i18n.localize(button.label);\r\n      i.classList.add(...button.icon.split(\" \"));\r\n      buttonEl.appendChild(i);\r\n      if (button.label && this.buttons.length <= 4) {\r\n        const span = document.createElement(\"span\");\r\n        span.textContent = game.i18n.localize(button.label);\r\n        buttonEl.appendChild(span);\r\n      }\r\n      buttonEl.addEventListener(\"click\", button.onClick);\r\n      this.element.appendChild(buttonEl);\r\n    }\r\n    this.element.style.display = \"grid\";\r\n    if (this.buttons.length <= 4) {\r\n      this.element.style.gridTemplateRows = `repeat(${this.buttons.length}, 1fr)`;\r\n    } else {\r\n      this.element.style.gridTemplateColumns = `repeat(2, 1fr)`;\r\n      this.element.style.gridTemplateRows = `repeat(${Math.ceil(this.buttons.length / 2)}, 1fr)`;\r\n    }\r\n  }\r\n}","import { ActionPanel } from \"../components/main/actionPanel.js\";\r\nimport { AccordionPanel } from \"../components/main/buttonPanel/accordionPanel.js\";\r\nimport { AccordionPanelCategory } from \"../components/main/buttonPanel/accordionPanelCategory.js\";\r\nimport { MacroButton } from \"../components/main/buttons/macroButton.js\";\r\nimport { ButtonPanelButton } from \"../components/main/buttons/buttonPanelButton.js\";\r\n\r\nexport class MacroPanel extends ActionPanel {\r\n    constructor(...args) {\r\n        super(...args);\r\n    }\r\n\r\n    get label() {\r\n        return \"enhancedcombathud.hud.macro.name\";\r\n    }\r\n\r\n    async _getButtons() {\r\n        return [new MacroPanelButton({ color: \"red\" })];\r\n    }\r\n}\r\n\r\nclass MacroPanelButton extends ButtonPanelButton {\r\n    constructor({ color, icon }) {\r\n        super();\r\n        this._type = \"macro\";\r\n        this._color = color;\r\n        this._icon = icon || `icons/svg/dice-target.svg`;\r\n    }\r\n\r\n    get hasContents() {\r\n        return true;\r\n    }\r\n\r\n    get colorScheme() {\r\n        return this._color;\r\n    }\r\n\r\n    get id() {\r\n        return `${this.type}-${this.color}`;\r\n    }\r\n\r\n    get label() {\r\n        return \"enhancedcombathud.hud.macro.name\";\r\n    }\r\n\r\n    get type() {\r\n        return this._type;\r\n    }\r\n\r\n    get icon() {\r\n        return this._icon;\r\n    }\r\n\r\n    async _getPanel() {\r\n        const pages = [1, 2, 3, 4, 5];\r\n        const accordionPanels = [];\r\n        const pageLabel = game.i18n.localize(\"enhancedcombathud.hud.macro.page\");\r\n        for (const pageNum of pages) {\r\n            const macros = game.user\r\n                .getHotbarMacros(pageNum)\r\n                .filter((m) => m.macro)\r\n                .map((m) => m.macro);\r\n            const buttons = macros.map((macro) => new MacroButton({ macro }));\r\n            if (buttons.length) {\r\n                accordionPanels.push(new AccordionPanelCategory({ label: `${pageLabel} ${pageNum}`, buttons }));\r\n            }\r\n        }\r\n        return new AccordionPanel({ id: this.id, accordionPanelCategories: accordionPanels });\r\n    }\r\n}\r\n","import {ActionPanel} from \"../components/main/actionPanel.js\";\r\nimport {ActionButton} from \"../components/main/buttons/actionButton.js\";\r\n\r\n\r\nexport class PassTurnPanel extends ActionPanel {\r\n  constructor(...args) {\r\n    super(...args);\r\n  }\r\n\r\n  get label() {\r\n    return \"enhancedcombathud.hud.pass.name\";\r\n  }\r\n\r\n  async _getButtons() {\r\n    return [\r\n      new PassTurnButton()\r\n    ];\r\n  }\r\n\r\n  updateVisibility() {\r\n    super.updateVisibility();\r\n    this._buttons.forEach(button => button.render());\r\n  }\r\n}\r\n\r\nclass PassTurnButton extends ActionButton{\r\n\r\n  get visible() {\r\n    return !!game.combat?.started && game.combat?.combatant?.actor === this.actor;\r\n  }\r\n\r\n  get colorScheme() {\r\n    return 4;\r\n  }\r\n\r\n  get label() {\r\n    return \"enhancedcombathud.hud.endturn.name\";\r\n  }\r\n\r\n  get icon() {\r\n    return \"modules/enhancedcombathud/icons/duration.webp\";\r\n  }\r\n\r\n  async _onLeftClick(event) {\r\n    game.combat?.nextTurn();\r\n  }\r\n}","import { ArgonComponent } from \"./components/component.js\";\r\nimport { DrawerButton } from \"./components/drawer/drawerButton.js\";\r\nimport { DrawerPanel } from \"./components/drawer/drawerPanel.js\";\r\nimport { AccordionPanel } from \"./components/main/buttonPanel/accordionPanel.js\";\r\nimport { AccordionPanelCategory } from \"./components/main/buttonPanel/accordionPanelCategory.js\";\r\nimport { ButtonPanel } from \"./components/main/buttonPanel/buttonPanel.js\";\r\nimport { ActionButton } from \"./components/main/buttons/actionButton.js\";\r\nimport { ButtonPanelButton } from \"./components/main/buttons/buttonPanelButton.js\";\r\nimport { ItemButton } from \"./components/main/buttons/itemButton.js\";\r\nimport { MacroButton } from \"./components/main/buttons/macroButton.js\";\r\nimport { SplitButton } from \"./components/main/buttons/splitButton.js\";\r\nimport { ActionPanel } from \"./components/main/actionPanel.js\";\r\nimport { PortraitPanel } from \"./components/portrait/portraitPanel.js\";\r\nimport { WeaponSets } from \"./components/main/weaponSets.js\";\r\nimport { MovementHud } from \"./components/main/movementHud.js\";\r\nimport { ButtonHud } from \"./components/main/buttonHud.js\";\r\nimport { MacroPanel } from \"./prefab/macroPanel.js\";\r\nimport { Tooltip } from \"./tooltip.js\";\r\nimport { showTargetPickerGuide } from \"./targetPicker.js\";\r\n\r\nimport { PassTurnPanel } from \"./prefab/passTurnPanel.js\";\r\nimport { Effect } from \"./components/portrait/effect.js\";\r\nimport { HandlebarsApplication, mergeClone } from \"../lib/utils.js\";\r\n\r\nexport const MODULE_ID = \"enhancedcombathud\";\r\nexport const TEMPLATE_PATH = `modules/${MODULE_ID}/templates/`;\r\nexport const PARTIALS_PATH = `modules/${MODULE_ID}/templates/partials/`;\r\n\r\nexport function localize(string) {\r\n  return game.i18n.localize(string);\r\n}\r\n\r\nconst mainSystemComponents = {\r\n  PORTRAIT: null,\r\n  DRAWER: null,\r\n  MAIN: [],\r\n  WEAPONSETS: WeaponSets,\r\n  MOVEMENT: MovementHud,\r\n  BUTTONHUD: null,\r\n  TOOLTIP: Tooltip,\r\n};\r\n\r\nconst supportedActorTypes = [];\r\n\r\nexport class CoreHud extends HandlebarsApplication {\r\n  constructor() {\r\n    super();\r\n    this.performModuleCheck();\r\n    this._itemButtons = new Set();\r\n    this._accordionPanelCategories = new Set();\r\n    this._batchItemsUpdates = new Set();\r\n    this._hudState = new Map();\r\n    this._tooltip = null;\r\n    this._target = null;\r\n    this._enabled = false;\r\n    this.components = {\r\n      main: [],\r\n    };\r\n    this.refresh = foundry.utils.debounce(this.refresh, 200);\r\n    this._batchUpdateItemButtons = foundry.utils.debounce(\r\n      this._batchUpdateItemButtons,\r\n      200\r\n    );\r\n\r\n    Hooks.callAll(`argonInit`, CoreHud);\r\n    Hooks.on(\r\n      \"argon-onSetChangeComplete\",\r\n      this._updateActionContainers.bind(this)\r\n    );\r\n    Hooks.on(\"updateItem\", this._onUpdateItem.bind(this));\r\n    //Hooks.on(\"combatStart\", this._onCombatStart.bind(this)); #Hook is only firing for the user starting the combat for some reason\r\n    Hooks.on(\"updateCombat\", this._onUpdateCombat.bind(this));\r\n    Hooks.on(\"deleteCombat\", this._onDeleteCombat.bind(this));\r\n    Hooks.on(\"updateActor\", this._onUpdateActor.bind(this));\r\n    Hooks.on(\"updateToken\", this._onUpdateToken.bind(this));\r\n    Hooks.on(\"controlToken\", this._onControlToken.bind(this));\r\n    Hooks.on(\"createItem\", this._onCreateItem.bind(this));\r\n    Hooks.on(\"deleteItem\", this._onDeleteItem.bind(this));\r\n    Hooks.on(\"createActiveEffect\", this._onChangeActiveEffect.bind(this));\r\n    Hooks.on(\"deleteActiveEffect\", this._onChangeActiveEffect.bind(this));\r\n    Hooks.on(\"updateActiveEffect\", this._onChangeActiveEffect.bind(this));\r\n\r\n    this.setColorSettings();\r\n\r\n    document.addEventListener(\r\n      \"wheel\",\r\n      (event) =>\r\n        ui.ARGON._tooltip && ui.ARGON._tooltip.setScrollDelta(event.deltaY)\r\n    );\r\n  }\r\n\r\n  // static get defaultOptions() {\r\n  //   return {\r\n  //     ...super.defaultOptions,\r\n  //     id: \"enhancedcombathud\",\r\n  //     template: \"modules/enhancedcombathud/templates/coreHUD.hbs\",\r\n  //     popOut: false,\r\n  //     dragDrop: [{ dragSelector: null, dropSelector: null }],\r\n  //   };\r\n  // }\r\n\r\n  // static get APP_ID() {\r\n  //     return \"coreHUD\";\r\n  // }\r\n\r\n  static get DEFAULT_OPTIONS() {\r\n    return mergeClone(super.DEFAULT_OPTIONS, {\r\n      classes: [\"extended-combat-hud\", `fade-out-inactive-${game.settings.get(\r\n        \"enhancedcombathud\",\r\n        \"fadeOutInactive\"\r\n      )}`],\r\n      window: {\r\n        frame: false,\r\n        positioned: false,\r\n        minimizable: false,\r\n      },\r\n    });\r\n  }\r\n\r\n  _canDragDrop(selector) {\r\n    return true;\r\n  }\r\n\r\n  get buttonPanelContainer() {\r\n    return this._buttonPanelContainer;\r\n  }\r\n\r\n  get actionBarWidth() {\r\n    let totalActionBarWidth = 0;\r\n    (this.element ?? this._renderingElement)\r\n      ?.querySelectorAll(\".actions-container\")\r\n      .forEach((element) => {\r\n        totalActionBarWidth += element.offsetWidth;\r\n      });\r\n    return totalActionBarWidth;\r\n  }\r\n\r\n  get itemButtons() {\r\n    return Array.from(this._itemButtons);\r\n  }\r\n\r\n  addItemButtons(buttons) {\r\n    if (!Array.isArray(buttons)) buttons = [buttons];\r\n    this._itemButtons.add(...buttons);\r\n  }\r\n\r\n  get accordionPanelCategories() {\r\n    return Array.from(this._accordionPanelCategories);\r\n  }\r\n\r\n  async _updateActionContainers() {\r\n    this.components.main.forEach((component) => component.updateVisibility());\r\n  }\r\n\r\n  _onCombatStart(combat) {\r\n    const openCombatStart = game.settings.get(\r\n      \"enhancedcombathud\",\r\n      \"openCombatStart\"\r\n    );\r\n    if (openCombatStart) this.bind(canvas.tokens.controlled[0] ?? _token);\r\n    this.components.movement?._onNewRound(combat);\r\n    this.components.main.forEach((component) => component._onNewRound(combat));\r\n    this.updateSidePortraitHuds();\r\n  }\r\n\r\n  _onUpdateCombat(combat, updates) {\r\n    this.components.combat?.forEach((component) =>\r\n      component.updateVisibility()\r\n    );\r\n    if (\"round\" in updates) {\r\n      this.components.main?.forEach((component) =>\r\n        component._onNewRound(combat)\r\n      );\r\n      this.components.movement?._onNewRound(combat);\r\n    }\r\n    if (updates.round === 1 && updates.turn === 0) this._onCombatStart(combat);\r\n    this.updateSidePortraitHuds();\r\n  }\r\n\r\n  _onDeleteCombat(combat) {\r\n    this.components.movement?._onCombatEnd(combat);\r\n    const openCombatStart = game.settings.get(\r\n      \"enhancedcombathud\",\r\n      \"openCombatStart\"\r\n    );\r\n    if (openCombatStart) this.enabled = false;\r\n    this.updateSidePortraitHuds();\r\n  }\r\n\r\n  _onUpdateItem(item) {\r\n    if (item.parent !== this._actor) return;\r\n    this.accordionPanelCategories.forEach((category) => category.setUses());\r\n    for (const itemButton of this.itemButtons) {\r\n      if (itemButton.item === item) itemButton.render();\r\n    }\r\n  }\r\n\r\n  updateItemButtons(items) {\r\n    if (!Array.isArray(items)) items = [items];\r\n    this._batchItemsUpdates.add(...items);\r\n    this._batchUpdateItemButtons();\r\n  }\r\n\r\n  _batchUpdateItemButtons() {\r\n    for (const itemButton of this.itemButtons) {\r\n      if (this._batchItemsUpdates.has(itemButton.item)) itemButton.render();\r\n    }\r\n    this._batchItemsUpdates.clear();\r\n  }\r\n\r\n  _onUpdateActor(actor) {\r\n    if (actor !== this._actor) return;\r\n    this.components.portrait.refresh();\r\n    this.accordionPanelCategories.forEach((category) => category.setUses());\r\n    for (const itemButton of this.itemButtons) {\r\n      if (Number.isNumeric(itemButton.quantity)) itemButton.render();\r\n    }\r\n    this.components.main.forEach((component) => component.updateActionUse());\r\n  }\r\n\r\n  _onCreateItem(item) {\r\n    if (item.parent === this._actor) this._checkItemCount();\r\n  }\r\n\r\n  _onDeleteItem(item) {\r\n    if (item.parent === this._actor) this._checkItemCount();\r\n  }\r\n\r\n  _onChangeActiveEffect(activeEffect) {\r\n    if (activeEffect.parent !== this._actor) return;\r\n    this.components.portrait.refresh();\r\n  }\r\n\r\n  _checkItemCount() {\r\n    const itemCount = this._actor.items.size;\r\n    if (itemCount !== this._itemsCount) {\r\n      this._itemsCount = itemCount;\r\n      this.refresh();\r\n    }\r\n  }\r\n\r\n  _onUpdateToken(tokenDocument, updates, context) {\r\n    if (tokenDocument !== this._token?.document) return;\r\n    if (updates.actorId) this.bind(tokenDocument);\r\n    else this.components.movement?.onTokenUpdate(updates, context);\r\n  }\r\n\r\n  _onControlToken(token, controlled) {\r\n    if (!controlled && !canvas.tokens.controlled.length) {\r\n      setTimeout(() => {\r\n        if (!canvas.tokens.controlled.length) this.bind(null);\r\n      }, 100);\r\n    }\r\n    if (!controlled) return;\r\n    if (this.enabled || game.settings.get(\"enhancedcombathud\", \"alwaysOn\")) {\r\n      this.bind(token);\r\n    }\r\n  }\r\n\r\n  async _prepareContext(options) {\r\n    return {\r\n      fadeOutInactive: game.settings.get(\r\n        \"enhancedcombathud\",\r\n        \"fadeOutInactive\"\r\n      ),\r\n    };\r\n  }\r\n\r\n  getState() {\r\n    return this._hudState.get(this._actor);\r\n  }\r\n\r\n  setState(state) {\r\n    this._hudState.set(this._actor, state);\r\n  }\r\n\r\n  getPanelState(panel) {\r\n    const state = this.getState();\r\n    if (!state) return;\r\n    return state[panel.id];\r\n  }\r\n\r\n  setPanelState(state, panel) {\r\n    const currState = this.getState();\r\n    if (!currState) return;\r\n    currState[panel.id] = state;\r\n    this.setState(currState);\r\n  }\r\n\r\n  async _renderInner(data) {\r\n    const _prevState = this._hudState.get(this._actor);\r\n    if (!_prevState) this._hudState.set(this._actor, {});\r\n    // const element = await super._renderInner(data);\r\n    // const html = element[0];\r\n    const html = this.element;\r\n    html.innerHTML = \"\";\r\n    this._renderingElement = html;\r\n    this.components = {\r\n      weaponSets: new mainSystemComponents.WEAPONSETS(),\r\n      movement:\r\n        this._token && mainSystemComponents.MOVEMENT\r\n          ? new mainSystemComponents.MOVEMENT()\r\n          : null,\r\n      buttonHud: mainSystemComponents.BUTTONHUD\r\n        ? new mainSystemComponents.BUTTONHUD()\r\n        : null,\r\n      portrait: new mainSystemComponents.PORTRAIT(),\r\n      drawer: new mainSystemComponents.DRAWER(),\r\n      main: mainSystemComponents.MAIN.map((component) => new component()),\r\n    };\r\n\r\n    html.appendChild(this.components.weaponSets.element);\r\n    html.appendChild(this.components.portrait.element);\r\n    html.appendChild(this.components.drawer.element);\r\n    if (this.components.movement)\r\n      html.appendChild(this.components.movement.element);\r\n    if (this.components.buttonHud)\r\n      html.appendChild(this.components.buttonHud.element);\r\n\r\n    const actionHudElement = document.createElement(\"div\");\r\n    actionHudElement.classList.add(\"action-hud\");\r\n    this._buttonPanelContainer = actionHudElement;\r\n    html.appendChild(actionHudElement);\r\n\r\n    for (const component of this.components.main) {\r\n      const buttonCount = await component._getButtons();\r\n      if (buttonCount.length) actionHudElement.appendChild(component.element);\r\n    }\r\n\r\n    const promises = [];\r\n    Object.values(this.components).forEach((component) => {\r\n      if (component)\r\n        Array.isArray(component)\r\n          ? component.forEach((c) => promises.push(c.render()))\r\n          : promises.push(component.render());\r\n    });\r\n\r\n    await Promise.all(promises);\r\n    this._updateActionContainers();\r\n    this.updateSidePortraitHuds();\r\n    this.components.combat = this.components.main.filter(\r\n      (component) => component instanceof PassTurnPanel\r\n    );\r\n    this._itemsCount = this._actor.items.size;\r\n\r\n    return html;\r\n  }\r\n\r\n  _onRender(context, options) {\r\n    this.toggleMinimize(document.body.classList.contains(\"minimize-ech-hud\"));\r\n    this._renderInner(context);\r\n  }\r\n\r\n  get enabled() {\r\n    return this._enabled;\r\n  }\r\n\r\n  set enabled(value) {\r\n    const target =\r\n      typeof value === \"boolean\"\r\n        ? canvas.tokens.controlled[0] ?? game.user.character\r\n        : value;\r\n    this._enabled = !!value;\r\n    this.bind(value ? target ?? null : null);\r\n  }\r\n\r\n  async bind(target) {\r\n    //await this.close();\r\n    if (!target) {\r\n      this._target = null;\r\n      this._token = null;\r\n      this._actor = null;\r\n      this._itemsCount = null;\r\n      this._tooltip?._destroy(true);\r\n      this._batchItemsUpdates.clear();\r\n      this.toggleUiElements(false);\r\n      this.updateSceneControlButton();\r\n      return this.close();\r\n    }\r\n    this._itemButtons.clear();\r\n    this._accordionPanelCategories.clear();\r\n    if (target instanceof foundry.canvas.placeables.Token || target instanceof TokenDocument) {\r\n      this._actor = target.actor;\r\n      this._token = target instanceof foundry.canvas.placeables.Token ? target : target.object;\r\n    } else if (target instanceof Actor) {\r\n      this._actor = target;\r\n      this._token =\r\n        target.token ?? target.parent ?? target.getActiveTokens()[0] ?? null;\r\n    } else {\r\n      throw new Error(\"Invalid argument\");\r\n    }\r\n    if (!this._actor || !this._actor.isOwner) {\r\n      this._target = null;\r\n      this._token = null;\r\n      this._actor = null;\r\n      console.error(\"Argon: No actor found\");\r\n      return this.close();\r\n    }\r\n    const actorType = this._actor.type;\r\n    if (supportedActorTypes.length && !supportedActorTypes.includes(actorType)) {\r\n      const suppressWarnings = game.settings.get(\r\n        \"enhancedcombathud\",\r\n        \"suppressWarnings\"\r\n      );\r\n      if (!suppressWarnings)\r\n        ui.notifications.error(\r\n          localize(\"enhancedcombathud.err.unsupportedActorType\").replace(\"%t\",actorType)\r\n        );\r\n      else\r\n        console.error(\r\n          localize(\"enhancedcombathud.err.unsupportedActorType\").replace(\"%t\",actorType)\r\n        );\r\n      this._target = null;\r\n      this._token = null;\r\n      this._actor = null;\r\n      return this.close();\r\n    }\r\n    this._target = target;\r\n    this._enabled = true;\r\n    this._batchItemsUpdates.clear();\r\n    this.toggleUiElements(true);\r\n    this.updateSceneControlButton();\r\n    this.render(true);\r\n  }\r\n\r\n  toggle(toggle) {\r\n    toggle = toggle ?? !this.enabled;\r\n    this.enabled = toggle;\r\n  }\r\n\r\n  updateSceneControlButton() {\r\n    const btn = document.querySelector(`.control-tool[data-tool=\"echtoggle\"]`);\r\n    if (!btn) return;\r\n    try {\r\n      document\r\n        .querySelector(`.control-tool[data-tool=\"echtoggle\"]`)\r\n        .classList.toggle(\"active\", !!this._target);\r\n      ui.controls.controls\r\n        .find((c) => c.name == \"token\")\r\n        .tools.find((t) => t.name == \"echtoggle\").active = !!this._target;\r\n    } catch (e) { }\r\n  }\r\n\r\n  toggleUiElements(toggle) {\r\n    const hideMacroPlayers = game.settings.get(\r\n      \"enhancedcombathud\",\r\n      \"hideMacroPlayers\"\r\n    );\r\n    if (!hideMacroPlayers) toggle = false;\r\n    const hotbar = document.querySelector(\"#hotbar\");\r\n    const fps = document.querySelector(\"#fps\");\r\n    const players = document.querySelector(\"#players\");\r\n    [hotbar, fps, players]\r\n      .filter((element) => element)\r\n      .forEach((element) => {\r\n        element.classList.toggle(\"ech-hidden\", toggle);\r\n      });\r\n  }\r\n\r\n  collapseAllPanels() {\r\n    if (!this.element) return;\r\n    this.element\r\n      .querySelectorAll(\".features-container.show\")\r\n      .forEach((element) => {\r\n        element.classList.remove(\"show\");\r\n      });\r\n  }\r\n\r\n  updateSidePortraitHuds() {\r\n    this.components.movement?.setVisibility();\r\n    this.components.buttonHud?.setVisibility();\r\n    if (!this.components?.portrait?.element) return;\r\n    if (\r\n      !this.components.movement?.visible &&\r\n      !this.components.buttonHud?.visible\r\n    )\r\n      this.components.portrait.element.style.marginRight = \"0px\";\r\n    else this.components.portrait.element.style.marginRight = \"\";\r\n  }\r\n\r\n  toggleMinimize(forceState) {\r\n    const body = document.body;\r\n    const html = this.element;\r\n\r\n    const isMinimizeEchHud = body.classList.contains(\"minimize-ech-hud\");\r\n\r\n    const newState = forceState ?? !isMinimizeEchHud;\r\n\r\n    body.classList.toggle(\"minimize-ech-hud\", newState);\r\n    html.classList.toggle(\"minimize-hud\", newState);\r\n\r\n    this.setPosition(false);\r\n  }\r\n\r\n  setPosition(preventTransition = true) {\r\n    const html = this.element;\r\n\r\n    if (preventTransition) html.style.transition = \"none\";\r\n\r\n    const isMinimizeHud = html.classList.contains(\"minimize-hud\");\r\n\r\n    const echHUDWidth = html.offsetWidth;\r\n    const windowWidth = window.innerWidth - 340;\r\n    const scale = !game.settings.get(\"enhancedcombathud\", \"autoScale\")\r\n      ? game.settings.get(\"enhancedcombathud\", \"scale\")\r\n      : window.innerHeight / 2000; //(1 / (echHUDWidth / windowWidth)) * game.settings.get(\"enhancedcombathud\", \"scale\");\r\n\r\n    const position = {\r\n      bottom: isMinimizeHud\r\n        ? \"0px\"\r\n        : `${game.settings.get(\"enhancedcombathud\", \"botPos\")}px`,\r\n      left: `${game.settings.get(\"enhancedcombathud\", \"leftPos\")}px`,\r\n      transform: isMinimizeHud\r\n        ? `scale(${scale > 1 ? 1 : scale}) translateY(100%)`\r\n        : `scale(${scale > 1 ? 1 : scale})`,\r\n      width: `calc(100vw * ${scale < 1 ? 1 + parseFloat(1 - scale) * 1 : 1})`,\r\n    };\r\n\r\n    for (let prop in position) {\r\n      html.style[prop] = position[prop];\r\n    }\r\n    setTimeout(() => {\r\n      html.style.transition = null;\r\n    }, 500);\r\n  }\r\n\r\n  performModuleCheck() {\r\n    const systemModule = game.modules.get(\r\n      `enhancedcombathud-${game.system.id}`\r\n    );\r\n    if (systemModule?.active) return;\r\n    const systemModuleElement = `<a href=\"https://foundryvtt.com/packages/enhancedcombathud-${game.system.id\r\n      }\" target=\"_blank\">Argon - Combat HUD (${game.system.id.toUpperCase()})</a>`;\r\n    ui.notifications.error(\r\n      localize(\"enhancedcombathud.err.moduleNotActive\").replace(\r\n        \"%m\",\r\n        systemModuleElement\r\n      ),\r\n      { permanent: true }\r\n    );\r\n  }\r\n\r\n  interceptNextDialog(element) {\r\n    if (!element) return;\r\n\r\n    function getOffset(el) {\r\n      const rect = el.getBoundingClientRect();\r\n      const scrollLeft =\r\n        window.pageXOffset || document.documentElement.scrollLeft;\r\n      const scrollTop =\r\n        window.pageYOffset || document.documentElement.scrollTop;\r\n\r\n      return {\r\n        top: rect.top + scrollTop,\r\n        left: rect.left + scrollLeft,\r\n      };\r\n    }\r\n\r\n    const offset = getOffset(element);\r\n\r\n    // Close Previous Highjacked Windows\r\n    const previousWindows = document.querySelectorAll(\r\n      \".ech-highjack-window .close\"\r\n    );\r\n    previousWindows.forEach((closeButton) => closeButton.click());\r\n\r\n    // Position Windows next to Saves/Skills/Tools Menu\r\n    const hookId = Hooks.once(\"renderDialog\", (dialog, html) => {\r\n      html = html[0];\r\n      offset.top += -window.scrollY - dialog.position.height / 2;\r\n      offset.left +=\r\n        element.getBoundingClientRect().width + 10 - window.scrollX;\r\n\r\n      html.style.top = offset.top > 0 ? offset.top + \"px\" : \"0\";\r\n      html.style.left = offset.left + \"px\";\r\n      if (game.settings.get(\"enhancedcombathud\", \"dialogTheme\"))\r\n        html.classList.add(\"ech-highjack-window\");\r\n\r\n      // Update dialog with new position data for dragging.\r\n      dialog.position.left = offset.left;\r\n      dialog.position.top = offset.top > 0 ? offset.top : 0;\r\n\r\n      // If Dialog allows you to select Modifier, use modifier from ability modifier by default\r\n      const abilitySelect = html.querySelector('select[name=\"ability\"]');\r\n      if (abilitySelect && !abilitySelect.value) {\r\n        abilitySelect.value = element.dataset.modifier;\r\n      }\r\n    });\r\n\r\n    setTimeout(() => {\r\n      Hooks.off(\"renderDialog\", hookId);\r\n    }, 200);\r\n  }\r\n\r\n  showTargetPickerGuide() {\r\n    showTargetPickerGuide();\r\n  }\r\n\r\n  refresh() {\r\n    this.render();\r\n  }\r\n\r\n  static setControlHooks() {\r\n    Hooks.on(\"getSceneControlButtons\", (controls, b, c) => {\r\n      controls.tokens.tools.echtoggle = {\r\n        active: ui.ARGON?._target,\r\n        icon: \"fa-duotone fa-swords\",\r\n        name: \"echtoggle\",\r\n        title: game.i18n.localize(\"enhancedcombathud.controls.toggle.title\"),\r\n        onChange: function (event, active) {\r\n          ui.ARGON.toggle(active);\r\n        },\r\n        toggle: true,\r\n      };\r\n    });\r\n    Hooks.on(\"renderTokenHUD\", (app, html, data) => {\r\n      const button = document.createElement(\"div\");\r\n      button.classList.add(\"control-icon\");\r\n      button.innerHTML = '<i class=\"fa-duotone fa-swords\"></i>';\r\n      button.classList.toggle(\"active\", ui.ARGON.enabled);\r\n      html.querySelector(\".col.left\").prepend(button);\r\n      button.onclick = (event) => {\r\n        const target = app.object ?? canvas.tokens.controlled[0];\r\n        ui.ARGON.toggle(!ui.ARGON.enabled ? target : null);\r\n        button.classList.toggle(\"active\");\r\n      };\r\n    });\r\n  }\r\n\r\n  static definePortraitPanel(panel) {\r\n    mainSystemComponents.PORTRAIT = panel;\r\n  }\r\n\r\n  static defineDrawerPanel(panel) {\r\n    mainSystemComponents.DRAWER = panel;\r\n  }\r\n\r\n  static defineMainPanels(panels) {\r\n    mainSystemComponents.MAIN.push(...panels);\r\n  }\r\n\r\n  static defineWeaponSets(weaponSets) {\r\n    mainSystemComponents.WEAPONSETS = weaponSets;\r\n  }\r\n\r\n  static defineMovementHud(movementHud) {\r\n    mainSystemComponents.MOVEMENT = movementHud;\r\n  }\r\n\r\n  static defineButtonHud(buttonHud) {\r\n    mainSystemComponents.BUTTONHUD = buttonHud;\r\n  }\r\n\r\n  static defineSupportedActorTypes(actorTypes) {\r\n    supportedActorTypes.push(...actorTypes);\r\n  }\r\n\r\n  static defineTooltip(tooltip) {\r\n    mainSystemComponents.TOOLTIP = tooltip;\r\n  }\r\n\r\n  static get ARGON() {\r\n    return {\r\n      CORE: {\r\n        CoreHud,\r\n        Tooltip: mainSystemComponents.TOOLTIP,\r\n        ArgonComponent,\r\n      },\r\n      MAIN: {\r\n        BUTTONS: {\r\n          ActionButton,\r\n          ButtonPanelButton,\r\n          ItemButton,\r\n          MacroButton,\r\n          SplitButton,\r\n        },\r\n        ActionPanel,\r\n        BUTTON_PANELS: {\r\n          ButtonPanel,\r\n          ACCORDION: {\r\n            AccordionPanel,\r\n            AccordionPanelCategory,\r\n          },\r\n        },\r\n      },\r\n      PORTRAIT: {\r\n        PortraitPanel,\r\n        Effect,\r\n      },\r\n      DRAWER: {\r\n        DrawerButton,\r\n        DrawerPanel,\r\n      },\r\n      WeaponSets,\r\n      MovementHud,\r\n      ButtonHud,\r\n      PREFAB: {\r\n        PassTurnPanel,\r\n        MacroPanel,\r\n      },\r\n    };\r\n  }\r\n\r\n  async setColorSettings(preview) {\r\n    document.documentElement.style.setProperty(\r\n      \"--ech-fadeout-deleay\",\r\n      game.settings.get(\"enhancedcombathud\", \"fadeoutDelay\") + \"s\"\r\n    );\r\n    document.documentElement.style.setProperty(\r\n      \"--ech-fadeout-opacity\",\r\n      game.settings.get(\"enhancedcombathud\", \"fadeoutOpacity\")\r\n    );\r\n\r\n    function setThemeColors(colors) {\r\n      Object.entries(foundry.utils.flattenObject(colors)).forEach(([key, value]) => {\r\n        document.documentElement.style.setProperty(\r\n          `--ech-${key.replace(/\\./g, \"-\")}`,\r\n          value\r\n        );\r\n      });\r\n    }\r\n\r\n    let theme = preview ?? game.settings.get(\"enhancedcombathud\", \"echThemeData\");\r\n\r\n    if (theme.theme == \"custom\") {\r\n      setThemeColors(theme.colors);\r\n    } else {\r\n      const json = await this.getThemeJson(theme.theme);\r\n      setThemeColors(json);\r\n    }\r\n\r\n    const noBlur = game.settings.get(\"enhancedcombathud\", \"noBlur\");\r\n\r\n    if (noBlur)\r\n      document.documentElement.style.setProperty(\"--ech-blur-amount\", \"\");\r\n  }\r\n\r\n  async getThemeJson(themeName) {\r\n    let file;\r\n    file = await fetch(\r\n      `modules/enhancedcombathud/scripts/themes/${themeName}.json`\r\n    );\r\n    if (!file.ok)\r\n      file = await fetch(\r\n        `modules/enhancedcombathud/storage/themes/${themeName}.json`\r\n      );\r\n    if (!file.ok) {\r\n      ui.notifications.error(\"Argon: Theme not found\");\r\n      file = await fetch(`modules/enhancedcombathud/scripts/themes/argon.json`);\r\n    }\r\n    const json = await file.json();\r\n    return json;\r\n  }\r\n  \r\n  async close(...args) {\r\n    await super.close({ ...args, animate: false });\r\n  }\r\n}\r\n","import { PARTIALS_PATH } from \"./CoreHud.js\";\r\n\r\nexport class Tooltip {\r\n    constructor(tooltipData, triggerElement, orientation, locked = false) {\r\n        this.element = document.createElement(\"div\");\r\n        this.element.classList.add(...this.classes);\r\n        if (tooltipData.classes) this.element.classList.add(...tooltipData.classes);\r\n        this._tooltipData = tooltipData;\r\n        this._triggerElement = triggerElement;\r\n        this._orientation = orientation;\r\n        this._locked = locked;\r\n    }\r\n\r\n    get template() {\r\n        return `${PARTIALS_PATH}Tooltip.hbs`;\r\n    }\r\n\r\n    get classes() {\r\n        return [\"ech-tooltip\"];\r\n    }\r\n\r\n    async getData() {\r\n        return this._tooltipData;\r\n    }\r\n\r\n    async render(...args) {\r\n        await this._renderInner();\r\n        const details = this.element.querySelector(\".ech-tooltip-details\");\r\n        if (details) {\r\n            let closestMultiplier = 3;\r\n            [2, 3].forEach((multiplier) => {\r\n                if (details.children.length % multiplier === 0) closestMultiplier = multiplier;\r\n            });\r\n            details.style.gridTemplateColumns = `repeat(${Math.min(details.children.length, closestMultiplier)}, 1fr)`;\r\n        }\r\n\r\n        const body = this.element.querySelector('.ech-tooltip-body');\r\n        if (!body.textContent.trim()) {\r\n            body.style.display = 'none';\r\n        }\r\n\r\n        ui.ARGON._tooltip = this;\r\n        game.tooltip.activate(this._triggerElement, { html: this.element, cssClass: \"ech-tooltip-container\", direction: this._orientation });\r\n        return this.element;\r\n    }\r\n\r\n    async _renderInner() {\r\n        const data = await this.getData();\r\n        this._data = data;\r\n        const rendered = await (foundry.applications?.handlebars?.renderTemplate ?? renderTemplate) (this.template, data);\r\n        const tempElement = document.createElement(\"div\");\r\n        tempElement.innerHTML = rendered;\r\n        this.element.innerHTML = tempElement.firstElementChild.innerHTML;\r\n        if (!data.subtitle) this.element.classList.add(\"hide-subtitle\");\r\n    }\r\n\r\n\r\n    setScrollDelta(delta) {\r\n        if (!this._scrollableElement) return;\r\n        this._scrollableElement.scrollTop += delta;\r\n    }\r\n\r\n    _destroy(force = false) {\r\n        if (ui.ARGON._tooltip === this) ui.ARGON._tooltip = null;\r\n        if (force) {\r\n            this.element.remove();\r\n            return;\r\n        }\r\n        this.element.animate([{ opacity: 1 }, { opacity: 0 }], {\r\n            duration: 300,\r\n            easing: \"ease-in-out\",\r\n        }).onfinish = () => {\r\n            this.element.remove();\r\n        };\r\n    }\r\n}\r\n","export const defaultTheme = {\r\n    theme: \"custom\",\r\n    font: \"Roboto\",\r\n    colors: {\r\n        portrait: {\r\n            base: {\r\n                background: \"#414B55E6\",\r\n                color: \"#B4D2DCFF\",\r\n                border: \"#757f89FF\",\r\n            },\r\n        },\r\n        mainAction: {\r\n            base: {\r\n                background: \"#414B55E6\",\r\n                color: \"#B4D2DCFF\",\r\n                border: \"#757f89FF\",\r\n            },\r\n            hover: {\r\n                background: \"#747e88e6\",\r\n                color: \"#B4D2DCFF\",\r\n                border: \"#757f89FF\",\r\n            },\r\n        },\r\n        bonusAction: {\r\n            base: {\r\n                background: \"#453B75E6\",\r\n                color: \"#B4D2DCFF\",\r\n                border: \"#757f89FF\",\r\n            },\r\n            hover: {\r\n                background: \"#9288c2e6\",\r\n                color: \"#B4D2DCFF\",\r\n                border: \"#757f89FF\",\r\n            },\r\n        },\r\n        freeAction: {\r\n            base: {\r\n                background: \"#3B5875E6\",\r\n                color: \"#B4D2DCFF\",\r\n                border: \"#757f89FF\",\r\n            },\r\n            hover: {\r\n                background: \"#88a5c2e6\",\r\n                color: \"#B4D2DCFF\",\r\n                border: \"#757f89FF\",\r\n            },\r\n        },\r\n        reaction: {\r\n            base: {\r\n                background: \"#753B3BE6\",\r\n                color: \"#B4D2DCFF\",\r\n                border: \"#757f89FF\",\r\n            },\r\n            hover: {\r\n                background: \"#c28888e6\",\r\n                color: \"#B4D2DCFF\",\r\n                border: \"#757f89FF\",\r\n            },\r\n        },\r\n        endTurn: {\r\n            base: {\r\n                background: \"#374B3CE6\",\r\n                color: \"#B4D2DCFF\",\r\n                border: \"#757f89FF\",\r\n            },\r\n            hover: {\r\n                background: \"#849889e6\",\r\n                color: \"#B4D2DCFF\",\r\n                border: \"#757f89FF\",\r\n            },\r\n        },\r\n        tooltip: {\r\n            header: {\r\n                background: \"#ffffffCC\",\r\n                color: \"#414146\",\r\n                border: \"#757f89FF\",\r\n            },\r\n            subtitle: {\r\n                background: \"#32505a\",\r\n                color: \"#ffffff\",\r\n                border: \"#757f89FF\",\r\n            },\r\n            body: {\r\n                background: \"#5a7896B3\",\r\n                color: \"#ffffff\",\r\n                border: \"#757f89FF\",\r\n            },\r\n        },\r\n        abilityMenu: {\r\n            background: \"#414B55E6\",\r\n            color: \"#B4D2DCFF\",\r\n            border: \"#757f89FF\",\r\n            base: { color: \"#B4D2DCFF\", boxShadow: \"#757f89CC\" },\r\n            hover: { color: \"#B4D2DCFF\", boxShadow: \"#757f89CC\" },\r\n        },\r\n        buttons: {\r\n            base: {\r\n                background: \"#5096c3\",\r\n                color: \"#ffffff\",\r\n                border: \"#5096c3\",\r\n            },\r\n            hover: {\r\n                background: \"#55bef5\",\r\n                color: \"#ffffffff\",\r\n                border: \"#55bef5\",\r\n            },\r\n        },\r\n        movement: {\r\n            used: { background: \"#7d879180\", boxShadow: \"#00000000\" },\r\n            baseMovement: { background: \"#5abef5FF\", boxShadow: \"#6ed2ffCC\" },\r\n            dashMovement: { background: \"#c8c85aFF\", boxShadow: \"#dcdc6eCC\" },\r\n            dangerMovement: { background: \"#c85f5aFF\", boxShadow: \"#dc736eCC\" },\r\n        },\r\n    },\r\n};\r\n\r\nexport function initConfig() {\r\n    Handlebars.registerHelper(\"echLocalize\", (data, data2, data3) => {\r\n        let str = `.${data}`;\r\n        if (typeof data2 == \"string\") str += `${data2.charAt(0).toUpperCase() + data2.slice(1)}`;\r\n        if (typeof data3 == \"string\") str += `${data3.charAt(0).toUpperCase() + data3.slice(1)}`;\r\n\r\n        return game.i18n.localize(`enhancedcombathud.themeOptions${str}`);\r\n    });\r\n\r\n    Handlebars.registerHelper(\"ifObject\", function (item, options) {\r\n        if (typeof item === \"object\") {\r\n            return options.fn(this);\r\n        } else {\r\n            return options.inverse(this);\r\n        }\r\n    });\r\n}","import { HandlebarsApplication, mergeClone, setProperty } from \"../lib/utils.js\";\nimport { defaultTheme } from \"../config.js\";\n\nexport class EchThemeOptions extends HandlebarsApplication {\n\n    static get DEFAULT_OPTIONS() {\n        return mergeClone(super.DEFAULT_OPTIONS, {\n            tag: \"form\",\n            id: \"echThemeOptions\",\n            window: {\n                title: \"Theme Options\",\n                contentClasses: [\"standard-form\"],\n                resizable: true,\n            },\n            actions: {\n                fooAction: this.fooAction,\n                barAction: this.barAction,\t\n            },\n            form: {\n                handler: this.#onSubmit,\n                closeOnSubmit: false,\n            },\n            position: {\n                width: 660,\n                // height: window.innerHeight,\n            }\n        });\n    }\n\n    static get PARTS() {\n        return {\n            content: {\n                template: \"modules/enhancedcombathud/templates/theme-options.hbs\",\n                classes: [\"standard-form\", \"scrollable\"],\n            },\n            footer: {\n                template: \"templates/generic/form-footer.hbs\",\n            }\n        };\n    }\n\n    createTheme() {\n        new foundry.applications.api.DialogV2({\n            window: { title: \"Export Argon - Combat HUD Theme\" },\n            content: `\n                <form id=\"echExportTheme\">\n                    <div class=\"form-group\">\n                        <label>${game.i18n.localize(\"enhancedcombathud.themeOptions.exportThemeName\")}</label>\n                        <input type=\"text\" name=\"echExportThemeName\"/>\n                    </div>\n                </form>`,\n            buttons: [\n                {\n                    action: \"export\",\n                    label: \"Save\",\n                    callback: (event, button, dialog)  => {\n                        const themeName = dialog.element.querySelector('input[name=\"echExportThemeName\"]').value.slugify({strict: true});\n                        const theme = new File([new Blob([JSON.stringify(this.getThemeColors())], { type: \"application/json\" })], `${themeName}.json`);\n                        foundry.applications.apps.FilePicker.implementation.uploadPersistent(\"enhancedcombathud\", \"themes\", theme).then((response) => {\n                            this.buildDropdown(themeName);\n                        });\n                    },\n                },\n                {\n                    action: \"cancel\",\n                    label: \"Cancel\",\n                    callback: (event) => {\n                        return true;\n                    },\n                },\n            ],\n        }).render({force: true});\n    }\n\n    getThemeColors() {\n        let theme = {};\n\n        this.element.querySelectorAll('#echThemeOptions .window-content alpha-color-picker').forEach((input) => {\n            setProperty(theme, input.name, input.getAttribute(\"value\"));\n        });\n\n        // Export Theme\n        return foundy.utils.expandObject(theme.colors);\n    }\n\n    async buildDropdown(selectedTheme) {\n        if (typeof selectedTheme == \"undefined\") game.settings.get(\"enhancedcombathud\", \"echThemeData\").theme;\n\n        const echThemeOptions = this.element;\n        const selectTheme = echThemeOptions.querySelector('select[name=\"theme\"]');\n        selectTheme.innerHTML = \"\";\n\n        const coreThemes = (await foundry.applications.apps.FilePicker.implementation.browse(\"user\", `modules/enhancedcombathud/scripts/themes`, { extensions: [\".json\"] })).files;\n        const customThemes = (await foundry.applications.apps.FilePicker.implementation.browse(\"user\", `modules/enhancedcombathud/storage/themes`, { extensions: [\".json\"] })).files;\n\n        function createOption(file) {\n            const filename = file.split(\"/\")[file.split(\"/\").length - 1].replace(/\\.json/gi, \"\");\n            const option = document.createElement(\"option\");\n            option.value = filename;\n            const optionName = filename.replace(/-/g, \" \");\n            option.text = optionName.split(\" \").map((word) => word.charAt(0).toUpperCase() + word.slice(1)).join(\" \");\n            selectTheme.appendChild(option);\n        }\n\n        function createOptGroup(label) {\n            const optgroup = document.createElement(\"optgroup\");\n            optgroup.label = label;\n            selectTheme.appendChild(optgroup);\n        }\n\n        createOption(\"custom\");\n        createOptGroup(\"Core Themes\");\n        coreThemes.forEach(createOption);\n        createOptGroup(\"Custom Themes\");\n        customThemes.forEach(createOption);\n\n        echThemeOptions.querySelector('select[name=\"theme\"]').value = selectedTheme;\n        this.setThemeVisibility(selectedTheme);\n    }\n\n    _prepareContext(options) {\n        // We need to use the stored settings, but do a check from the default settings\n        // In case a new color was added since the last update\n        // We build a new object with the default settings, and then overwrite the values with the stored settings\n        let themeOptions = game.settings.get(\"enhancedcombathud\", \"echThemeData\");\n        themeOptions = foundry.utils.mergeObject(defaultTheme, themeOptions);\n\n        const saveButton = {\n            type: \"submit\",\n            action: \"submit\",\n            icon: \"fas fa-save\",\n            label: \"Save\",\n        };\n\n        return {\n            themeOptions: themeOptions,\n            buttons: [saveButton],\n        };\n    }\n\n    _onRender(context, options) {\n        super._onRender(context, options);\n        const html = this.element;\n        // Hex to rgba\n        function _convertHexUnitTo256(hexStr) {\n            return parseInt(hexStr.repeat(2 / hexStr.length), 16);\n        }\n        const getTextColor = (hexColor) => {\n            const rgbaColor = (hex) => {\n                const hexArr = hex.slice(1).match(new RegExp(\".{2}\", \"g\"));\n                const [r, g, b, a] = hexArr.map(_convertHexUnitTo256);\n                return [r, g, b, Math.round((a / 256 + Number.EPSILON) * 100) / 100];\n            };\n\n            const rgba = rgbaColor(hexColor);\n            const brightness = Math.round((rgba[0] * 299 + rgba[1] * 587 + rgba[2] * 114) / 1000);\n\n            if (rgba[3] > 0.5) {\n                return brightness > 125 ? \"black\" : \"white\";\n            } else {\n                return \"black\";\n            }\n        };\n\n        this.buildDropdown(game.settings.get(\"enhancedcombathud\", \"echThemeData\").theme);\n\n        html.addEventListener(\"click\", (event) => {\n            if (event.target.matches(\"li h4.toggleOptions\") || event.target.closest(\"li h4.toggleOptions\")) {\n                const toggleElement = event.target.matches(\"li h4.toggleOptions\") \n                    ? event.target \n                    : event.target.closest(\"li h4.toggleOptions\");\n                \n                const listItem = toggleElement.closest(\"li\");\n                const isOpened = listItem.classList.contains(\"show\");\n                \n                const parentUl = toggleElement.closest(\"ul\");\n                parentUl.querySelectorAll(\"li.show\").forEach(li => li.classList.remove(\"show\"));\n                \n                listItem.classList.toggle(\"show\", !isOpened);\n                this.setPosition({height: \"auto\"});\n            }\n        });\n\n        let themeOptions = game.settings.get(\"enhancedcombathud\", \"echThemeData\");\n        this.setThemeVisibility(themeOptions.theme);\n\n        // Handle Theme Selection\n        html\n            .querySelector('select[name=\"theme\"]')\n            .addEventListener(\"change\", (event) => {\n                let selectedTheme = event.currentTarget.value;\n\n                const updateColors = (theme) => {\n                    html\n                        .querySelectorAll('.color-picker')\n                        .forEach((picker) => {\n                            let name = picker.name.replace(/colors\\./g, \"\");\n                            let value = name.split(\".\").reduce((p, c) => (p && p[c]) || null, theme);\n\n                            if (value != null) {\n                                picker.setAttribute(\"value\", value);\n                                picker.value = value;\n                                picker.style.backgroundColor = value;\n                                picker.style.color = getTextColor(value);\n                            }\n                        });\n                };\n\n                if (selectedTheme != \"custom\") {\n                    ui.ARGON.getThemeJson(selectedTheme).then((theme) => {\n                        updateColors(theme);\n                    });\n                } else {\n                    updateColors(game.settings.get(\"enhancedcombathud\", \"echThemeData\").colors);\n                }\n                this.setThemeVisibility(selectedTheme);\n                this.setPosition({height: \"auto\"});\n            });\n\n        // Export theme\n\n        html.querySelector('button[name=\"export\"]').addEventListener(\"click\", (event) => {\n            event.preventDefault();\n            this.createTheme();\n        });\n    }\n\n    _onChangeForm(formConfig, event) {\n        const formData = new foundry.applications.ux.FormDataExtended(this.form).object;\n\n        ui.ARGON.setColorSettings(foundry.utils.expandObject(formData));\n    }\n\n    static async #onSubmit() {\n        const form = this.element;\n        const formData = new foundry.applications.ux.FormDataExtended(form).object;\n\n        await game.settings.set(\"enhancedcombathud\", \"echThemeData\", foundry.utils.expandObject(formData));\n    }\n\n    setThemeVisibility(selectedTheme) {\n        this.element.querySelector(\".echThemeOptionsContainer\").classList.toggle(\"hidden\", selectedTheme != \"custom\");\n        this.element.querySelector(\"button[name='export']\").classList.toggle(\"hidden\", selectedTheme != \"custom\");\n    }\n\n    async render(args) {\n        // if (!game.modules.get(\"colorsettings\")?.active) {\n        //     ui.notifications.warn(\"The 'lib - Color Settings' module is required to customize the theme colors. Please install it from FoundryVTT's module repository.\");\n        // }\n        return super.render(args);\n    }\n\n    _onClose(...args) {\n        super._onClose(...args);\n        ui.ARGON.setColorSettings();\n    }\n}","// Convert 0-255 number to hex string\nfunction numToHex(num) {\n    return num.toString(16).padStart(2, \"0\");\n}\n\n// Convert hex string to 0-255 number\nfunction hexToNum(hex) {\n    return parseInt(hex, 16);\n}\n\n\n/**\n * @typedef HTMLAlphaColorPickerOptions\n * @property {string} value  A hexadecimal string representation of the color with alpha.\n * @property {number} step  A number representing the step of the alpha.\n * @property {number} min  A number representing the minimum value of the alpha.\n * @property {number} max  A number representing the maximum value of the alpha.\n */\n\n/**\n * A custom HTMLElement used to select a color and an alpha using a linked pair of input fields.\n * @extends {AbstractFormInputElement<string>}\n */\nexport class HTMLAlphaColorPickerElement extends foundry.applications.elements.AbstractFormInputElement {\n\n    /**\n     * @param {HTMLAlphaColorPickerOptions} [options]\n     */\n    constructor({value, step, min, max} = {}) {\n        super();\n        value = value || this.getAttribute(\"value\") || \"#000000ff\";\n        this.value = value || this.getAttribute(\"value\");\n        this._color = value.slice(0, 7);\n        this._alpha = hexToNum(value.slice(7, 9));\n        this._step = (step || this.getAttribute(\"step\")) || 1;\n        this._min = (min || this.getAttribute(\"min\")) || 0;\n        this._max = (max || this.getAttribute(\"max\")) || 255;\n    }\n\n    _getValue() {\n        return this._color + numToHex(this._alpha);\n    }\n\n    _setValue(color) {\n        this._color = color.slice(0, 7);\n        this._alpha = hexToNum(color.slice(7, 9));\n        this._value = color;\n        this.setAttribute(\"value\", color);\n    }\n\n    /** @override */\n    static tagName = \"alpha-color-picker\";\n\n    /* -------------------------------------------- */\n\n    /**\n     * The input element to define a Document UUID.\n     * @type {HTMLInputElement}\n     */\n    #colorPicker;\n\n    /**\n     * The input element to define a Document UUID.\n     * @type {HTMLInputElement}\n     */\n    #colorAlpha;\n\n    #colorOutput;\n\n    /* -------------------------------------------- */\n\n    /** @override */\n    _buildElements() {\n\n        const container = document.createElement(\"div\");\n        container.style.display = \"flex\";\n        container.style.flexDirection = \"row\";\n        container.style.alignItems = \"center\";\n        container.style.gap = \"0.5rem\";\n        container.style.justifyContent = \"space-between\";\n\n        // Create color selector element\n        this.#colorPicker = new foundry.applications.elements.HTMLColorPickerElement({ value: this._color });\n        this.#colorPicker.style.flex = \"1\";\n        this._applyInputAttributes(this.#colorPicker);\n\n        this.#colorAlpha = new foundry.applications.elements.HTMLRangePickerElement({ value: this._alpha, step: this._step, min: this._min, max: this._max });\n        this.#colorAlpha.style.flex = \"1\";\n        this._applyInputAttributes(this.#colorAlpha);\n\n        this.#colorOutput = document.createElement(\"span\");\n        this.#colorOutput.style.background = this.value;\n        // this.#colorOutput.style.opacity = this._alpha;\n        this.#colorOutput.style.borderRadius = \"50%\";\n        this.#colorOutput.style.width = \"var(--input-height)\";\n        this.#colorOutput.style.height = \"var(--input-height)\";\n        this.#colorOutput.style.border = \"solid 1px\";\n\n        container.appendChild(this.#colorPicker);\n        container.appendChild(this.#colorAlpha);\n        container.appendChild(this.#colorOutput);\n\n        return [container];\n\n        // return [this.#colorPicker, this.#colorAlpha];\n    }\n\n    /* -------------------------------------------- */\n\n    // /** @override */\n    _refresh() {\n        if ( !this.#colorPicker ) return; // Not yet connected\n        this.#colorPicker._setValue(this._color);\n        this.#colorPicker._refresh();\n        this.#colorAlpha._setValue(this._alpha);\n        this.#colorAlpha._refresh();\n        this.#colorOutput.style.background = this.value;\n        // this.#colorOutput.style.opacity = this._alpha / 255;\n    }\n\n    /* -------------------------------------------- */\n\n    /** @override */\n    _activateListeners() {\n        const onChange = this.#onChangeInput.bind(this);\n        this.#colorPicker.addEventListener(\"change\", onChange);\n        this.#colorAlpha.addEventListener(\"change\", onChange);\n    }\n\n    /* -------------------------------------------- */\n\n    /**\n     * Handle changes to one of the inputs of the color picker element.\n     * @param {InputEvent} event     The originating input change event\n     */\n    #onChangeInput(event) {\n        event.stopPropagation();\n        if(event.currentTarget === this.#colorPicker) {\n            this._color = event.currentTarget.value;\n        } else {\n            this._alpha = event.currentTarget.value;\n        }\n        this.value = this.value;\n    }\n\n    /* -------------------------------------------- */\n}","import { CoreHud } from \"./app/CoreHud.js\";\r\nimport { initConfig } from \"./config.js\";\r\nimport { registerSettings } from \"./settings.js\";\r\nimport { HTMLAlphaColorPickerElement } from \"./AlphaColorPicker.js\";\r\nimport \"../scss/module.scss\";\r\n\r\nexport const MODULE_ID = \"enhancedcombathud\";\r\n\r\nObject.defineProperty(globalThis.CONFIG, \"ARGON\", {\r\n  get: () => {\r\n    return CoreHud.ARGON;\r\n  }\r\n});\r\n\r\nCoreHud.setControlHooks();\r\n\r\nHooks.on(\"init\", () => {\r\n  registerKeybindings();\r\n  window.customElements.define(HTMLAlphaColorPickerElement.tagName, HTMLAlphaColorPickerElement);\r\n});\r\n\r\nHooks.on(\"ready\", () => {\r\n  initConfig();\r\n  registerSettings();\r\n  ui.ARGON = new CoreHud();\r\n});\r\n\r\nexport function registerKeybindings() {\r\n    game.keybindings.register(\"enhancedcombathud\", \"toggleHud\", {\r\n        name: \"enhancedcombathud.hotkey.toggle.name\",\r\n        editable: [{ key: \"KeyA\", modifiers: [foundry.helpers.interaction.KeyboardManager.MODIFIER_KEYS.SHIFT] }],\r\n        restricted: false,\r\n        onDown: () => {},\r\n        onUp: () => {\r\n            ui.ARGON.toggle();\r\n        },\r\n    });\r\n}\r\n","import { defaultTheme } from \"./config.js\";\nimport { EchThemeOptions } from \"./app/EchThemeOptions.js\";\n\nexport function registerSettings() {\n        game.settings.register(\"enhancedcombathud\", \"globalTheme\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.globalTheme.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.globalTheme.hint\"),\n        scope: \"world\",\n        config: true,\n        type: String,\n        requiresReload: true,\n        choices: {\n            client: game.i18n.localize(\"enhancedcombathud.settings.globalTheme.choices.client\"),\n            world: game.i18n.localize(\"enhancedcombathud.settings.globalTheme.choices.world\"),\n        },\n        default: \"client\",\n        onChange: () => ui.ARGON.refresh(),\n    });\n\n    const globalTheme = game.settings.get(\"enhancedcombathud\", \"globalTheme\");\n\n    game.settings.register(\"enhancedcombathud\", \"echThemeData\", {\n        name: \"Data used for Theming\",\n        type: Object,\n        default: defaultTheme,\n        scope: globalTheme,\n        config: false,\n        onChange: () => {\n            ui.ARGON.setColorSettings();\n            ui.ARGON.refresh();\n        },\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"targetPickerGuideShown\", {\n        type: Boolean,\n        default: false,\n        scope: \"client\",\n        config: false,\n    });\n\n    // Define a settings submenu which handles advanced configuration needs\n    game.settings.registerMenu(\"enhancedcombathud\", \"echThemeOptions\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.thememenu.name\"),\n        label: game.i18n.localize(\"enhancedcombathud.settings.thememenu.label\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.thememenu.hint\"),\n        icon: \"fas fa-bars\",\n        type: EchThemeOptions,\n        restricted: globalTheme === \"world\",\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"rangefinder\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.rangefinder.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.rangefinder.hint\"),\n        scope: \"world\",\n        config: true,\n        type: Boolean,\n        default: true,\n        onChange: () => ui.ARGON.refresh(),\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"rangepicker\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.rangepicker.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.rangepicker.hint\"),\n        scope: \"world\",\n        config: true,\n        type: Boolean,\n        default: true,\n        onChange: () => ui.ARGON.refresh(),\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"rangepickerclear\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.rangepickerclear.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.rangepickerclear.hint\"),\n        scope: \"world\",\n        config: true,\n        type: Boolean,\n        default: false,\n        onChange: () => ui.ARGON.refresh(),\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"openCombatStart\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.openCombatStart.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.openCombatStart.hint\"),\n        scope: \"world\",\n        config: true,\n        type: Boolean,\n        default: false,\n        onChange: () => ui.ARGON.refresh(),\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"dialogTheme\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.dialogTheme.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.dialogTheme.hint\"),\n        scope: \"world\",\n        config: true,\n        type: Boolean,\n        default: true,\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"autoScale\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.autoScale.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.autoScale.hint\"),\n        scope: \"client\",\n        config: true,\n        type: Boolean,\n        default: true,\n        onChange: () => ui.ARGON.refresh(),\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"scale\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.scale.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.scale.hint\"),\n        scope: \"client\",\n        config: true,\n        range: {\n            min: 0.1,\n            max: 1,\n            step: 0.01,\n        },\n        type: Number,\n        default: 0.5,\n        onChange: () => ui.ARGON.refresh(),\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"alwaysOn\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.alwaysOn.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.alwaysOn.hint\"),\n        scope: \"client\",\n        config: true,\n        type: Boolean,\n        default: false,\n        onChange: () => ui.ARGON.refresh(),\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"leftPos\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.leftPos.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.leftPos.hint\"),\n        scope: \"client\",\n        config: true,\n        type: Number,\n        default: 15,\n        onChange: () => ui.ARGON.refresh(),\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"botPos\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.botPos.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.botPos.hint\"),\n        scope: \"client\",\n        config: true,\n        type: Number,\n        default: 15,\n        onChange: () => ui.ARGON.refresh(),\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"hideMacroPlayers\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.hideMacroPlayers.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.hideMacroPlayers.hint\"),\n        scope: \"client\",\n        config: true,\n        type: Boolean,\n        default: true,\n        onChange: () => ui.ARGON.refresh(),\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"playerDetailsBottom\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.playerDetailsBottom.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.playerDetailsBottom.hint\"),\n        scope: \"client\",\n        config: true,\n        type: Boolean,\n        default: false,\n        onChange: () => ui.ARGON.refresh(),\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"showTooltips\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.showTooltips.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.showTooltips.hint\"),\n        scope: \"client\",\n        config: true,\n        type: Boolean,\n        default: true,\n        onChange: () => ui.ARGON.refresh(),\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"tooltipScale\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.tooltipScale.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.tooltipScale.hint\"),\n        scope: \"client\",\n        config: true,\n        range: {\n            min: 0.1,\n            max: 1,\n            step: 0.01,\n        },\n        type: Number,\n        default: 0.7,\n        onChange: () => ui.ARGON.refresh(),\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"fadeOutInactive\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.fadeOutInactive.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.fadeOutInactive.hint\"),\n        scope: \"client\",\n        config: true,\n        type: Boolean,\n        default: false,\n        onChange: () => {\n            ui.ARGON.setColorSettings();\n            ui.ARGON.refresh();\n        },\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"fadeoutDelay\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.fadeoutDelay.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.fadeoutDelay.hint\"),\n        scope: \"client\",\n        config: true,\n        type: Number,\n        default: 4,\n        onChange: () => {\n            ui.ARGON.setColorSettings();\n            ui.ARGON.refresh();\n        },\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"fadeoutOpacity\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.fadeoutOpacity.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.fadeoutOpacity.hint\"),\n        scope: \"client\",\n        config: true,\n        type: Number,\n        range: {\n            min: 0,\n            max: 1,\n            step: 0.05,\n        },\n        default: 0.1,\n        onChange: () => {\n            ui.ARGON.setColorSettings();\n            ui.ARGON.refresh();\n        },\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"noBlur\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.noBlur.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.noBlur.hint\"),\n        scope: \"client\",\n        config: true,\n        type: Boolean,\n        default: false,\n        onChange: () => {\n            ui.ARGON.setColorSettings();\n            ui.ARGON.refresh();\n        },\n    });\n\n    game.settings.register(\"enhancedcombathud\", \"suppressWarnings\", {\n        name: game.i18n.localize(\"enhancedcombathud.settings.suppressWarnings.name\"),\n        hint: game.i18n.localize(\"enhancedcombathud.settings.suppressWarnings.hint\"),\n        scope: \"world\",\n        config: true,\n        type: Boolean,\n        default: false,\n    });\n}\n\n"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","ArgonComponent","constructor","this","element","document","createElement","elementType","classList","add","classes","_tooltip","_parent","parent","actor","ui","ARGON","_actor","token","_token","template","isAncestorComponent","getPrototypeOf","PARTIALS_PATH","name","colorScheme","visible","hasTooltip","tooltipOrientation","tooltipCls","CONFIG","CORE","Tooltip","setColorScheme","setVisibility","toggle","getTooltipData","getData","activateTooltipListeners","game","settings","onmouseenter","_onTooltipMouseEnter","bind","event","locked","tooltipData","render","_onTooltipMouseLeave","_locked","_destroy","_renderInner","activateListeners","parentClass","Hooks","callAll","data","rendered","foundry","applications","handlebars","renderTemplate","tempElement","innerHTML","firstElementChild","html","DrawerButton","buttons","super","_buttons","interceptDialogs","helpers","interaction","TooltipManager","implementation","TOOLTIP_DIRECTIONS","RIGHT","setGrid","gridCols","style","gridTemplateColumns","setAlign","align","_textAlign","setTextAlign","Array","from","children","forEach","child","index","textAlign","button","interactive","indexOf","el","querySelector","onclick","e","interceptNextDialog","currentTarget","closest","onClick","DrawerPanel","title","categories","_processCategories","_categories","querySelectorAll","addEventListener","dataset","_expandPanel","isNaN","ratio","parseFloat","transform","split","replace","scaleHeight","window","innerHeight","offsetHeight","expanded","remove","maxHeight","_lastExpandedDrawer","body","buttonPromises","panel","panelIndex","category","container","reverse","after","captions","map","caption","push","Promise","all","ButtonPanel","id","iscontainer","_id","saveState","utils","debounce","contains","noTransition","undefined","collapseAllPanels","transition","setTimeout","state","setPanelState","restoreState","getPanelState","updateItem","item","appendChild","promises","AccordionPanel","accordionPanelCategories","_subPanels","subPanels","i","length","toggleDefaults","totalActionBarWidth","actionBarWidth","totalWidth","AccordionPanelCategory","label","uses","_label","max","value","_uses","_accordionPanelCategories","setUses","buttonContainer","_realWidth","_setUses","Number","isNumeric","usesElement","Infinity","width","buttonMultipliers","closestMultiplier","multiplier","resolve","offsetWidth","ActionButton","icon","quantity","onmouseup","_onMouseUp","onmousedown","_onMouseDown","_onMouseEnter","onmouseleave","_onMouseLeave","preventDefault","stopPropagation","_onLeftClick","_onRightClick","console","error","backgroundImage","itemCount","ButtonPanelButton","buttonPanelContainer","_onClick","_getPanel","warn","activeTargetPicker","TargetPicker","targets","ranges","checkShowTargetPickerGuide","showTargetPickerGuide","end","reject","_targetCount","user","size","_maxTargets","targetTool","click","promise","targetHook","on","targeted","checkComplete","movelistener","update","clicklistener","which","keyuplistener","maxTargets","init","targetCount","count","t","setTarget","releaseOthers","tokenSizeOffset","Math","height","canvas","scene","dimensions","distance","showRangeRings","normal","long","clientX","clientY","left","top","innerText","res","clearRanges","off","removeEventListener","ItemButton","isWeaponSet","isPrimary","inActionPanel","_item","_isWeaponSet","_isPrimary","_inActionPanel","hookId","_onSetChange","addItemButtons","img","quantitySecondary","useTargetPicker","useRangeFinder","Levels3DPreview","_active","hasQuantity","hasQuantitySecondary","setItem","sets","active","activeSet","primary","secondary","_onPreLeftClick","async","showRangeFinder","range","object","RangeFinder","entityClass","rangeFinders","rf","destroy","visTokens","tokens","placeables","filter","distDiff","ruler3d","measureMinTokenDistance","sources","text","abs","toFixed","grid","units","color","clearRangeFinders","isTargetPicker","picker","result","display","isBothZero","rangeRings","force","RangeRingEffect","MacroButton","macro","_macro","execute","SplitButton","button1","button2","ActionPanel","args","maxActions","currentActions","_onNewRound","combat","updateVisibility","updateActionUse","actionsContainer","childrenArray","action","availableActions","_getButtons","apply","localize","HandlebarsApplication","api","HandlebarsApplicationMixin","ApplicationV2","registerPositionSetting","savePosition","POSITION_SETTING_REGISTERED","DEFAULT_OPTIONS","register","MODULE_ID","APP_ID","scope","config","type","default","resetSavedPosition","set","position","positionToSave","setPosition","r","join","toLowerCase","PARTS","content","scrollable","tag","frame","positioned","controls","minimizable","resizable","contentTag","contentClasses","preventEscapeClose","actions","form","handler","submitOnChange","closeOnSubmit","_prepareContext","options","_onRender","context","instances","delete","close","options1","options2","activeOptions","mergeClone","other","deepClone","mergeObject","Effect","effect","description","ux","TextEditor","enrichHTML","tooltip","PortraitPanel","refresh","image","isDead","isDying","deathIcon","successes","failures","configurationTemplate","effectClass","getEffects","effects","temporaryEffects","uuid","playerDetailsBottom","_onDeathSave","_onConfigure","toggleMinimizeButton","find","getStatBlocks","combatant","initiative","DialogV2","confirm","i18n","defaultYes","rollInitiative","rerollInitiative","createCombatants","sheet","toggleMinimize","statBlocks","block","sb","stat","span","buttonsContainer","btn","deathContainer","childNodes","node","deathBtn","pointerEvents","effectsContainer","effectElements","effectToDelete","fromUuid","statusEffect","statusEffects","s","toggleEffect","getArgonPortraitConfig","ArgonPortraitConfig","footer","saveButton","formData","FormDataExtended","WeaponSets","_onDrop","_onDragStart","_onDragEnd","_onContextMenu","getFlag","onSetChange","getSetData","_getSets","getDefaultSets","slots","entries","JSON","parse","dataTransfer","slot","setFlag","setData","stringify","movementColors","MovementHud","_movementUsed","started","movementUsed","movement","history","spaces","round","movementMax","movementColor","min","floor","movementIcon","Token","movementMode","movementAction","onTokenUpdate","updates","x","y","updateMovement","disabledBars","barsNumber","barsContainer","newHtml","_onCombatEnd","ButtonHud","buttonEl","textContent","gridTemplateRows","ceil","MacroPanel","MacroPanelButton","_type","_color","_icon","hasContents","pages","accordionPanels","pageLabel","pageNum","getHotbarMacros","m","PassTurnPanel","PassTurnButton","nextTurn","string","mainSystemComponents","PORTRAIT","DRAWER","MAIN","WEAPONSETS","MOVEMENT","BUTTONHUD","TOOLTIP","triggerElement","orientation","_tooltipData","_triggerElement","_orientation","details","trim","activate","cssClass","direction","_data","subtitle","setScrollDelta","delta","_scrollableElement","scrollTop","animate","opacity","duration","easing","onfinish","supportedActorTypes","CoreHud","performModuleCheck","_itemButtons","Set","_batchItemsUpdates","_hudState","Map","_target","_enabled","components","main","_batchUpdateItemButtons","_updateActionContainers","_onUpdateItem","_onUpdateCombat","_onDeleteCombat","_onUpdateActor","_onUpdateToken","_onControlToken","_onCreateItem","_onDeleteItem","_onChangeActiveEffect","setColorSettings","deltaY","_canDragDrop","selector","_buttonPanelContainer","_renderingElement","itemButtons","isArray","component","_onCombatStart","controlled","updateSidePortraitHuds","turn","enabled","itemButton","updateItemButtons","items","has","clear","portrait","_checkItemCount","activeEffect","_itemsCount","tokenDocument","actorId","fadeOutInactive","getState","setState","currState","weaponSets","buttonHud","drawer","actionHudElement","values","c","target","character","toggleUiElements","updateSceneControlButton","TokenDocument","Actor","Error","getActiveTokens","isOwner","actorType","includes","notifications","tools","marginRight","forceState","isMinimizeEchHud","newState","preventTransition","isMinimizeHud","scale","innerWidth","bottom","systemModule","modules","system","systemModuleElement","toUpperCase","permanent","offset","getOffset","rect","getBoundingClientRect","scrollLeft","pageXOffset","documentElement","pageYOffset","closeButton","once","dialog","scrollY","scrollX","abilitySelect","modifier","list","prompt","setControlHooks","b","echtoggle","onChange","app","prepend","definePortraitPanel","defineDrawerPanel","defineMainPanels","panels","defineWeaponSets","defineMovementHud","movementHud","defineButtonHud","defineSupportedActorTypes","actorTypes","defineTooltip","BUTTONS","BUTTON_PANELS","ACCORDION","PREFAB","preview","setThemeColors","colors","flattenObject","setProperty","theme","getThemeJson","themeName","file","fetch","ok","json","defaultTheme","font","base","background","border","mainAction","hover","bonusAction","freeAction","reaction","endTurn","header","abilityMenu","boxShadow","used","baseMovement","dashMovement","dangerMovement","EchThemeOptions","fooAction","barAction","createTheme","callback","slugify","strict","File","Blob","getThemeColors","apps","FilePicker","uploadPersistent","then","response","buildDropdown","input","getAttribute","foundy","expandObject","selectedTheme","echThemeOptions","selectTheme","coreThemes","browse","extensions","files","customThemes","createOption","filename","option","optionName","word","charAt","slice","createOptGroup","optgroup","setThemeVisibility","themeOptions","_convertHexUnitTo256","hexStr","parseInt","repeat","matches","toggleElement","listItem","isOpened","li","updateColors","reduce","p","setAttribute","backgroundColor","hexColor","rgba","hex","hexArr","match","RegExp","g","a","EPSILON","rgbaColor","brightness","getTextColor","_onChangeForm","formConfig","_onClose","hexToNum","HTMLAlphaColorPickerElement","elements","AbstractFormInputElement","step","_alpha","_step","_min","_max","_getValue","numToHex","num","toString","padStart","_setValue","_value","static","_buildElements","flexDirection","alignItems","gap","justifyContent","HTMLColorPickerElement","flex","_applyInputAttributes","HTMLRangePickerElement","borderRadius","_refresh","_activateListeners","globalThis","registerKeybindings","keybindings","editable","modifiers","KeyboardManager","MODIFIER_KEYS","SHIFT","restricted","onDown","onUp","customElements","define","tagName","initConfig","Handlebars","registerHelper","data2","data3","str","fn","inverse","registerSettings","hint","String","requiresReload","choices","client","world","globalTheme","Boolean","registerMenu"],"ignoreList":[],"sourceRoot":""}