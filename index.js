(()=>{"use strict";var e={d:(t,n)=>{for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{D:()=>h});class ArgonComponent{constructor(){this.element=document.createElement(this.elementType),this.element.classList.add(...this.classes),this._tooltip=null,this._parent=null}get parent(){return this._parent}get actor(){return ui.ARGON._actor}get token(){return ui.ARGON._token}get template(){const e=Object.getPrototypeOf(this.constructor)===ArgonComponent;return`${a}${e?this.constructor.name:Object.getPrototypeOf(this.constructor).name}.hbs`}get classes(){return[]}get elementType(){return"div"}get colorScheme(){return null}get visible(){return!0}get hasTooltip(){return!1}get tooltipOrientation(){return null}get tooltipCls(){return CONFIG.ARGON.CORE.Tooltip}setColorScheme(){if(null!==this.colorScheme)switch(this.colorScheme){case 1:this.element.classList.add("bonus-action");break;case 2:this.element.classList.add("free-action");break;case 3:this.element.classList.add("reaction");break;case 4:this.element.classList.add("end-turn")}}setVisibility(){this.element.classList.toggle("hidden",!this.visible)}async getTooltipData(){return null}async getData(){return{}}async activateTooltipListeners(){if(!game.settings.get("enhancedcombathud","showTooltips"))return;this.element.onmouseenter=this._onTooltipMouseEnter.bind(this)}async _onTooltipMouseEnter(e,t=!1){const n=await this.getTooltipData();if(!n)return;const s=this.tooltipCls;this._tooltip=new s(n,this.element,this.tooltipOrientation,t),this._tooltip.render()}async _onTooltipMouseLeave(e){this._tooltip&&!this._tooltip._locked&&(this._tooltip._destroy(),this._tooltip=null)}async render(){await this._renderInner(),await this.activateListeners(this.element),this.hasTooltip&&await this.activateTooltipListeners();const e=Object.getPrototypeOf(this.constructor);return Hooks.callAll(`render${e.name}ArgonComponent`,this,this.element,this.actor),Hooks.callAll(`render${this.constructor.name}ArgonComponent`,this,this.element,this.actor),this.element}async _renderInner(){const e=await this.getData(),t=await(foundry.applications?.handlebars?.renderTemplate??renderTemplate)(this.template,e),n=document.createElement("div");n.innerHTML=t,this.element.innerHTML=n.firstElementChild.innerHTML,this.setColorScheme(),this.setVisibility()}async activateListeners(e){}}class DrawerButton extends ArgonComponent{constructor(e){super(),this._buttons=e}get classes(){return["ability"]}get elementType(){return"li"}get interceptDialogs(){return!0}get tooltipOrientation(){return foundry.helpers.interaction.TooltipManager.implementation.TOOLTIP_DIRECTIONS.RIGHT}setGrid(e){this.element.style.gridTemplateColumns=e}setAlign(e){this._textAlign=e}setTextAlign(){this._textAlign&&Array.from(this.element.children).forEach((e,t)=>{e.style.textAlign=this._textAlign[t]})}async activateListeners(e){await super.activateListeners(e);for(const e of this._buttons){if(!e.interactive)continue;const t=this._buttons.indexOf(e),n=this.element.querySelector(`span[data-index="${t}"]`);n&&(n.onclick=t=>{this.interceptDialogs&&ui.ARGON.interceptNextDialog(t.currentTarget.closest(".ability")),e.onClick(t)})}this.setTextAlign()}async getData(){return this._buttons.forEach(e=>{e.onClick&&(e.interactive=!0)}),{buttons:this._buttons}}}class DrawerPanel extends ArgonComponent{get classes(){return["ability-menu"]}get elementType(){return"div"}get title(){return"Drawer Panel"}get categories(){return[]}async getData(){return this._processCategories(),{title:this.title,categories:this._categories}}_processCategories(){let e=this.categories;const t=this.title;e[0]?.categories||(e=[{title:t,categories:e}]),this._categories=e}async activateListeners(e){e.querySelectorAll(".ability-toggle .ability.ability-title").forEach(e=>{e.addEventListener("click",t=>{const n=e.dataset.index;this._expandPanel(n)})})}_expandPanel(e){if(isNaN(e))return;const t=this.element.querySelector(`.ability-toggle .ability.ability-title[data-index="${e}"]`),n=ui.ARGON.element[0],s=parseFloat(n?.style.transform.split(" ")[0].replace(/[^0-9.]+/g,"")??1),i=(window.innerHeight-(document.querySelector(".portrait-hud")?.offsetHeight||200)*s)/s-70;let o=null;this.element.querySelectorAll(".ability-toggle .ability.ability-title").forEach(e=>e.classList.remove("active")),this.element.querySelectorAll(".collapsible-panel").forEach(e=>{"0px"!==e.style.maxHeight&&(o=e.dataset.index),e.style.maxHeight="0px"}),o!=e?(ui.ARGON._lastExpandedDrawer=e,this.element.querySelector(`.collapsible-panel[data-index="${e}"]`).style.maxHeight=`${i}px`,t.classList.add("active")):ui.ARGON._lastExpandedDrawer=null,document.body.classList.toggle("ech-show-ability-menu",o!=e)}async _renderInner(){await super._renderInner();const e=[];for(const t of this._categories){const n=this._categories.indexOf(t);for(const s of t.categories){const i=t.categories.indexOf(s),o=this.element.querySelector(`.collapsible-panel[data-index="${n}"] .ability-title[data-index="${i}"]`);if(!o)continue;if(!s.buttons)continue;const a=[...s.buttons].reverse();for(const t of a)t._parent=this,o.after(t.element),t.setGrid(s.gridCols),t.setAlign(s.captions.map(e=>e.align)),e.push(t.render())}}return await Promise.all(e),this.element.querySelectorAll(".collapsible-panel").forEach(e=>{e.style.maxHeight="0px"}),this._expandPanel(ui.ARGON._lastExpandedDrawer),this.element}}class ButtonPanel extends ArgonComponent{constructor({buttons:e,id:t}){super(),this.element.dataset.iscontainer=!0,this._id=t??null,this._buttons=e,this.saveState=foundry.utils.debounce(this.saveState,100)}get classes(){return["features-container"]}get visible(){return this.element.classList.contains("show")}get id(){return this._id}setVisibility(){}toggle(e,t=!1){void 0===e&&(e=!this.visible),e&&ui.ARGON.collapseAllPanels(),t&&(this.element.style.transition="none"),this.element.classList.toggle("show",e),t&&setTimeout(()=>this.element.style.transition=null,1),this.saveState()}saveState(){if(!this.id)return;const e={visible:this.visible};ui.ARGON.setPanelState(e,this)}restoreState(){if(!this.id)return;const e=ui.ARGON.getPanelState(this);e&&this.toggle(e.visible,!0)}updateItem(e){if(this._buttons)for(const t of this._buttons)t.item===e&&t.render()}async _renderInner(){await super._renderInner(),this._buttons.forEach(e=>{e._parent=this,this.element.appendChild(e.element)});const e=this._buttons.map(e=>e.render());await Promise.all(e),this.restoreState()}}class AccordionPanel extends ArgonComponent{constructor({accordionPanelCategories:e,id:t}){super(),this._subPanels=e,this._id=t??null,this.saveState=foundry.utils.debounce(this.saveState,100)}get classes(){return["features-container","is-spells"]}get visible(){return this.element.classList.contains("show")}get id(){return this._id}setVisibility(){}toggle(e,t=!1){void 0===e&&(e=!this.visible),e&&ui.ARGON.collapseAllPanels(),t&&(this.element.style.transition="none"),this.element.classList.toggle("show",e),t&&setTimeout(()=>this.element.style.transition=null,1),this.saveState()}saveState(){if(!this.id)return;const e={visible:this.visible,subPanels:this._subPanels.map(e=>e.visible)};ui.ARGON.setPanelState(e,this)}restoreState(){if(!this.id)return;const e=ui.ARGON.getPanelState(this);if(e){this.toggle(e.visible,!0);for(let t=0;t<e.subPanels.length;t++)this._subPanels[t]?.toggle(e.subPanels[t],!0)}}updateItem(e){if(this._subPanels)for(const t of this._subPanels)t.updateItem(e)}async toggleDefaults(){let e=ui.ARGON.actionBarWidth;for(const t of this._subPanels){if(e-=t.totalWidth,e<0)break;t.toggle(!0)}}async _renderInner(){await super._renderInner(),this._subPanels.forEach(e=>{this.element.appendChild(e.element),e._parent=this});const e=this._subPanels.map(e=>e.render());await Promise.all(e),await this.toggleDefaults(),this.restoreState()}}class AccordionPanelCategory extends ArgonComponent{constructor({label:e,uses:t={},buttons:n}){super(),this.element.dataset.iscontainer=!0,this._label=e,"object"!=typeof t||t.max||(t.max=t.value),this._uses=t,this._buttons=n,ui.ARGON._accordionPanelCategories.add(this),this.setUses=foundry.utils.debounce(this.setUses,100)}get classes(){return["features-accordion"]}get buttonContainer(){return this.element.querySelector(".features-accordion-content")}get visible(){return this.element.classList.contains("show")}get label(){return this._label}get uses(){return"object"==typeof this._uses?this._uses:this._uses()}get buttons(){return this._buttons}get totalWidth(){return this._realWidth+this.element.querySelector(".feature-accordion-title").offsetHeight}async getData(){return{label:this.label}}setVisibility(){}updateItem(e){if(this._buttons)for(const t of this._buttons)t.item===e&&t.render()}setUses(){this._setUses()}_setUses(){if(!Number.isNumeric(this.uses.value))return;const e=this.buttonContainer.querySelector(".feature-spell-slots");if(e.innerHTML="",this.uses.value!==1/0)for(let t=0;t<this.uses.max;t++)e.innerHTML+=`<span class="spell-slot spell-${t<this.uses.max-this.uses.value?"used":"available"}"></span>`;else e.innerHTML='<span class="spell-slot spell-cantrip"><i class="fas fa-infinity"></i></span>'}async activateListeners(e){this.element.querySelector(".feature-accordion-title").addEventListener("click",()=>{this.toggle()})}toggle(e,t=!1){void 0===e&&(e=!this.visible),t&&(this.element.style.transition="none",this.buttonContainer.style.transition="none"),this.element.classList.toggle("show",e),this.element.style.width=e?`${this._realWidth}px`:"0px",t&&setTimeout(()=>{this.element.style.transition=null,this.buttonContainer.style.transition=null},1),this.parent.saveState()}get buttonMultipliers(){return[2,3,5,7]}async _renderInner(){await super._renderInner();const e=this.buttonContainer;this._buttons.forEach(t=>{t._parent=this,e.appendChild(t.element)});const t=this._buttons.map(e=>e.render());await Promise.all(t),this._setUses();let n=0;this.buttonMultipliers.forEach(e=>{this._buttons.length%e===0&&(n=e)}),this._buttons.length<3?e.style.gridTemplateColumns=`repeat(${this._buttons.length}, 1fr)`:n&&(e.style.gridTemplateColumns=`repeat(${n}, 1fr)`),this.element.style.transition="none",this.element.style.width="unset",await new Promise(e=>setTimeout(e,1));const s=this.element.offsetWidth;this._realWidth=s,this.element.style.width="0px",this.element.style.transition=null}}class ActionButton extends ArgonComponent{constructor(){super()}get classes(){return["action-element","ech-blur"]}get label(){return""}get icon(){return""}get quantity(){return null}get colorScheme(){return 0}async getData(){return{label:this.label,icon:this.icon}}activateListeners(e){this.element.onmouseup=this._onMouseUp.bind(this),this.element.onmousedown=this._onMouseDown.bind(this),this.element.onmouseenter=this._onMouseEnter.bind(this),this.element.onmouseleave=this._onMouseLeave.bind(this)}async _onMouseDown(e){}async _onMouseUp(e){e.preventDefault(),e.stopPropagation(),0===e.button&&this._onLeftClick(e),2===e.button&&this._onRightClick(e)}async _onMouseEnter(e){}async _onMouseLeave(e){}async _onLeftClick(e){console.error("ActionButton._onLeftClick not implemented")}async _onRightClick(e){}async _renderInner(){await super._renderInner(),this.element.style.backgroundImage=`url("${this.icon}")`,Number.isNumeric(this.quantity)&&(this.element.classList.add("has-count"),this.element.dataset.itemCount=this.quantity)}}class ButtonPanelButton extends ArgonComponent{get classes(){return["action-element","ech-blur"]}get label(){return""}get icon(){return""}get colorScheme(){return 0}get buttonPanelContainer(){return ui.ARGON.buttonPanelContainer}updateItem(e){this.panel&&this.panel.updateItem(e)}async getData(){return{label:this.label,icon:this.icon}}async activateListeners(e){await super.activateListeners(e),this.element.onclick=this._onClick.bind(this)}async _onClick(e){e.preventDefault(),e.stopPropagation(),this.panel.toggle()}async _renderInner(){await super._renderInner(),this.element.style.backgroundImage=`url("${this.icon}")`,this.panel=await this._getPanel(),this.panel._parent=this,this.buttonPanelContainer.appendChild(this.panel.element),await this.panel.render()}async _getPanel(){return console.warn("ButtonPanelButton.getPanel() is not implemented"),null}}let t=null;class TargetPicker{constructor({token:e,targets:n,ranges:s}){!function checkShowTargetPickerGuide(){game.settings.get("enhancedcombathud","targetPickerGuideShown")||window.ui.ARGON.showTargetPickerGuide()}(),t&&t.end(!1),t=this,this.ranges=s,this.token=e,this.resolve=null,this.reject=null,this._targetCount=game.user.targets.size,this._maxTargets=n;const i=document.querySelector('.control.tool[data-tool="target"]');i?.click(),this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t}),this.targetHook=Hooks.on("targetToken",(e,t,n)=>{this.checkComplete()}),this.movelistener=e=>{this.update(e)},this.clicklistener=e=>{3===e.which&&this.end(!1)},this.keyuplistener=e=>{"+"!==e.key&&"="!==e.key||this.maxTargets++,"-"!==e.key&&"_"!==e.key||this.maxTargets>1&&this.maxTargets--},document.addEventListener("mousemove",this.movelistener),document.addEventListener("mouseup",this.clicklistener),document.addEventListener("keyup",this.keyuplistener),this.init()}checkComplete(){this.targetCount=game.user.targets.size,this.targetCount>=this.maxTargets&&this.end(!0)}set targetCount(e){this._targetCount=e,this.update()}get targetCount(){return this._targetCount}set maxTargets(e){this._maxTargets=e,this.update(),this.checkComplete()}get maxTargets(){return this._maxTargets}init(){game.settings.get("enhancedcombathud","rangepickerclear")&&game.user.targets.forEach(e=>e.setTarget(!1,{releaseOthers:!0}));const e=document.createElement("div");if(e.classList.add("ech-target-picker"),document.body.appendChild(e),this.element=e,!this.maxTargets||this.targetCount==this.maxTargets)return this.end(!0);const t=.5*Math.max(this.token.document.width,this.token.document.height)*canvas.scene.dimensions.distance;showRangeRings(this.ranges.normal,this.ranges.long,this.token,t)}update(e){if(this.element){if(e){const t=e.clientX,n=e.clientY;this.element.style.left=t+20+"px",this.element.style.top=n+"px"}this.element.innerText=`${this.targetCount}/${this.maxTargets} Targets`}}end(e){clearRanges(!0),document.querySelector(".control.tool").click(),t=null,this.resolve(e),this.element.remove(),Hooks.off("targetToken",this.targetHook),document.removeEventListener("mousemove",this.movelistener),document.removeEventListener("mouseup",this.clicklistener),document.removeEventListener("keyup",this.keyuplistener),document.querySelector('.control.tool[data-tool="select"]')?.click()}}class ItemButton extends ArgonComponent{constructor({item:e,isWeaponSet:t=!1,isPrimary:n=!1,inActionPanel:s}){super(),this._item=e,this._isWeaponSet=t,this._isPrimary=n,this._inActionPanel=s??t,this.isWeaponSet&&(this.hookId=Hooks.on("argon-onSetChangeUpdateItem",this._onSetChange.bind(this))),ui.ARGON.addItemButtons(this)}get classes(){return["feature-element"]}get isWeaponSet(){return this._isWeaponSet}get isPrimary(){return this._isPrimary}get inActionPanel(){return this._inActionPanel}get item(){return this._item}get label(){return this.item.name}get icon(){return this.item.img}get quantity(){return null}get quantitySecondary(){return null}get ranges(){return{normal:null,long:null}}get targets(){return 0}get useTargetPicker(){return game.settings.get("enhancedcombathud","rangepicker")}get useRangeFinder(){return game.Levels3DPreview?._active&&game.settings.get("enhancedcombathud","rangefinder")}get visible(){return!!this.item}async getData(){if(!this.visible)return{};const e=this.quantity,t=this.quantitySecondary;return{label:this.label,icon:this.icon,quantity:e,hasQuantity:Number.isNumeric(e),quantitySecondary:this.quantitySecondary,hasQuantitySecondary:Number.isNumeric(t)}}setItem(e){if(!this.isWeaponSet)return console.error("Cannot set item on non-weapon set button");this._item=e,this.render()}async _onSetChange({sets:e,active:t}){const n=e[t],s=this.isPrimary?n.primary:n.secondary;this.setItem(s)}activateListeners(e){this.element.onmouseup=this._onMouseUp.bind(this),this.element.onmousedown=this._onMouseDown.bind(this),this.element.onmouseenter=this._onMouseEnter.bind(this),this.element.onmouseleave=this._onMouseLeave.bind(this)}async _onMouseDown(e){}async _onMouseUp(e){e.preventDefault(),e.stopPropagation(),0===e.button&&this._onPreLeftClick(e),2===e.button&&this._onRightClick(e)}async _onMouseEnter(e){this.token&&this.useRangeFinder&&(showRangeRings(this.ranges.normal,this.ranges.long,this.token),async function showRangeFinder(e,t){if(!game.Levels3DPreview?._active||!e)return;const n="none"!=game.settings.get("enhancedcombathud","rangefinder");if(!n)return;const s=game.Levels3DPreview.CONFIG.entityClass.RangeFinder;game.Levels3DPreview.rangeFinders.forEach(e=>{e.destroy()});const i=canvas.tokens.placeables.filter(e=>e.visible);for(let n of i){const i=e-game.Levels3DPreview.helpers.ruler3d.measureMinTokenDistance(game.Levels3DPreview.tokens[t.id],game.Levels3DPreview.tokens[n.id]);new s(n,i>=0?{sources:[t],text:""}:{sources:[t],text:`-${Math.abs(i.toFixed(2))}${canvas.scene.grid.units}`,style:{color:"rgb(210 119 119);"}})}}(this.ranges.normal,this.token))}async _onMouseLeave(e){clearRanges(),function clearRangeFinders(){if(!game.Levels3DPreview?._active)return;game.Levels3DPreview.rangeFinders.forEach(e=>{e.destroy()})}()}async _onPreLeftClick(e){if(this.useTargetPicker&&this.targets>0){n=!0;const e=new TargetPicker({token:this.token,targets:this.targets,ranges:this.ranges}),t=await e.promise;if(n=!1,!t)return}this._onLeftClick(e)}async _onLeftClick(e){console.error("ActionButton._onLeftClick not implemented")}async _onRightClick(e){}async _renderInner(){if(await super._renderInner(),!this.item)return void(this.element.style.display="none");this.element.style.display="",this.element.style.backgroundImage=`url("${this.icon}")`;const e=this.quantity,t=this.quantitySecondary;if(Number.isNumeric(e)||Number.isNumeric(t)){const n=(e??0)+(t??0)===0;this.element.style.filter=n?"grayscale(1)":null}if(this.inActionPanel){this.element.classList.remove("feature-element"),this.element.classList.add("action-element","item-button");const e=this.element.querySelector(".feature-element-title");e&&(e.classList.remove("feature-element-title"),e.classList.add("action-element-title"))}}}let n=!1;const s={normal:null,long:null};function clearRanges(e=!1){game.Levels3DPreview?._active&&(n&&!e||(s.normal&&(s.normal.remove(),s.normal=null),s.long&&(s.long.remove(),s.long=null)))}function showRangeRings(e,t,n,i){game.Levels3DPreview?._active&&(clearRanges(!0),e&&(s.normal=new game.Levels3DPreview.CONFIG.entityClass.RangeRingEffect(n,e+i)),t&&(s.long=new game.Levels3DPreview.CONFIG.entityClass.RangeRingEffect(n,t+i,"#ff0000")))}class MacroButton extends ArgonComponent{constructor({macro:e,inActionPanel:t}){super(),this._macro=e,this._inActionPanel=t??!1}get classes(){return["feature-element"]}get inActionPanel(){return this._inActionPanel}get macro(){return this._macro}get label(){return this.macro.name}get icon(){return this.macro.img}get quantity(){return null}get quantitySecondary(){return null}get visible(){return!!this.macro}async getData(){if(!this.visible)return{};const e=this.quantity,t=this.quantitySecondary;return{label:this.label,icon:this.icon,quantity:e,hasQuantity:Number.isNumeric(e),quantitySecondary:this.quantitySecondary,hasQuantitySecondary:Number.isNumeric(t)}}activateListeners(e){this.element.onmouseup=this._onMouseUp.bind(this),this.element.onmousedown=this._onMouseDown.bind(this),this.element.onmouseenter=this._onMouseEnter.bind(this),this.element.onmouseleave=this._onMouseLeave.bind(this)}async _onMouseDown(e){}async _onMouseUp(e){e.preventDefault(),e.stopPropagation(),0===e.button&&this._onPreLeftClick(e),2===e.button&&this._onRightClick(e)}async _onMouseEnter(e){}async _onMouseLeave(e){}async _onPreLeftClick(e){this._onLeftClick(e)}async _onLeftClick(e){this.macro.execute()}async _onRightClick(e){}async _renderInner(){if(await super._renderInner(),!this.macro)return void(this.element.style.display="none");this.element.style.display="",this.element.style.backgroundImage=`url("${this.icon}")`;const e=this.quantity,t=this.quantitySecondary;if(Number.isNumeric(e)||Number.isNumeric(t)){const n=(e??0)+(t??0)===0;this.element.style.filter=n?"grayscale(1)":null}if(this.inActionPanel){this.element.classList.remove("feature-element"),this.element.classList.add("action-element","item-button");const e=this.element.querySelector(".feature-element-title");e&&(e.classList.remove("feature-element-title"),e.classList.add("action-element-title"))}}}class SplitButton extends ArgonComponent{constructor(e,t){super(),this.button1=e,this.button2=t}get classes(){return["action-element-container"]}get colorScheme(){return 0}async _renderInner(){await super._renderInner(),this.element.appendChild(this.button1.element),this.element.appendChild(this.button2.element),this.button1._parent=this,this.button2._parent=this,await this.button1.render(),await this.button2.render()}}class ActionPanel extends ArgonComponent{constructor(...e){super(...e),this._buttons=[]}get classes(){return["actions-container"]}get label(){return"Action Panel"}get buttons(){return this._buttons}get maxActions(){return null}get currentActions(){return null}_onNewRound(e){}updateVisibility(){if(!this._buttons)return;let e=this._buttons.length;for(const t of this._buttons)!1===t.visible&&e--;this.element.classList.toggle("hidden",0===e)}updateActionUse(){const e=this.element.querySelector(".actions-uses-container");if(null!==this.maxActions&&null!==this.currentActions||(e.innerHTML=""),!e)return;const t=Array.from(e.children);if(t.length!==this.maxActions){e.innerHTML="";for(let t=0;t<this.maxActions;t++){const t=document.createElement("div");t.classList.add("action-pip"),e.appendChild(t)}}let n=this.currentActions;for(const e of t)e.classList.toggle("actions-used",n<=0),n--}updateItem(e){if(this._buttons)for(const t of this._buttons)t.item===e&&t.render(),t instanceof ButtonPanelButton&&t.updateItem(e),t instanceof SplitButton&&(t.button1.item===e&&t.button1.render(),t.button2.item===e&&t.button2.render())}async _getButtons(){return console.warn("ActionPanel._getButtons() is not implemented"),[]}async getData(){return{maxActions:Array.apply(null,Array(this.maxActions))}}async _renderInner(){await super._renderInner(),this.element.dataset.title=localize(this.label);const e=await this._getButtons();this._buttons=e;for(const t of e)t._parent=this,this.element.appendChild(t.element),t.render();this.updateActionUse(),this.updateVisibility()}}class HandlebarsApplication extends(foundry.applications.api.HandlebarsApplicationMixin(foundry.applications.api.ApplicationV2)){constructor(){super(),this.constructor.registerPositionSetting(),this.savePosition=foundry.utils.debounce(this.savePosition.bind(this),100)}static registerPositionSetting(){!this.POSITION_SETTING_REGISTERED&&this.DEFAULT_OPTIONS.window?.savePosition&&(this.POSITION_SETTING_REGISTERED=!0,game.settings.register(h,this.APP_ID+"-position",{scope:"client",config:!1,type:Object,default:{}}))}static resetSavedPosition(){game.settings.set(h,this.APP_ID+"-position",{})}savePosition(e){const t={left:e.left,top:e.top,width:e.width,height:e.height};"auto"===t.width&&delete t.width,"auto"===t.height&&delete t.height,game.settings.set(h,this.APP_ID+"-position",t)}setPosition(...e){const t=super.setPosition(...e);return this.constructor.POSITION_SETTING_REGISTERED&&this.savePosition(this.position),t}static get APP_ID(){return this.name.split(/(?=[A-Z])/).join("-").toLowerCase()}get APP_ID(){return this.constructor.APP_ID}static get PARTS(){return{content:{template:`modules/${h}/templates/${this.APP_ID}.hbs`,classes:[],scrollable:[]}}}static get DEFAULT_OPTIONS(){return{tag:"div",id:this.APP_ID,window:{title:`${h}.${this.APP_ID}.title`,frame:!0,positioned:!0,icon:"",controls:[],minimizable:!0,resizable:!1,contentTag:"section",contentClasses:[],savePosition:!1,preventEscapeClose:!1},actions:{},form:{handler:void 0,submitOnChange:!1,closeOnSubmit:!1},position:{width:560,height:"auto"}}}async _prepareContext(e){if(this.getData)return this.getData();return{data:{}}}activateListeners(){}_onRender(e,t){super._onRender(e,t),this.constructor.DEFAULT_OPTIONS.window.preventEscapeClose&&(foundry.applications.instances.delete(this.id,this),this.window.close.style.display="none");const n=this.element;this.activateListeners&&this.activateListeners(n)}async render(e={},t={}){const n="boolean"==typeof e?t:e;return!n.position&&this.constructor.POSITION_SETTING_REGISTERED&&(n.position=game.settings.get(h,this.APP_ID+"-position")),super.render(e,t)}}function mergeClone(e,t){return e=foundry.utils.deepClone(e),t=foundry.utils.deepClone(t),foundry.utils.mergeObject(e,t)}class Effect extends ArgonComponent{constructor(e){super(),this.effect=e}get classes(){return["effect-icon"]}get label(){return this.effect.name}get icon(){return this.effect.img}get colorScheme(){return 0}get hasTooltip(){return!0}async getTooltipData(){return{title:this.label,description:await foundry.applications.ux.TextEditor.implementation.enrichHTML(this.effect.tooltip)}}async getData(){return{label:this.label,icon:this.icon}}activateListeners(e){this.element.onmouseup=this._onMouseUp.bind(this),this.element.onmousedown=this._onMouseDown.bind(this),this.element.onmouseenter=this._onMouseEnter.bind(this),this.element.onmouseleave=this._onMouseLeave.bind(this)}async _onMouseDown(e){}async _onMouseUp(e){e.preventDefault(),e.stopPropagation(),0===e.button&&this._onLeftClick(e),2===e.button&&this._onRightClick(e)}async _onMouseEnter(e){}async _onMouseLeave(e){}async _onLeftClick(e){console.error("ActionButton._onLeftClick not implemented")}async _onRightClick(e){}}class PortraitPanel extends ArgonComponent{constructor(...e){super(...e),this.refresh=foundry.utils.debounce(this.refresh.bind(this),100)}get classes(){return["portrait-hud"]}get name(){return this.actor.name}get image(){return this.actor.img}get description(){return""}get isDead(){return!1}get isDying(){return!1}get deathIcon(){return"fas fa-skull"}get successes(){return 0}get failures(){return 0}get configurationTemplate(){return null}get effectClass(){return Effect}async getEffects(){const e=[];for(const t of this.actor.temporaryEffects)e.push({img:t.img,name:t.name,uuid:t.uuid,tooltip:await foundry.applications.ux.TextEditor.implementation.enrichHTML(t.description)});return e}async getData(){return{name:this.name,image:this.image,description:this.description,isDead:this.isDead,isDying:this.isDying,deathIcon:this.deathIcon,successes:this.successes,failures:this.failures,playerDetailsBottom:game.settings.get("enhancedcombathud","playerDetailsBottom")}}async activateListeners(e){super.activateListeners(e),e.querySelector(".death-save-btn").addEventListener("click",this._onDeathSave.bind(this)),this.configurationTemplate?e.querySelector("#argon-actor-config")?.addEventListener("click",this._onConfigure.bind(this)):e.querySelector(".portrait-actor-configuration")?.remove();const t=this._buttons.find(e=>"toggle-minimize"===e.id);t&&t.element.addEventListener("click",e=>{t.element.classList.toggle("fa-flip-vertical")})}async _onDeathSave(e){console.error("Argon: PortraitPanel._onDeathSave not implemented")}async getStatBlocks(){return[]}async _getButtons(){return[{id:"roll-initiative",icon:"fas fa-dice-d20",label:"Roll Initiative",onClick:async e=>{if(void 0!==this.token.combatant?.initiative){if(!await foundry.applications.api.DialogV2.confirm({window:{title:game.i18n.localize("enhancedcombathud.confirmRerollInitiativeTitle")},content:game.i18n.localize("enhancedcombathud.confirmRerollInitiativeContent"),defaultYes:!1}))return}this.actor.rollInitiative({rerollInitiative:!0,createCombatants:!0})}},{id:"open-sheet",icon:"fas fa-suitcase",label:"Open Character Sheet",onClick:e=>this.actor.sheet.render(!0)},{id:"toggle-minimize",icon:"fas fa-caret-down",label:"Minimize",onClick:e=>ui.ARGON.toggleMinimize()}]}refresh(){this.render()}async _renderInner(e){await super._renderInner(e);const t=await this.getStatBlocks();for(const e of t){const t=document.createElement("div");t.classList.add("portrait-stat-block");for(const n of e){const e=document.createElement("span");e.innerText=n.text,e.style.color=n.color,null!=n.id&&(e.id=n.id),t.appendChild(e)}this.element.appendChild(t)}this._buttons=await this._getButtons();const n=this.element.querySelector(".player-buttons");for(const e of this._buttons){const t=document.createElement("div");t.classList.add("player-button"),t.innerHTML=`<i class="${e.icon}"></i>`,t.dataset.tooltip=e.label,t.onclick=e.onClick,e.element=t,n.appendChild(t)}const s=this.element.querySelector(".death-saves");if(s.classList.remove("no-buttons"),this.isDead||this.isDying){if(this.isDead){s.childNodes.forEach(e=>e.classList&&e.classList.add("hidden")),s.classList.add("no-buttons");const e=s.querySelector(".death-save-btn");e.classList.remove("hidden"),e.style.pointerEvents="none"}}else s.classList.add("hidden");const i=this.element.querySelector(".effects-container"),o=(await this.getEffects()).map(e=>new this.effectClass(e));i.innerHTML="";for(const e of o)e.element.addEventListener("contextmenu",async t=>{t.preventDefault(),t.stopPropagation();const n=e.effect.uuid,s=await fromUuid(n),i=CONFIG.statusEffects.find(e=>e.img===s.img);await foundry.applications.api.DialogV2.confirm({window:{title:game.i18n.localize("enhancedcombathud.deleteEffectTitle")},content:game.i18n.localize("enhancedcombathud.deleteEffectContent")+game.i18n.localize(e?.label??i?.name??"")+"?",defaultYes:!1})&&(s?(await s.delete(),this.render(!0)):this.token?.toggleEffect(n))}),i.appendChild(e.element);await Promise.all(o.map(e=>e.render()))}async _onConfigure(e){e.preventDefault();new(function getArgonPortraitConfig(e){return class ArgonPortraitConfig extends HandlebarsApplication{constructor(e){super(),this.actor=e}get title(){return`${game.i18n.localize("Configure")} ${this.actor.name}`}static get DEFAULT_OPTIONS(){return mergeClone(super.DEFAULT_OPTIONS,{tag:"form",id:"argon-actor-config-form",window:{contentClasses:["standard-form"]},form:{handler:this.#e,closeOnSubmit:!0},position:{width:400}})}static get PARTS(){return{content:{template:e,classes:["standard-form","scrollable"]},footer:{template:"templates/generic/form-footer.hbs"}}}_prepareContext(...e){const t={type:"submit",action:"submit",icon:"fas fa-save",label:"Save"};return{actor:this.actor,...this.actor,buttons:[t]}}static async#e(){const e=this.element,t=new foundry.applications.ux.FormDataExtended(e).object;await this.actor.update(t),ui.ARGON.refresh()}}}(this.configurationTemplate))(this.actor).render({force:!0})}}class WeaponSets extends ArgonComponent{get classes(){return["weapon-sets"]}async activateListeners(e){super.activateListeners(e),this.element.querySelectorAll(".set").forEach(e=>{e.addEventListener("drop",this._onDrop.bind(this)),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("dragstart",this._onDragStart.bind(this)),e.addEventListener("dragend",this._onDragEnd.bind(this)),e.addEventListener("contextmenu",this._onContextMenu.bind(this))});const t=this.actor.getFlag("enhancedcombathud","activeWeaponSet")||"1";this.element.querySelectorAll(".weapon-set").forEach(e=>{e.classList.toggle("active",e.dataset.set===t)}),this.onSetChange(await this.getSetData())}async getSetData(){return{sets:await this._getSets(),active:this.actor.getFlag("enhancedcombathud","activeWeaponSet")||"1"}}async _getSets(){const e=foundry.utils.mergeObject(await this.getDefaultSets(),foundry.utils.deepClone(this.actor.getFlag("enhancedcombathud","weaponSets")||{}));for(const[t,n]of Object.entries(e))n.primary=n.primary?await fromUuid(n.primary):null,n.secondary=n.secondary?await fromUuid(n.secondary):null;return e}async getDefaultSets(){return{1:{primary:null,secondary:null},2:{primary:null,secondary:null},3:{primary:null,secondary:null}}}async getData(){return{sets:await this._getSets()}}async _onDrop(e){try{e.preventDefault(),e.stopPropagation();const t=JSON.parse(e.dataTransfer.getData("text/plain"));if("Item"!==t?.type)return;const n=e.currentTarget.dataset.set,s=e.currentTarget.dataset.slot,i=this.actor.getFlag("enhancedcombathud","weaponSets")||{};i[n]=i[n]||{},i[n][s]=t.uuid,await this.actor.setFlag("enhancedcombathud","weaponSets",i),await this.render()}catch(e){}}async _onClick(e){e.preventDefault(),e.stopPropagation();const t=e.currentTarget.dataset.set;this.element.querySelectorAll(".weapon-set").forEach(e=>{e.classList.toggle("active",e.dataset.set===t)}),await this.actor.setFlag("enhancedcombathud","activeWeaponSet",t),this.onSetChange(await this.getSetData())}async _onDragEnd(e){e.preventDefault(),e.stopPropagation();const t=e.currentTarget.dataset.set,n=e.currentTarget.dataset.slot,s=this.actor.getFlag("enhancedcombathud","weaponSets")||{};s[t]=s[t]||{},s[t][n]=null,await this.actor.setFlag("enhancedcombathud","weaponSets",s),await this.render()}async _onDragStart(e){const t=e.currentTarget.dataset.set,n=e.currentTarget.dataset.slot,s=this.actor.getFlag("enhancedcombathud","weaponSets")||{};s[t]=s[t]||{};const i=s[t][n];i&&e.dataTransfer.setData("text/plain",JSON.stringify({type:"Item",uuid:i}))}async _onContextMenu(e){e.preventDefault(),e.stopPropagation();const t=e.currentTarget.dataset.set,n=e.currentTarget.dataset.slot,s=this.actor.getFlag("enhancedcombathud","weaponSets")||{};s[t]=s[t]||{},s[t][n]=null,await this.actor.setFlag("enhancedcombathud","weaponSets",s),await this.render()}async onSetChange({sets:e,active:t}){Hooks.callAll("argon-onSetChangeUpdateItem",{sets:e,active:t}),Hooks.callAll("argon-onSetChangeComplete",{sets:e,active:t}),await this._onSetChange({sets:e,active:t})}async _onSetChange({sets:e,active:t}){console.error("WeaponSets._onSetChange() is not implemented")}}const i=["base-movement","dash-movement","danger-movement"];class MovementHud extends ArgonComponent{constructor(...e){super(...e),this._movementUsed=0}get visible(){return game.combat?.started}get classes(){return["movement-hud"]}get movementUsed(){return canvas.scene.grid.type?this.token.document.movement.history.spaces:Math.round(this.token.document.movement.history.distance/canvas.scene.dimensions.distance)}set movementUsed(e){this._movementUsed=Math.max(e,0)}get movementMax(){}get movementColor(){return i[Math.min(Math.floor(this.movementUsed/this.movementMax),2)]}get movementIcon(){return CONFIG.Token.movement?.actions[this.movementMode]?.img}get movementMode(){return this.token.document.movementAction||"walk"}getData(){return{movementIcon:this.movementIcon}}onTokenUpdate(e,t){e.movementAction&&this.render(),void 0===e.x&&void 0===e.y||this.updateMovement()}updateMovement(){game.combat?.started||(this.movementUsed=0);const e=this.movementColor,t=this.movementUsed%this.movementMax||0,n=this.movementMax-t,s=this.element.querySelector(".movement-spaces");let i="";for(let t=0;t<n;t++)i+=`<div class="movement-space  ${e}"></div>`;for(let e=0;e<t;e++)i+='<div class="movement-space"></div>';this.element.querySelector(".movement-current").innerText=n,this.element.querySelector(".movement-max").innerText=(Math.floor(this.movementUsed/this.movementMax)+1)*this.movementMax||0,s.innerHTML=i}_onNewRound(e){this.movementUsed=0,this.updateMovement()}_onCombatEnd(e){this.movementUsed=0,this.updateMovement()}async render(...e){await super.render(...e),this.updateMovement()}}class ButtonHud extends ArgonComponent{constructor(...e){super(...e)}get classes(){return["movement-hud"]}async _getButtons(){return console.error("ButtonHud._getButtons() is not implemented"),[]}async render(...e){await super.render(...e),this.buttons=await this._getButtons();for(const e of this.buttons){const t=document.createElement("div");t.classList.add("button-hud-button"),this.buttons.length>4&&t.classList.add("button-hud-button-small");const n=document.createElement("i");if(e.color&&(n.style.color=e.color),e.label&&this.buttons.length>4&&(t.dataset.tooltip=game.i18n.localize(e.label)),n.classList.add(...e.icon.split(" ")),t.appendChild(n),e.label&&this.buttons.length<=4){const n=document.createElement("span");n.textContent=game.i18n.localize(e.label),t.appendChild(n)}t.addEventListener("click",e.onClick),this.element.appendChild(t)}this.element.style.display="grid",this.buttons.length<=4?this.element.style.gridTemplateRows=`repeat(${this.buttons.length}, 1fr)`:(this.element.style.gridTemplateColumns="repeat(2, 1fr)",this.element.style.gridTemplateRows=`repeat(${Math.ceil(this.buttons.length/2)}, 1fr)`)}}class MacroPanel extends ActionPanel{constructor(...e){super(...e)}get label(){return"enhancedcombathud.hud.macro.name"}async _getButtons(){return[new MacroPanelButton({color:"red"})]}}class MacroPanelButton extends ButtonPanelButton{constructor({color:e,icon:t}){super(),this._type="macro",this._color=e,this._icon=t||"icons/svg/dice-target.svg"}get hasContents(){return!0}get colorScheme(){return this._color}get id(){return`${this.type}-${this.color}`}get label(){return"enhancedcombathud.hud.macro.name"}get type(){return this._type}get icon(){return this._icon}async _getPanel(){const e=[1,2,3,4,5],t=[],n=game.i18n.localize("enhancedcombathud.hud.macro.page");for(const s of e){const e=game.user.getHotbarMacros(s).filter(e=>e.macro).map(e=>e.macro).map(e=>new MacroButton({macro:e}));e.length&&t.push(new AccordionPanelCategory({label:`${n} ${s}`,buttons:e}))}return new AccordionPanel({id:this.id,accordionPanelCategories:t})}}class PassTurnPanel extends ActionPanel{constructor(...e){super(...e)}get label(){return"enhancedcombathud.hud.pass.name"}async _getButtons(){return[new PassTurnButton]}updateVisibility(){super.updateVisibility(),this._buttons.forEach(e=>e.render())}}class PassTurnButton extends ActionButton{get visible(){return!!game.combat?.started&&game.combat?.combatant?.actor===this.actor}get colorScheme(){return 4}get label(){return"enhancedcombathud.hud.endturn.name"}get icon(){return"modules/enhancedcombathud/icons/duration.webp"}async _onLeftClick(e){game.combat?.nextTurn()}}const o="enhancedcombathud",a=`modules/${o}/templates/partials/`;function localize(e){return game.i18n.localize(e)}const r={PORTRAIT:null,DRAWER:null,MAIN:[],WEAPONSETS:WeaponSets,MOVEMENT:MovementHud,BUTTONHUD:null,TOOLTIP:class Tooltip{constructor(e,t,n,s=!1){this.element=document.createElement("div"),this.element.classList.add(...this.classes),e.classes&&this.element.classList.add(...e.classes),this._tooltipData=e,this._triggerElement=t,this._orientation=n??foundry.helpers.interaction.TooltipManager.TOOLTIP_DIRECTIONS.UP,this._locked=s}get template(){return`${a}Tooltip.hbs`}get classes(){return["ech-tooltip"]}async getData(){return this._tooltipData}get directionClass(){switch(this._orientation){case foundry.helpers.interaction.TooltipManager.TOOLTIP_DIRECTIONS.UP:return"ech-tooltip-up";case foundry.helpers.interaction.TooltipManager.TOOLTIP_DIRECTIONS.DOWN:return"ech-tooltip-down";case foundry.helpers.interaction.TooltipManager.TOOLTIP_DIRECTIONS.LEFT:return"ech-tooltip-left";case foundry.helpers.interaction.TooltipManager.TOOLTIP_DIRECTIONS.RIGHT:return"ech-tooltip-right"}return""}async render(...e){await this._renderInner();const t=this.element.querySelector(".ech-tooltip-details");if(t){let e=3;[2,3].forEach(n=>{t.children.length%n===0&&(e=n)}),t.style.gridTemplateColumns=`repeat(${Math.min(t.children.length,e)}, 1fr)`}const n=this.element.querySelector(".ech-tooltip-body");n.textContent.trim()||(n.style.display="none"),ui.ARGON._tooltip=this,game.tooltip.activate(this._triggerElement,{html:this.element,cssClass:`ech-tooltip-container ${this.directionClass}`,direction:this._orientation});const s=game.settings.get("enhancedcombathud","tooltipScale");return document.querySelector(".ech-tooltip-container").style.setProperty("--ech-tooltip-scale",s),this.element}async _renderInner(){const e=await this.getData();this._data=e;const t=await(foundry.applications?.handlebars?.renderTemplate??renderTemplate)(this.template,e),n=document.createElement("div");n.innerHTML=t,this.element.innerHTML=n.firstElementChild.innerHTML,e.subtitle||this.element.classList.add("hide-subtitle")}setScrollDelta(e){this._scrollableElement&&(this._scrollableElement.scrollTop+=e)}_destroy(e=!1){ui.ARGON._tooltip===this&&(ui.ARGON._tooltip=null),e?this.element.remove():this.element.animate([{opacity:1},{opacity:0}],{duration:300,easing:"ease-in-out"}).onfinish=()=>{this.element.remove()}}}},l=[];class CoreHud extends HandlebarsApplication{constructor(){super(),this.performModuleCheck(),this._itemButtons=new Set,this._accordionPanelCategories=new Set,this._batchItemsUpdates=new Set,this._hudState=new Map,this._tooltip=null,this._target=null,this._enabled=!1,this.components={main:[]},this.refresh=foundry.utils.debounce(this.refresh,200),this._batchUpdateItemButtons=foundry.utils.debounce(this._batchUpdateItemButtons,200),Hooks.callAll("argonInit",CoreHud),Hooks.on("argon-onSetChangeComplete",this._updateActionContainers.bind(this)),Hooks.on("updateItem",this._onUpdateItem.bind(this)),Hooks.on("updateCombat",this._onUpdateCombat.bind(this)),Hooks.on("deleteCombat",this._onDeleteCombat.bind(this)),Hooks.on("updateActor",this._onUpdateActor.bind(this)),Hooks.on("updateToken",this._onUpdateToken.bind(this)),Hooks.on("controlToken",this._onControlToken.bind(this)),Hooks.on("createItem",this._onCreateItem.bind(this)),Hooks.on("deleteItem",this._onDeleteItem.bind(this)),Hooks.on("createActiveEffect",this._onChangeActiveEffect.bind(this)),Hooks.on("deleteActiveEffect",this._onChangeActiveEffect.bind(this)),Hooks.on("updateActiveEffect",this._onChangeActiveEffect.bind(this)),this.setColorSettings(),document.addEventListener("wheel",e=>ui.ARGON._tooltip&&ui.ARGON._tooltip.setScrollDelta(e.deltaY))}static get DEFAULT_OPTIONS(){return mergeClone(super.DEFAULT_OPTIONS,{classes:["extended-combat-hud",`fade-out-inactive-${game.settings.get("enhancedcombathud","fadeOutInactive")}`],window:{frame:!1,positioned:!1,minimizable:!1}})}_canDragDrop(e){return!0}get buttonPanelContainer(){return this._buttonPanelContainer}get actionBarWidth(){let e=0;return(this.element??this._renderingElement)?.querySelectorAll(".actions-container").forEach(t=>{e+=t.offsetWidth}),e}get itemButtons(){return Array.from(this._itemButtons)}addItemButtons(e){Array.isArray(e)||(e=[e]),this._itemButtons.add(...e)}get accordionPanelCategories(){return Array.from(this._accordionPanelCategories)}async _updateActionContainers(){this.components.main.forEach(e=>e.updateVisibility())}_onCombatStart(e){game.settings.get("enhancedcombathud","openCombatStart")&&this.bind(canvas.tokens.controlled[0]??_token),this.components.movement?._onNewRound(e),this.components.main.forEach(t=>t._onNewRound(e)),this.updateSidePortraitHuds()}_onUpdateCombat(e,t){this.components.combat?.forEach(e=>e.updateVisibility()),"round"in t&&(this.components.main?.forEach(t=>t._onNewRound(e)),this.components.movement?._onNewRound(e)),1===t.round&&0===t.turn&&this._onCombatStart(e),this.updateSidePortraitHuds()}_onDeleteCombat(e){this.components.movement?._onCombatEnd(e);game.settings.get("enhancedcombathud","openCombatStart")&&(this.enabled=!1),this.updateSidePortraitHuds()}_onUpdateItem(e){if(e.parent===this._actor){this.accordionPanelCategories.forEach(e=>e.setUses());for(const t of this.itemButtons)t.item===e&&t.render()}}updateItemButtons(e){Array.isArray(e)||(e=[e]),this._batchItemsUpdates.add(...e),this._batchUpdateItemButtons()}_batchUpdateItemButtons(){for(const e of this.itemButtons)this._batchItemsUpdates.has(e.item)&&e.render();this._batchItemsUpdates.clear()}_onUpdateActor(e){if(e===this._actor){this.components.portrait.refresh(),this.accordionPanelCategories.forEach(e=>e.setUses());for(const e of this.itemButtons)Number.isNumeric(e.quantity)&&e.render();this.components.main.forEach(e=>e.updateActionUse())}}_onCreateItem(e){e.parent===this._actor&&this._checkItemCount()}_onDeleteItem(e){e.parent===this._actor&&this._checkItemCount()}_onChangeActiveEffect(e){e.parent===this._actor&&this.components.portrait.refresh()}_checkItemCount(){const e=this._actor.items.size;e!==this._itemsCount&&(this._itemsCount=e,this.refresh())}_onUpdateToken(e,t,n){e===this._token?.document&&(t.actorId?this.bind(e):this.components.movement?.onTokenUpdate(t,n))}_onControlToken(e,t){t||canvas.tokens.controlled.length||setTimeout(()=>{canvas.tokens.controlled.length||this.bind(null)},100),t&&(this.enabled||game.settings.get("enhancedcombathud","alwaysOn"))&&this.bind(e)}async _prepareContext(e){return{fadeOutInactive:game.settings.get("enhancedcombathud","fadeOutInactive")}}getState(){return this._hudState.get(this._actor)}setState(e){this._hudState.set(this._actor,e)}getPanelState(e){const t=this.getState();if(t)return t[e.id]}setPanelState(e,t){const n=this.getState();n&&(n[t.id]=e,this.setState(n))}async _renderInner(e){this._hudState.get(this._actor)||this._hudState.set(this._actor,{});const t=this.element;t.innerHTML="",this._renderingElement=t,this.components={weaponSets:new r.WEAPONSETS,movement:this._token&&r.MOVEMENT?new r.MOVEMENT:null,buttonHud:r.BUTTONHUD?new r.BUTTONHUD:null,portrait:new r.PORTRAIT,drawer:new r.DRAWER,main:r.MAIN.map(e=>new e)},t.appendChild(this.components.weaponSets.element),t.appendChild(this.components.portrait.element),t.appendChild(this.components.drawer.element),this.components.movement&&t.appendChild(this.components.movement.element),this.components.buttonHud&&t.appendChild(this.components.buttonHud.element);const n=document.createElement("div");n.classList.add("action-hud"),this._buttonPanelContainer=n,t.appendChild(n);for(const e of this.components.main){(await e._getButtons()).length&&n.appendChild(e.element)}const s=[];return Object.values(this.components).forEach(e=>{e&&(Array.isArray(e)?e.forEach(e=>s.push(e.render())):s.push(e.render()))}),await Promise.all(s),this._updateActionContainers(),this.updateSidePortraitHuds(),this.components.combat=this.components.main.filter(e=>e instanceof PassTurnPanel),this._itemsCount=this._actor.items.size,t}_onRender(e,t){this.toggleMinimize(document.body.classList.contains("minimize-ech-hud")),this._renderInner(e)}get enabled(){return this._enabled}set enabled(e){const t="boolean"==typeof e?canvas.tokens.controlled[0]??game.user.character:e;this._enabled=!!e,this.bind(e?t??null:null)}async bind(e){if(!e)return this._target=null,this._token=null,this._actor=null,this._itemsCount=null,this._tooltip?._destroy(!0),this._batchItemsUpdates.clear(),this.toggleUiElements(!1),this.updateSceneControlButton(),this.close();if(this._itemButtons.clear(),this._accordionPanelCategories.clear(),e instanceof foundry.canvas.placeables.Token||e instanceof TokenDocument)this._actor=e.actor,this._token=e instanceof foundry.canvas.placeables.Token?e:e.object;else{if(!(e instanceof Actor))throw new Error("Invalid argument");this._actor=e,this._token=e.token??e.parent??e.getActiveTokens()[0]??null}if(!this._actor||!this._actor.isOwner)return this._target=null,this._token=null,this._actor=null,console.error("Argon: No actor found"),this.close();const t=this._actor.type;if(l.length&&!l.includes(t)){return game.settings.get("enhancedcombathud","suppressWarnings")?console.error(localize("enhancedcombathud.err.unsupportedActorType").replace("%t",t)):ui.notifications.error(localize("enhancedcombathud.err.unsupportedActorType").replace("%t",t)),this._target=null,this._token=null,this._actor=null,this.close()}this._target=e,this._enabled=!0,this._batchItemsUpdates.clear(),this.toggleUiElements(!0),this.updateSceneControlButton(),this.render(!0)}toggle(e){e=e??!this.enabled,this.enabled=e}updateSceneControlButton(){if(document.querySelector('.control-tool[data-tool="echtoggle"]'))try{document.querySelector('.control-tool[data-tool="echtoggle"]').classList.toggle("active",!!this._target),ui.controls.controls.find(e=>"token"==e.name).tools.find(e=>"echtoggle"==e.name).active=!!this._target}catch(e){}}toggleUiElements(e){game.settings.get("enhancedcombathud","hideMacroPlayers")||(e=!1);[document.querySelector("#hotbar"),document.querySelector("#fps"),document.querySelector("#players")].filter(e=>e).forEach(t=>{t.classList.toggle("ech-hidden",e)})}collapseAllPanels(){this.element&&this.element.querySelectorAll(".features-container.show").forEach(e=>{e.classList.remove("show")})}updateSidePortraitHuds(){this.components.movement?.setVisibility(),this.components.buttonHud?.setVisibility(),this.components?.portrait?.element&&(this.components.movement?.visible||this.components.buttonHud?.visible?this.components.portrait.element.style.marginRight="":this.components.portrait.element.style.marginRight="0px")}toggleMinimize(e){const t=document.body,n=this.element,s=t.classList.contains("minimize-ech-hud"),i=e??!s;t.classList.toggle("minimize-ech-hud",i),n.classList.toggle("minimize-hud",i),this.setPosition(!1)}setPosition(e=!0){const t=this.element;e&&(t.style.transition="none");const n=t.classList.contains("minimize-hud"),s=(t.offsetWidth,window.innerWidth,game.settings.get("enhancedcombathud","autoScale")?window.innerHeight/2e3:game.settings.get("enhancedcombathud","scale")),i={bottom:n?"0px":`${game.settings.get("enhancedcombathud","botPos")}px`,left:`${game.settings.get("enhancedcombathud","leftPos")}px`,transform:n?`scale(${s>1?1:s}) translateY(100%)`:`scale(${s>1?1:s})`,width:`calc(100vw * ${s<1?1+1*parseFloat(1-s):1})`};for(let e in i)t.style[e]=i[e];setTimeout(()=>{t.style.transition=null},500)}performModuleCheck(){const e=game.modules.get(`enhancedcombathud-${game.system.id}`);if(e?.active)return;const t=`<a href="https://foundryvtt.com/packages/enhancedcombathud-${game.system.id}" target="_blank">Argon - Combat HUD (${game.system.id.toUpperCase()})</a>`;ui.notifications.error(localize("enhancedcombathud.err.moduleNotActive").replace("%m",t),{permanent:!0})}interceptNextDialog(e){if(!e)return;const t=function getOffset(e){const t=e.getBoundingClientRect(),n=window.pageXOffset||document.documentElement.scrollLeft,s=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+s,left:t.left+n}}(e);document.querySelectorAll(".ech-highjack-window .close").forEach(e=>e.click());const n=Hooks.once("renderDialog",(n,s)=>{s=s[0],t.top+=-window.scrollY-n.position.height/2,t.left+=e.getBoundingClientRect().width+10-window.scrollX,s.style.top=t.top>0?t.top+"px":"0",s.style.left=t.left+"px",game.settings.get("enhancedcombathud","dialogTheme")&&s.classList.add("ech-highjack-window"),n.position.left=t.left,n.position.top=t.top>0?t.top:0;const i=s.querySelector('select[name="ability"]');i&&!i.value&&(i.value=e.dataset.modifier)});setTimeout(()=>{Hooks.off("renderDialog",n)},200)}showTargetPickerGuide(){!async function showTargetPickerGuide(){let e="";for(let t=0;t<4;t++)e+=`<li class="notification info" style="font-weight: 900">${game.i18n.localize(`enhancedcombathud.targetPicker.dialog.list.${t}`)}</li>`;await foundry.applications.api.DialogV2.prompt({window:{title:game.i18n.localize("enhancedcombathud.targetPicker.dialog.title")},content:`<ul class="guide-list" style="list-style:none;padding:0">${e}</ul>`,close:()=>!1})&&game.settings.set("enhancedcombathud","targetPickerGuideShown",!0)}()}refresh(){this.render()}static setControlHooks(){Hooks.on("getSceneControlButtons",(e,t,n)=>{e.tokens.tools.echtoggle={active:ui.ARGON?._target,icon:"fa-duotone fa-swords",name:"echtoggle",title:game.i18n.localize("enhancedcombathud.controls.toggle.title"),onChange:function(e,t){ui.ARGON.toggle(t)},toggle:!0}}),Hooks.on("renderTokenHUD",(e,t,n)=>{const s=document.createElement("div");s.classList.add("control-icon"),s.innerHTML='<i class="fa-duotone fa-swords"></i>',s.classList.toggle("active",ui.ARGON.enabled),t.querySelector(".col.left").prepend(s),s.onclick=t=>{const n=e.object??canvas.tokens.controlled[0];ui.ARGON.toggle(ui.ARGON.enabled?null:n),s.classList.toggle("active")}})}static definePortraitPanel(e){r.PORTRAIT=e}static defineDrawerPanel(e){r.DRAWER=e}static defineMainPanels(e){r.MAIN.push(...e)}static defineWeaponSets(e){r.WEAPONSETS=e}static defineMovementHud(e){r.MOVEMENT=e}static defineButtonHud(e){r.BUTTONHUD=e}static defineSupportedActorTypes(e){l.push(...e)}static defineTooltip(e){r.TOOLTIP=e}static get ARGON(){return{CORE:{CoreHud,Tooltip:r.TOOLTIP,ArgonComponent},MAIN:{BUTTONS:{ActionButton,ButtonPanelButton,ItemButton,MacroButton,SplitButton},ActionPanel,BUTTON_PANELS:{ButtonPanel,ACCORDION:{AccordionPanel,AccordionPanelCategory}}},PORTRAIT:{PortraitPanel,Effect},DRAWER:{DrawerButton,DrawerPanel},WeaponSets,MovementHud,ButtonHud,PREFAB:{PassTurnPanel,MacroPanel}}}async setColorSettings(e){function setThemeColors(e){Object.entries(foundry.utils.flattenObject(e)).forEach(([e,t])=>{document.documentElement.style.setProperty(`--ech-${e.replace(/\./g,"-")}`,t)})}document.documentElement.style.setProperty("--ech-fadeout-deleay",game.settings.get("enhancedcombathud","fadeoutDelay")+"s"),document.documentElement.style.setProperty("--ech-fadeout-opacity",game.settings.get("enhancedcombathud","fadeoutOpacity"));let t=e??game.settings.get("enhancedcombathud","echThemeData");if("custom"==t.theme)setThemeColors(t.colors);else{setThemeColors(await this.getThemeJson(t.theme))}game.settings.get("enhancedcombathud","noBlur")&&document.documentElement.style.setProperty("--ech-blur-amount","")}async getThemeJson(e){let t;t=await fetch(`modules/enhancedcombathud/scripts/themes/${e}.json`),t.ok||(t=await fetch(`modules/enhancedcombathud/storage/themes/${e}.json`)),t.ok||(ui.notifications.error("Argon: Theme not found"),t=await fetch("modules/enhancedcombathud/scripts/themes/argon.json"));return await t.json()}async close(...e){await super.close({...e,animate:!1})}}const c={theme:"custom",font:"Roboto",colors:{portrait:{base:{background:"#414B55E6",color:"#B4D2DCFF",border:"#757f89FF"}},mainAction:{base:{background:"#414B55E6",color:"#B4D2DCFF",border:"#757f89FF"},hover:{background:"#747e88e6",color:"#B4D2DCFF",border:"#757f89FF"}},bonusAction:{base:{background:"#453B75E6",color:"#B4D2DCFF",border:"#757f89FF"},hover:{background:"#9288c2e6",color:"#B4D2DCFF",border:"#757f89FF"}},freeAction:{base:{background:"#3B5875E6",color:"#B4D2DCFF",border:"#757f89FF"},hover:{background:"#88a5c2e6",color:"#B4D2DCFF",border:"#757f89FF"}},reaction:{base:{background:"#753B3BE6",color:"#B4D2DCFF",border:"#757f89FF"},hover:{background:"#c28888e6",color:"#B4D2DCFF",border:"#757f89FF"}},endTurn:{base:{background:"#374B3CE6",color:"#B4D2DCFF",border:"#757f89FF"},hover:{background:"#849889e6",color:"#B4D2DCFF",border:"#757f89FF"}},tooltip:{header:{background:"#ffffffCC",color:"#414146",border:"#757f89FF"},subtitle:{background:"#32505a",color:"#ffffff",border:"#757f89FF"},body:{background:"#5a7896B3",color:"#ffffff",border:"#757f89FF"}},abilityMenu:{background:"#414B55E6",color:"#B4D2DCFF",border:"#757f89FF",base:{color:"#B4D2DCFF",boxShadow:"#757f89CC"},hover:{color:"#B4D2DCFF",boxShadow:"#757f89CC"}},buttons:{base:{background:"#5096c3",color:"#ffffff",border:"#5096c3"},hover:{background:"#55bef5",color:"#ffffffff",border:"#55bef5"}},movement:{used:{background:"#7d879180",boxShadow:"#00000000"},baseMovement:{background:"#5abef5FF",boxShadow:"#6ed2ffCC"},dashMovement:{background:"#c8c85aFF",boxShadow:"#dcdc6eCC"},dangerMovement:{background:"#c85f5aFF",boxShadow:"#dc736eCC"}}}};class EchThemeOptions extends HandlebarsApplication{static get DEFAULT_OPTIONS(){return mergeClone(super.DEFAULT_OPTIONS,{tag:"form",id:"echThemeOptions",window:{title:"Theme Options",contentClasses:["standard-form"],resizable:!0},actions:{fooAction:this.fooAction,barAction:this.barAction},form:{handler:this.#e,closeOnSubmit:!1},position:{width:660}})}static get PARTS(){return{content:{template:"modules/enhancedcombathud/templates/theme-options.hbs",classes:["standard-form","scrollable"]},footer:{template:"templates/generic/form-footer.hbs"}}}createTheme(){new foundry.applications.api.DialogV2({window:{title:"Export Argon - Combat HUD Theme"},content:`\n                <form id="echExportTheme">\n                    <div class="form-group">\n                        <label>${game.i18n.localize("enhancedcombathud.themeOptions.exportThemeName")}</label>\n                        <input type="text" name="echExportThemeName"/>\n                    </div>\n                </form>`,buttons:[{action:"export",label:"Save",callback:(e,t,n)=>{const s=n.element.querySelector('input[name="echExportThemeName"]').value.slugify({strict:!0}),i=new File([new Blob([JSON.stringify(this.getThemeColors())],{type:"application/json"})],`${s}.json`);foundry.applications.apps.FilePicker.implementation.uploadPersistent("enhancedcombathud","themes",i).then(e=>{this.buildDropdown(s)})}},{action:"cancel",label:"Cancel",callback:e=>!0}]}).render({force:!0})}getThemeColors(){let e={};return this.element.querySelectorAll("#echThemeOptions .window-content alpha-color-picker").forEach(t=>{!function setProperty(e,t,n){return foundry.utils.setProperty(e,t,n)}(e,t.name,t.getAttribute("value"))}),foundy.utils.expandObject(e.colors)}async buildDropdown(e){void 0===e&&game.settings.get("enhancedcombathud","echThemeData").theme;const t=this.element,n=t.querySelector('select[name="theme"]');n.innerHTML="";const s=(await foundry.applications.apps.FilePicker.implementation.browse("user","modules/enhancedcombathud/scripts/themes",{extensions:[".json"]})).files,i=(await foundry.applications.apps.FilePicker.implementation.browse("user","modules/enhancedcombathud/storage/themes",{extensions:[".json"]})).files;function createOption(e){const t=e.split("/")[e.split("/").length-1].replace(/\.json/gi,""),s=document.createElement("option");s.value=t;const i=t.replace(/-/g," ");s.text=i.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),n.appendChild(s)}function createOptGroup(e){const t=document.createElement("optgroup");t.label=e,n.appendChild(t)}createOption("custom"),createOptGroup("Core Themes"),s.forEach(createOption),createOptGroup("Custom Themes"),i.forEach(createOption),t.querySelector('select[name="theme"]').value=e,this.setThemeVisibility(e)}_prepareContext(e){let t=game.settings.get("enhancedcombathud","echThemeData");t=foundry.utils.mergeObject(c,t);return{themeOptions:t,buttons:[{type:"submit",action:"submit",icon:"fas fa-save",label:"Save"}]}}_onRender(e,t){super._onRender(e,t);const n=this.element;function _convertHexUnitTo256(e){return parseInt(e.repeat(2/e.length),16)}this.buildDropdown(game.settings.get("enhancedcombathud","echThemeData").theme),n.addEventListener("click",e=>{if(e.target.matches("li h4.toggleOptions")||e.target.closest("li h4.toggleOptions")){const t=e.target.matches("li h4.toggleOptions")?e.target:e.target.closest("li h4.toggleOptions"),n=t.closest("li"),s=n.classList.contains("show");t.closest("ul").querySelectorAll("li.show").forEach(e=>e.classList.remove("show")),n.classList.toggle("show",!s),this.setPosition({height:"auto"})}});let s=game.settings.get("enhancedcombathud","echThemeData");this.setThemeVisibility(s.theme),n.querySelector('select[name="theme"]').addEventListener("change",e=>{let t=e.currentTarget.value;const updateColors=e=>{n.querySelectorAll(".color-picker").forEach(t=>{let n=t.name.replace(/colors\./g,"").split(".").reduce((e,t)=>e&&e[t]||null,e);null!=n&&(t.setAttribute("value",n),t.value=n,t.style.backgroundColor=n,t.style.color=(e=>{const t=(e=>{const t=e.slice(1).match(new RegExp(".{2}","g")),[n,s,i,o]=t.map(_convertHexUnitTo256);return[n,s,i,Math.round(100*(o/256+Number.EPSILON))/100]})(e),n=Math.round((299*t[0]+587*t[1]+114*t[2])/1e3);return t[3]>.5?n>125?"black":"white":"black"})(n))})};"custom"!=t?ui.ARGON.getThemeJson(t).then(e=>{updateColors(e)}):updateColors(game.settings.get("enhancedcombathud","echThemeData").colors),this.setThemeVisibility(t),this.setPosition({height:"auto"})}),n.querySelector('button[name="export"]').addEventListener("click",e=>{e.preventDefault(),this.createTheme()})}_onChangeForm(e,t){const n=new foundry.applications.ux.FormDataExtended(this.form).object;ui.ARGON.setColorSettings(foundry.utils.expandObject(n))}static async#e(){const e=this.element,t=new foundry.applications.ux.FormDataExtended(e).object;await game.settings.set("enhancedcombathud","echThemeData",foundry.utils.expandObject(t))}setThemeVisibility(e){this.element.querySelector(".echThemeOptionsContainer").classList.toggle("hidden","custom"!=e),this.element.querySelector("button[name='export']").classList.toggle("hidden","custom"!=e)}async render(e){return super.render(e)}_onClose(...e){super._onClose(...e),ui.ARGON.setColorSettings()}}function hexToNum(e){return parseInt(e,16)}class HTMLAlphaColorPickerElement extends foundry.applications.elements.AbstractFormInputElement{constructor({value:e,step:t,min:n,max:s}={}){super(),e=e||this.getAttribute("value")||"#000000ff",this.value=e||this.getAttribute("value"),this._color=e.slice(0,7),this._alpha=hexToNum(e.slice(7,9)),this._step=t||this.getAttribute("step")||1,this._min=n||this.getAttribute("min")||0,this._max=s||this.getAttribute("max")||255}_getValue(){return this._color+function numToHex(e){return e.toString(16).padStart(2,"0")}(this._alpha)}_setValue(e){this._color=e.slice(0,7),this._alpha=hexToNum(e.slice(7,9)),this._value=e,this.setAttribute("value",e)}static tagName="alpha-color-picker";#t;#n;#s;_buildElements(){const e=document.createElement("div");return e.style.display="flex",e.style.flexDirection="row",e.style.alignItems="center",e.style.gap="0.5rem",e.style.justifyContent="space-between",this.#t=new foundry.applications.elements.HTMLColorPickerElement({value:this._color}),this.#t.style.flex="1",this._applyInputAttributes(this.#t),this.#n=new foundry.applications.elements.HTMLRangePickerElement({value:this._alpha,step:this._step,min:this._min,max:this._max}),this.#n.style.flex="1",this._applyInputAttributes(this.#n),this.#s=document.createElement("span"),this.#s.style.background=this.value,this.#s.style.borderRadius="50%",this.#s.style.width="var(--input-height)",this.#s.style.height="var(--input-height)",this.#s.style.border="solid 1px",e.appendChild(this.#t),e.appendChild(this.#n),e.appendChild(this.#s),[e]}_refresh(){this.#t&&(this.#t._setValue(this._color),this.#t._refresh(),this.#n._setValue(this._alpha),this.#n._refresh(),this.#s.style.background=this.value)}_activateListeners(){const e=this.#i.bind(this);this.#t.addEventListener("change",e),this.#n.addEventListener("change",e)}#i(e){e.stopPropagation(),e.currentTarget===this.#t?this._color=e.currentTarget.value:this._alpha=e.currentTarget.value,this.value=this.value}}const h="enhancedcombathud";Object.defineProperty(globalThis.CONFIG,"ARGON",{get:()=>CoreHud.ARGON}),CoreHud.setControlHooks(),Hooks.on("init",()=>{!function registerKeybindings(){game.keybindings.register("enhancedcombathud","toggleHud",{name:"enhancedcombathud.hotkey.toggle.name",editable:[{key:"KeyA",modifiers:[foundry.helpers.interaction.KeyboardManager.MODIFIER_KEYS.SHIFT]}],restricted:!1,onDown:()=>{},onUp:()=>{ui.ARGON.toggle()}})}(),window.customElements.define(HTMLAlphaColorPickerElement.tagName,HTMLAlphaColorPickerElement)}),Hooks.on("ready",()=>{!function initConfig(){Handlebars.registerHelper("echLocalize",(e,t,n)=>{let s=`.${e}`;return"string"==typeof t&&(s+=`${t.charAt(0).toUpperCase()+t.slice(1)}`),"string"==typeof n&&(s+=`${n.charAt(0).toUpperCase()+n.slice(1)}`),game.i18n.localize(`enhancedcombathud.themeOptions${s}`)}),Handlebars.registerHelper("ifObject",function(e,t){return"object"==typeof e?t.fn(this):t.inverse(this)})}(),function registerSettings(){game.settings.register("enhancedcombathud","globalTheme",{name:game.i18n.localize("enhancedcombathud.settings.globalTheme.name"),hint:game.i18n.localize("enhancedcombathud.settings.globalTheme.hint"),scope:"world",config:!0,type:String,requiresReload:!0,choices:{client:game.i18n.localize("enhancedcombathud.settings.globalTheme.choices.client"),world:game.i18n.localize("enhancedcombathud.settings.globalTheme.choices.world")},default:"client",onChange:()=>ui.ARGON.refresh()});const e=game.settings.get("enhancedcombathud","globalTheme");game.settings.register("enhancedcombathud","echThemeData",{name:"Data used for Theming",type:Object,default:c,scope:e,config:!1,onChange:()=>{ui.ARGON.setColorSettings(),ui.ARGON.refresh()}}),game.settings.register("enhancedcombathud","targetPickerGuideShown",{type:Boolean,default:!1,scope:"client",config:!1}),game.settings.registerMenu("enhancedcombathud","echThemeOptions",{name:game.i18n.localize("enhancedcombathud.settings.thememenu.name"),label:game.i18n.localize("enhancedcombathud.settings.thememenu.label"),hint:game.i18n.localize("enhancedcombathud.settings.thememenu.hint"),icon:"fas fa-bars",type:EchThemeOptions,restricted:"world"===e}),game.settings.register("enhancedcombathud","rangefinder",{name:game.i18n.localize("enhancedcombathud.settings.rangefinder.name"),hint:game.i18n.localize("enhancedcombathud.settings.rangefinder.hint"),scope:"world",config:!0,type:Boolean,default:!0,onChange:()=>ui.ARGON.refresh()}),game.settings.register("enhancedcombathud","rangepicker",{name:game.i18n.localize("enhancedcombathud.settings.rangepicker.name"),hint:game.i18n.localize("enhancedcombathud.settings.rangepicker.hint"),scope:"world",config:!0,type:Boolean,default:!0,onChange:()=>ui.ARGON.refresh()}),game.settings.register("enhancedcombathud","rangepickerclear",{name:game.i18n.localize("enhancedcombathud.settings.rangepickerclear.name"),hint:game.i18n.localize("enhancedcombathud.settings.rangepickerclear.hint"),scope:"world",config:!0,type:Boolean,default:!1,onChange:()=>ui.ARGON.refresh()}),game.settings.register("enhancedcombathud","openCombatStart",{name:game.i18n.localize("enhancedcombathud.settings.openCombatStart.name"),hint:game.i18n.localize("enhancedcombathud.settings.openCombatStart.hint"),scope:"world",config:!0,type:Boolean,default:!1,onChange:()=>ui.ARGON.refresh()}),game.settings.register("enhancedcombathud","dialogTheme",{name:game.i18n.localize("enhancedcombathud.settings.dialogTheme.name"),hint:game.i18n.localize("enhancedcombathud.settings.dialogTheme.hint"),scope:"world",config:!0,type:Boolean,default:!0}),game.settings.register("enhancedcombathud","autoScale",{name:game.i18n.localize("enhancedcombathud.settings.autoScale.name"),hint:game.i18n.localize("enhancedcombathud.settings.autoScale.hint"),scope:"client",config:!0,type:Boolean,default:!0,onChange:()=>ui.ARGON.refresh()}),game.settings.register("enhancedcombathud","scale",{name:game.i18n.localize("enhancedcombathud.settings.scale.name"),hint:game.i18n.localize("enhancedcombathud.settings.scale.hint"),scope:"client",config:!0,range:{min:.1,max:1,step:.01},type:Number,default:.5,onChange:()=>ui.ARGON.refresh()}),game.settings.register("enhancedcombathud","alwaysOn",{name:game.i18n.localize("enhancedcombathud.settings.alwaysOn.name"),hint:game.i18n.localize("enhancedcombathud.settings.alwaysOn.hint"),scope:"client",config:!0,type:Boolean,default:!1,onChange:()=>ui.ARGON.refresh()}),game.settings.register("enhancedcombathud","leftPos",{name:game.i18n.localize("enhancedcombathud.settings.leftPos.name"),hint:game.i18n.localize("enhancedcombathud.settings.leftPos.hint"),scope:"client",config:!0,type:Number,default:15,onChange:()=>ui.ARGON.refresh()}),game.settings.register("enhancedcombathud","botPos",{name:game.i18n.localize("enhancedcombathud.settings.botPos.name"),hint:game.i18n.localize("enhancedcombathud.settings.botPos.hint"),scope:"client",config:!0,type:Number,default:15,onChange:()=>ui.ARGON.refresh()}),game.settings.register("enhancedcombathud","hideMacroPlayers",{name:game.i18n.localize("enhancedcombathud.settings.hideMacroPlayers.name"),hint:game.i18n.localize("enhancedcombathud.settings.hideMacroPlayers.hint"),scope:"client",config:!0,type:Boolean,default:!0,onChange:()=>ui.ARGON.refresh()}),game.settings.register("enhancedcombathud","playerDetailsBottom",{name:game.i18n.localize("enhancedcombathud.settings.playerDetailsBottom.name"),hint:game.i18n.localize("enhancedcombathud.settings.playerDetailsBottom.hint"),scope:"client",config:!0,type:Boolean,default:!1,onChange:()=>ui.ARGON.refresh()}),game.settings.register("enhancedcombathud","showTooltips",{name:game.i18n.localize("enhancedcombathud.settings.showTooltips.name"),hint:game.i18n.localize("enhancedcombathud.settings.showTooltips.hint"),scope:"client",config:!0,type:Boolean,default:!0,onChange:()=>ui.ARGON.refresh()}),game.settings.register("enhancedcombathud","tooltipScale",{name:game.i18n.localize("enhancedcombathud.settings.tooltipScale.name"),hint:game.i18n.localize("enhancedcombathud.settings.tooltipScale.hint"),scope:"client",config:!0,range:{min:.1,max:1,step:.01},type:Number,default:.7,onChange:()=>ui.ARGON.refresh()}),game.settings.register("enhancedcombathud","fadeOutInactive",{name:game.i18n.localize("enhancedcombathud.settings.fadeOutInactive.name"),hint:game.i18n.localize("enhancedcombathud.settings.fadeOutInactive.hint"),scope:"client",config:!0,type:Boolean,default:!1,onChange:()=>{ui.ARGON.setColorSettings(),ui.ARGON.refresh()}}),game.settings.register("enhancedcombathud","fadeoutDelay",{name:game.i18n.localize("enhancedcombathud.settings.fadeoutDelay.name"),hint:game.i18n.localize("enhancedcombathud.settings.fadeoutDelay.hint"),scope:"client",config:!0,type:Number,default:4,onChange:()=>{ui.ARGON.setColorSettings(),ui.ARGON.refresh()}}),game.settings.register("enhancedcombathud","fadeoutOpacity",{name:game.i18n.localize("enhancedcombathud.settings.fadeoutOpacity.name"),hint:game.i18n.localize("enhancedcombathud.settings.fadeoutOpacity.hint"),scope:"client",config:!0,type:Number,range:{min:0,max:1,step:.05},default:.1,onChange:()=>{ui.ARGON.setColorSettings(),ui.ARGON.refresh()}}),game.settings.register("enhancedcombathud","noBlur",{name:game.i18n.localize("enhancedcombathud.settings.noBlur.name"),hint:game.i18n.localize("enhancedcombathud.settings.noBlur.hint"),scope:"client",config:!0,type:Boolean,default:!1,onChange:()=>{ui.ARGON.setColorSettings(),ui.ARGON.refresh()}}),game.settings.register("enhancedcombathud","suppressWarnings",{name:game.i18n.localize("enhancedcombathud.settings.suppressWarnings.name"),hint:game.i18n.localize("enhancedcombathud.settings.suppressWarnings.hint"),scope:"world",config:!0,type:Boolean,default:!1})}(),ui.ARGON=new CoreHud})})();
//# sourceMappingURL=index.js.map